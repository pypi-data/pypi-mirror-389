# Experiment Configuration File
# This file sets up parameters for both the control and perturbation experiments.
# Adjust the settings below as needed for your environment and model.

model_type: access-esm1.6  # available models can be checked via `payu list`
repository_url: git@github.com:ACCESS-NRI/access-esm1.6-configs.git
start_point: "61b5e1c" # Control commit hash for new branches
test_path: prototype-0.3.0-esm1.6-submodules # All control and perturbation experiment repositories will be created here; can be relative, absolute or ~ (user-defined)
repository_directory: dev-preindustrial # Local directory name for the central repository (user-defined)

control_branch_name: ctrl

Control_Experiment:
# No changes to apply for the control branch

Perturbation_Experiment:
    # This section contains one or more parameter blocks, each defining a set of perturbation branches.
    #
    # Below illustrates two valid patterns for describing *list of dicts* inventories (e.g. `submodels`) 
    # when working with two branches.
    #
    # ─────────────────────────────────────────────────────────────────────────────
    # General notes
    # ─────────────────────────────────────────────────────────────────────────────
    # * Each block must declare its branches:
    #       branches:
    #         - perturb_1
    #         - perturb_2
    # NOTE: branch names must be unique across all blocks!
    #
    # * Under a list such as `submodels`, always include the **entire**
    #   list of items, even if you only modify one field in one item.
    #
    # * Scalars/strings apply to all branches.
    # * Lists whose length == number of branches are index-selected
    #   (element i -> branch i).
    #
    # ─────────────────────────────────────────────────────────────────────────────
    # Pattern 1: One inventory broadcast to all branches
    # ─────────────────────────────────────────────────────────────────────────────
    # Use a single outer element that is a list (that is the "- - " form), and put the entire
    # set of items inside. Per-branch differences then live inside individual fields using 
    # per-branch lists (e.g., `ncpus: [208, 416]` below).
    #
    # Example:
    #
    # branches:
    #   - perturb_1a
    #   - perturb_2a
    #
    # config.yaml:
    #   submodels:
    #     - - name: atmosphere
    #         model: um
    #         ncpus:
    #           - 208
    #           - 416
    #         exe: um_hg3.exe
    #         input:
    #           - - /path/to/atmos/input/file1 # for perturb_1a/perturb_2a
    #             - /path/to/atmos/input/file2 # for perturb_1a/perturb_2a
    #     - name: ocean
    #       model: mom
    #       ncpus:
    #         - 196
    #         - 392
    #       exe: mom5_access_cm
    #       input:
    #         - - /path/to/ocean/input/file1 # for perturb_1a/perturb_2a
    #           - /path/to/ocean/input/file2 # for perturb_1a/perturb_2a
    #
    # In this first pattern, the entire inventory is shared by all branches!
    #
    # NOTE:
    # 1. The `- -` prefix is only needed because `submodels` is a *list of dicts*
    #    and you’re broadcasting that list as a single block. For simple values
    #    (scalars, flat lists) you don’t need it (`- -`).
    #
    # 2. In the `input` field above, a single nested *list of lists* is used to indicate
    #    that all branches use the same input files.
    #    If different branches need different input files,
    #    input:
    #      - - /path/to/atmos/input/file1 # for perturb_1a
    #        - /path/to/atmos/input/file2 # for perturb_1a
    #      - - /path/to/atmos/input/file3 # for perturb_2a
    #        - /path/to/atmos/input/file4 # for perturb_2a
    #
    # ─────────────────────────────────────────────────────────────────────────────
    # Pattern 2: Each branch has its own full inventory
    # ─────────────────────────────────────────────────────────────────────────────
    # Make the outer list length == number of branches. Each outer element is a complete inventory for that branch.
    #
    # Example:
    # config.yaml:
    #   submodels:
    #     - - name: atmosphere
    #         model: um
    #         ncpus: 208
    #         exe: um_hg3.exe
    #         input:
    #           - /path/to/atmos/input/file1 # for perturb_1b
    #           - /path/to/atmos/input/file2 # for perturb_1b
    #       - name: ocean
    #         model: mom
    #         ncpus: 196
    #         exe: mom5_access_cm
    #         input:
    #           - /path/to/ocean/input/file1 # for perturb_1b
    #           - /path/to/ocean/input/file2 # for perturb_1b
    #     - - name: atmosphere
    #         model: um
    #         ncpus: 416
    #         exe: um_hg3.exe
    #         input:
    #           - /path/to/atmos/input/file1 # for perturb_2b
    #           - /path/to/atmos/input/file2 # for perturb_2b
    #       - name: ocean
    #         model: mom
    #         ncpus: 392
    #         exe: mom5_access_cm
    #         input:
    #           - /path/to/ocean/input/file1 # for perturb_2b
    #           - /path/to/ocean/input/file2 # for perturb_2b
    #
    # In this second pattern, each branch has its own complete inventory.
    #
    # ─────────────────────────────────────────────────────────────────────────────
    # Choosing a pattern!
    # ─────────────────────────────────────────────────────────────────────────────
    # Use Pattern 1 when every branch shares most of the same settings, and only a few
    # parameters vary per branch (e.g. ncpus).
    # Use Pattern 2 when each branch has a very different inventory (e.g., different
    # input files, exe, etc.).
    # IMPORTANT: DO NOT mix the two patterns in the same list!

  Parameter_block1:
  # Pattern 1: single inventory broadcast to all branches, with per-branch differences
    branches:
      - perturb_1a
      - perturb_2a

    config.yaml:
      submodels:
        - - name: atmosphere
            model: um
            ncpus:
              - 208
              - 416
            exe: um_hg3.exe
            input:
                # single nested list -> same files used by all branches
                # Aerosols
              - - /g/data/vk83/prerelease/configurations/inputs/access-esm1p6/modern/pre-industrial/atmosphere/aerosol/global.N96/2025.06.04/OCFF_1850_cmip7.anc
                - /g/data/vk83/prerelease/configurations/inputs/access-esm1p6/modern/pre-industrial/atmosphere/aerosol/global.N96/2025.06.04/BC_1850_cmip7.anc

          - name: ocean
            model: mom
            ncpus:
              - 196
              - 392
            exe: mom5_access_cm 
            input:
                # Biogeochemistry
              - - /g/data/vk83/configurations/inputs/access-esm1p5/modern/share/ocean/biogeochemistry/global.1deg/2020.05.19/dust.nc
                - /g/data/vk83/configurations/inputs/access-esm1p5/modern/share/ocean/biogeochemistry/global.1deg/2020.05.19/ocmip2_press_monthly_om1p5_bc.nc

  Parameter_block2:
  # Pattern 2: each branch has its own inventory
    branches: 
      - perturb_1b
      - perturb_2b

    config.yaml:
      submodels:
      # first branch 
        - - name: atmosphere
            model: um
            ncpus: 208
            exe: um_hg3.exe
            input:
                # single nested list -> same files used by all branches
                # Aerosols
              - /g/data/vk83/prerelease/configurations/inputs/access-esm1p6/modern/pre-industrial/atmosphere/aerosol/global.N96/2025.06.04/OCFF_1850_cmip7.anc
              - /g/data/vk83/prerelease/configurations/inputs/access-esm1p6/modern/pre-industrial/atmosphere/aerosol/global.N96/2025.06.04/BC_1850_cmip7.anc

          - name: ocean
            model: mom
            ncpus: 196
            exe: mom5_access_cm 
            input:
                # Biogeochemistry
              - /g/data/vk83/configurations/inputs/access-esm1p5/modern/share/ocean/biogeochemistry/global.1deg/2020.05.19/dust.nc
              - /g/data/vk83/configurations/inputs/access-esm1p5/modern/share/ocean/biogeochemistry/global.1deg/2020.05.19/ocmip2_press_monthly_om1p5_bc.nc

      # second branch
        - - name: atmosphere
            model: um
            ncpus: 416
            exe: um_hg3.exe
            input:
                # single nested list -> same files used by all branches
                # Aerosols
              - /g/data/vk83/prerelease/configurations/inputs/access-esm1p6/modern/pre-industrial/atmosphere/aerosol/global.N96/2025.06.04/OCFF_1850_cmip7.anc
              - /g/data/vk83/prerelease/configurations/inputs/access-esm1p6/modern/pre-industrial/atmosphere/aerosol/global.N96/2025.06.04/BC_1850_cmip7.anc

          - name: ocean
            model: mom
            ncpus: 392
            exe: mom5_access_cm 
            input:
                # Biogeochemistry
              - /g/data/vk83/configurations/inputs/access-esm1p5/modern/share/ocean/biogeochemistry/global.1deg/2020.05.19/dust.nc
              - /g/data/vk83/configurations/inputs/access-esm1p5/modern/share/ocean/biogeochemistry/global.1deg/2020.05.19/ocmip2_press_monthly_om1p5_bc.nc

  Parameter_block3:
  # Follows pattern 1 single inventory broadcast to all branches, with per-branch differences
  # Pattern 3: but there is no need to write the full inventory because of the positional indexing is enabled in 
  # https://github.com/ACCESS-NRI/access-experiment-generator/commit/ad775f75564ca1267a7339e81bcdf5d6ffbba1e8
  # ‼️ Note: in the list of lists format, make sure each inner list has the same order of the original files.
    branches: 
      - perturb_1c
      - perturb_2c
      - perturb_3c

    config.yaml:
      submodels:
        - - ncpus: [104, 208, 416] # atmosphere core counts for three branches
          - ncpus: [196, 392, 784] # ocean core counts for three branches
          - ncpus: [32, 64, 128] # ice core counts for three branches
      # Then the rest of the inventory remains the same as the control branch, this is useful specific for scaling studies,
      # e.g. in https://github.com/ACCESS-NRI/access-models-scaling