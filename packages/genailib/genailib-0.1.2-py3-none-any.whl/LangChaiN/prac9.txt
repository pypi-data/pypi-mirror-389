# --- Practical 9: SURF and HOG Feature Descriptor ---
#!pip install opencv-python opencv-contrib-python numpy matplotlib

import cv2, numpy as np, matplotlib.pyplot as plt, os

# --- Step 1: Load your image if available, else create a synthetic one ---
path = "road.jpg"
if os.path.exists(path):
    print("‚úÖ Custom image found! Using your image.")
    img = cv2.imread(path, cv2.IMREAD_GRAYSCALE)
else:
    print("‚ö†Ô∏è No image found. Using synthetic grayscale image instead.")
    img = np.zeros((256, 256), np.uint8)
    cv2.rectangle(img, (50, 50), (200, 200), 255, -1)  # white square
    cv2.circle(img, (128, 128), 40, 0, -1)             # black circle inside

# -------------------------------------------------------------
# 1Ô∏è‚É£ SURF (Speeded-Up Robust Features)
# -------------------------------------------------------------
try:
    surf = cv2.xfeatures2d.SURF_create(400)  # Hessian threshold = 400
    keypoints, descriptors = surf.detectAndCompute(img, None)
    img_surf = cv2.drawKeypoints(img, keypoints, None, (0,255,0), 4)

    plt.figure(figsize=(5,5))
    plt.imshow(img_surf, cmap='gray')
    plt.title(f'SURF Keypoints: {len(keypoints)}')
    plt.axis('off')
    plt.show()

    print("‚úÖ SURF Feature Detection Successful")
    print("Number of Keypoints Detected:", len(keypoints))
    print("Descriptor Shape:", descriptors.shape)

except:
    print("‚ùå SURF not available in this OpenCV build (make sure 'opencv-contrib-python' is installed).")

# -------------------------------------------------------------
# 2Ô∏è‚É£ HOG (Histogram of Oriented Gradients)
# -------------------------------------------------------------
hog = cv2.HOGDescriptor()
hog_features = hog.compute(img)

print("\n‚úÖ HOG Descriptor Computed Successfully")
print("HOG Descriptor Shape:", hog_features.shape)


# -------------------------------------------------------------
# üîπ THEORY & EXPLANATION FOR VIVA üîπ
# -------------------------------------------------------------

# üéØ AIM:
# To detect and describe local image features using SURF and HOG descriptors in OpenCV.

# -------------------------------------------------------------
# üß† CONCEPT OVERVIEW:

# ‚û§ Feature Descriptors:
# These are numerical representations of important image regions (edges, corners, textures)
# used for tasks like matching, recognition, and classification.

# -------------------------------------------------------------
# üî∏ 1. SURF (Speeded-Up Robust Features)

# ‚û§ Overview:
#   - Based on SIFT but faster.
#   - Uses **Hessian Matrix** to detect interest points (blobs).
#   - Provides scale and rotation invariance.

# ‚û§ Key Concepts:
#   - Hessian Matrix (H):
#       H(x, y, œÉ) = [[Lxx, Lxy],
#                     [Lxy, Lyy]]
#     where Lxx, Lyy, Lxy are second-order Gaussian derivatives.
#
#   - Points with large determinant |H| are potential keypoints.

# ‚û§ Steps:
#   1Ô∏è‚É£ Interest Point Detection using Hessian Matrix.
#   2Ô∏è‚É£ Orientation Assignment based on Haar wavelet responses.
#   3Ô∏è‚É£ Descriptor Computation using 4x4 sub-regions (each 64-D vector).

# ‚û§ Advantages:
#   - Faster than SIFT.
#   - Robust to scale, rotation, and illumination changes.

# ‚û§ OpenCV Functions:
#   - cv2.xfeatures2d.SURF_create(hessianThreshold)
#   - detectAndCompute(image, mask)
#   - drawKeypoints(image, keypoints, output, color, flags)

# -------------------------------------------------------------
# üî∏ 2. HOG (Histogram of Oriented Gradients)

# ‚û§ Overview:
#   - Describes local object appearance by gradient orientation distribution.
#   - Widely used in **human detection** and **object classification**.

# ‚û§ Steps:
#   1Ô∏è‚É£ Compute gradients (Gx, Gy) for each pixel.
#   2Ô∏è‚É£ Calculate gradient magnitude and orientation.
#   3Ô∏è‚É£ Divide the image into cells (e.g., 8√ó8 pixels).
#   4Ô∏è‚É£ For each cell, build histogram of gradient directions (bins = 0¬∞‚Äì180¬∞).
#   5Ô∏è‚É£ Normalize over blocks for lighting invariance.

# ‚û§ Mathematical Formulas:
#   Gx = ‚àÇI/‚àÇx,   Gy = ‚àÇI/‚àÇy
#   Magnitude = ‚àö(Gx¬≤ + Gy¬≤)
#   Orientation = tan‚Åª¬π(Gy / Gx)

# ‚û§ OpenCV Function:
#   - cv2.HOGDescriptor() ‚Üí creates a HOG descriptor object.
#   - .compute(image) ‚Üí returns HOG feature vector.

# -------------------------------------------------------------
# üß© CODE EXPLANATION:

# 1Ô∏è‚É£ Load grayscale image (real or synthetic).
# 2Ô∏è‚É£ Apply SURF:
#     - Detect keypoints (features of interest).
#     - Compute 64D or 128D descriptors.
#     - Draw detected points in green.
# 3Ô∏è‚É£ Apply HOG:
#     - Compute gradient-based features.
#     - Returns a long vector of features for classification tasks.
# 4Ô∏è‚É£ Display outputs and descriptor details.

# -------------------------------------------------------------
# üìò OUTPUT DESCRIPTION:

# ‚û§ SURF Keypoints:
#     - Displayed as green circles with size and orientation.
#     - len(keypoints): Number of features detected.
#     - descriptors.shape: (number of keypoints, 64 or 128)

# ‚û§ HOG Descriptor:
#     - Printed as a long feature vector of shape (N, 1)
#     - Represents local gradient patterns.

# -------------------------------------------------------------
# üí° APPLICATIONS:

# - Object and face recognition
# - Image retrieval and matching
# - Human detection (especially HOG)
# - Robotics and navigation
# - Computer vision pipelines for scene analysis

# -------------------------------------------------------------
# üó£Ô∏è VIVA QUESTIONS:

# Q1. What does SURF stand for?
#     ‚Üí Speeded-Up Robust Features.

# Q2. What is the main advantage of SURF over SIFT?
#     ‚Üí SURF uses integral images and approximations to compute faster.

# Q3. What is the Hessian Matrix used for in SURF?
#     ‚Üí To find blob-like structures (keypoints) by detecting curvature changes.

# Q4. What does HOG stand for?
#     ‚Üí Histogram of Oriented Gradients.

# Q5. What are the main advantages of HOG?
#     ‚Üí Simple, effective, and robust for object detection (especially pedestrians).

# Q6. What is the difference between SURF and HOG?
#     ‚Üí SURF detects keypoints and descriptors; HOG describes the entire image region.

# Q7. Can SURF and HOG be used together?
#     ‚Üí Yes, combining local (SURF) and global (HOG) features improves recognition accuracy.

# -------------------------------------------------------------
# ‚úÖ RESULT:
# Successfully detected and described features using SURF and HOG descriptors.
# SURF extracted local keypoints and descriptors, while HOG provided gradient-based
# global features representing object appearance. SURF is not included in the default opencv-python package.
#SURF a patented algorithm, so OpenCV moved it under the contrib module (cv2.xfeatures2d).
#Your HOG feature vector contains 51,683,940 elements (‚âà 51 million)
#Each element represents part of the gradient histogram information extracted from your image.
#In simple terms, it‚Äôs a very long 1D vector ‚Äî the numerical description of your image‚Äôs texture and structure.