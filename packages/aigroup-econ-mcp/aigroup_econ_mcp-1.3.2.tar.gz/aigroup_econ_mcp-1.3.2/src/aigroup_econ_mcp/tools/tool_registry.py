"""
å·¥å…·æ³¨å†Œå™¨æ¨¡å—
ç®€åŒ–MCPå·¥å…·çš„æ³¨å†Œå’Œç®¡ç†
"""

from typing import Dict, Any, Optional, List, Callable
from pydantic import Field
from typing import Annotated

from .base import with_file_support_decorator as econometric_tool


# æ ‡å‡†æ–‡ä»¶è¾“å…¥å‚æ•°å®šä¹‰
FILE_INPUT_PARAMS = {
    "file_content": Annotated[
        Optional[str],
        Field(
            default=None,
            description="""CSVã€JSONæˆ–TXTæ–‡ä»¶å†…å®¹

ğŸ“ æ”¯æŒæ ¼å¼ï¼š
- CSV: å¸¦è¡¨å¤´çš„åˆ—æ•°æ®ï¼Œè‡ªåŠ¨æ£€æµ‹åˆ†éš”ç¬¦ï¼ˆé€—å·ã€åˆ¶è¡¨ç¬¦ã€åˆ†å·ç­‰ï¼‰
- JSON: {"å˜é‡å": [æ•°æ®], ...} æˆ– [{"å˜é‡1": å€¼, ...}, ...]
- TXT: æ”¯æŒå¤šç§æ ¼å¼
  * å•åˆ—æ•°å€¼ï¼šæ¯è¡Œä¸€ä¸ªæ•°å€¼
  * å¤šåˆ—æ•°å€¼ï¼šç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦åˆ†éš”ï¼Œå¯å¸¦è¡¨å¤´
  * é”®å€¼å¯¹ï¼šå˜é‡å: å€¼åˆ—è¡¨ æˆ– å˜é‡å = å€¼åˆ—è¡¨

ğŸ’¡ ä½¿ç”¨æ–¹å¼ï¼š
- æä¾›æ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²ï¼ˆå¯ä»¥æ˜¯base64ç¼–ç ï¼‰
- ç³»ç»Ÿä¼šè‡ªåŠ¨è§£æå¹¶è¯†åˆ«å˜é‡å’Œæ•°æ®æ ¼å¼
- ä¼˜å…ˆä½¿ç”¨file_contentï¼Œå¦‚æœæä¾›åˆ™å¿½ç•¥å…¶ä»–æ•°æ®å‚æ•°
- ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥æ–‡ä»¶è·¯å¾„ï¼ˆ.csv/.json/.txtï¼‰

ğŸ“ ç¤ºä¾‹ï¼š
CSV: "å˜é‡1,å˜é‡2\\n1.2,3.4\\n2.3,4.5"
JSON: "{\\"x\\": [1,2,3], \\"y\\": [4,5,6]}"
TXTå•åˆ—: "1.5\\n2.3\\n3.1"
TXTå¤šåˆ—: "x y\\n1 2\\n3 4"
TXTé”®å€¼å¯¹: "x: 1 2 3\\ny: 4 5 6"
"""
        )
    ],
    "file_format": Annotated[
        str,
        Field(
            default="auto",
            description="""æ–‡ä»¶æ ¼å¼ç±»å‹

å¯é€‰å€¼ï¼š
- "auto": è‡ªåŠ¨æ£€æµ‹ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰- æ ¹æ®æ–‡ä»¶å†…å®¹æ™ºèƒ½è¯†åˆ«æ ¼å¼
- "csv": CSVæ ¼å¼ - é€—å·ã€åˆ¶è¡¨ç¬¦æˆ–åˆ†å·åˆ†éš”çš„è¡¨æ ¼æ•°æ®
- "json": JSONæ ¼å¼ - ç»“æ„åŒ–JSONæ•°æ®
- "txt": TXTæ ¼å¼ - çº¯æ–‡æœ¬æ•°æ®ï¼Œæ”¯æŒå¤šç§å­æ ¼å¼

ğŸ” è‡ªåŠ¨æ£€æµ‹è§„åˆ™ï¼š
1. å°è¯•è§£æJSONæ ¼å¼
2. æ£€æµ‹CSVç‰¹å¾ï¼ˆé€—å·ã€åˆ¶è¡¨ç¬¦ï¼‰
3. æ£€æµ‹TXTç‰¹å¾ï¼ˆçº¯æ•°å€¼ã€é”®å€¼å¯¹ã€ç©ºæ ¼åˆ†éš”ï¼‰
4. æ ¹æ®æ–‡ä»¶æ‰©å±•åï¼ˆ.csv/.json/.txtï¼‰

ğŸ’¡ å»ºè®®ï¼š
- å¤§å¤šæ•°æƒ…å†µä½¿ç”¨"auto"å³å¯
- å½“è‡ªåŠ¨æ£€æµ‹å¤±è´¥æ—¶ï¼Œæ‰‹åŠ¨æŒ‡å®šæ ¼å¼
- TXTæ ¼å¼ä¼šè‡ªåŠ¨è¯†åˆ«å…·ä½“å­æ ¼å¼ï¼ˆå•åˆ—/å¤šåˆ—/é”®å€¼å¯¹ï¼‰"""
        )
    ]
}


class ToolConfig:
    """å·¥å…·é…ç½®ç±»"""
    
    def __init__(
        self,
        name: str,
        impl_func: Callable,
        tool_type: str,
        description: str = "",
        extra_params: Dict[str, Any] = None
    ):
        self.name = name
        self.impl_func = impl_func
        self.tool_type = tool_type
        self.description = description
        self.extra_params = extra_params or {}


def create_tool_wrapper(config: ToolConfig):
    """
    åˆ›å»ºå·¥å…·åŒ…è£…å™¨ï¼Œè‡ªåŠ¨æ·»åŠ æ–‡ä»¶è¾“å…¥æ”¯æŒ
    
    Args:
        config: å·¥å…·é…ç½®å¯¹è±¡
    
    Returns:
        åŒ…è£…åçš„å·¥å…·å‡½æ•°
    """
    @econometric_tool(config.tool_type)
    async def tool_wrapper(ctx, **kwargs):
        """åŠ¨æ€ç”Ÿæˆçš„å·¥å…·åŒ…è£…å™¨"""
        # è°ƒç”¨å®é™…çš„å®ç°å‡½æ•°
        return await config.impl_func(ctx, **kwargs)
    
    # è®¾ç½®å‡½æ•°åå’Œæ–‡æ¡£
    tool_wrapper.__name__ = config.name
    tool_wrapper.__doc__ = config.description
    
    return tool_wrapper


# å·¥å…·ç±»å‹åˆ°å‚æ•°æ˜ å°„
TOOL_TYPE_PARAMS = {
    "multi_var_dict": {
        "data": Annotated[
            Optional[Dict[str, List[float]]],
            Field(
                default=None, 
                description="""å¤šå˜é‡æ•°æ®å­—å…¸

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- é”®ï¼šå˜é‡åï¼ˆå­—ç¬¦ä¸²ï¼‰
- å€¼ï¼šæ•°å€¼åˆ—è¡¨ï¼ˆæµ®ç‚¹æ•°æ•°ç»„ï¼‰
- ç»“æ„ï¼š{"å˜é‡1": [å€¼1, å€¼2, ...], "å˜é‡2": [å€¼1, å€¼2, ...]}

ğŸ“ è¦æ±‚ï¼š
- æ‰€æœ‰å˜é‡çš„æ•°æ®é•¿åº¦å¿…é¡»ç›¸åŒ
- æ•°å€¼å¿…é¡»æ˜¯æµ®ç‚¹æ•°æˆ–å¯è½¬æ¢ä¸ºæµ®ç‚¹æ•°
- å˜é‡åå»ºè®®ä½¿ç”¨æœ‰æ„ä¹‰çš„æè¿°æ€§åç§°
- è‡³å°‘éœ€è¦1ä¸ªå˜é‡

ğŸ’¡ ç¤ºä¾‹ï¼š
{"GDP": [100.5, 102.3, 104.1], "CPI": [2.1, 2.3, 2.2]}

ğŸ”§ ç”¨é€”ï¼š
- æè¿°æ€§ç»Ÿè®¡åˆ†æ
- ç›¸å…³æ€§åˆ†æ
- å¤šå˜é‡æ—¶é—´åºåˆ—åˆ†æ"""
            )
        ]
    },
    "regression": {
        "y_data": Annotated[
            Optional[List[float]],
            Field(
                default=None, 
                description="""å› å˜é‡ï¼ˆè¢«è§£é‡Šå˜é‡ï¼‰æ•°æ®

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- ä¸€ç»´æ•°å€¼åˆ—è¡¨
- å…ƒç´ ç±»å‹ï¼šæµ®ç‚¹æ•°
- é•¿åº¦ï¼šå¿…é¡»ä¸x_dataçš„è§‚æµ‹æ•°ä¸€è‡´

ğŸ“ è¦æ±‚ï¼š
- ä¸èƒ½åŒ…å«ç¼ºå¤±å€¼ï¼ˆNaNï¼‰
- å»ºè®®æ•°æ®å·²åšé€‚å½“çš„é¢„å¤„ç†
- è‡³å°‘éœ€è¦ n+2 ä¸ªè§‚æµ‹ï¼ˆnä¸ºè‡ªå˜é‡ä¸ªæ•°ï¼‰

ğŸ’¡ ç¤ºä¾‹ï¼š
[12.5, 13.2, 14.1, 13.8, 15.0]  # é”€å”®é¢æ•°æ®

ğŸ”§ ç”¨é€”ï¼š
- OLSå›å½’åˆ†æçš„è¢«è§£é‡Šå˜é‡
- æœºå™¨å­¦ä¹ å›å½’çš„ç›®æ ‡å˜é‡
- å„ç±»å›å½’æ¨¡å‹çš„é¢„æµ‹ç›®æ ‡"""
            )
        ],
        "x_data": Annotated[
            Optional[List[List[float]]],
            Field(
                default=None, 
                description="""è‡ªå˜é‡ï¼ˆè§£é‡Šå˜é‡ï¼‰æ•°æ®çŸ©é˜µ

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- äºŒç»´æ•°å€¼åˆ—è¡¨
- å¤–å±‚åˆ—è¡¨ï¼šæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªè§‚æµ‹
- å†…å±‚åˆ—è¡¨ï¼šæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªè‡ªå˜é‡çš„å€¼
- ç»“æ„ï¼š[[x1_1, x2_1, ...], [x1_2, x2_2, ...], ...]

ğŸ“ è¦æ±‚ï¼š
- è¡Œæ•°ï¼ˆè§‚æµ‹æ•°ï¼‰å¿…é¡»ä¸y_dataé•¿åº¦ä¸€è‡´
- åˆ—æ•°ï¼ˆå˜é‡æ•°ï¼‰å¿…é¡»åœ¨æ‰€æœ‰è¡Œä¿æŒä¸€è‡´
- ä¸èƒ½åŒ…å«ç¼ºå¤±å€¼
- æ•°å€¼å‹å˜é‡ï¼Œåˆ†ç±»å˜é‡éœ€è¦å…ˆç¼–ç 

ğŸ’¡ ç¤ºä¾‹ï¼š
[[100, 50, 3],    # è§‚æµ‹1: å¹¿å‘Šæ”¯å‡º=100, ä»·æ ¼=50, ç«äº‰è€…=3
 [120, 48, 3],    # è§‚æµ‹2: å¹¿å‘Šæ”¯å‡º=120, ä»·æ ¼=48, ç«äº‰è€…=3
 [110, 52, 4]]    # è§‚æµ‹3: å¹¿å‘Šæ”¯å‡º=110, ä»·æ ¼=52, ç«äº‰è€…=4

ğŸ”§ ç”¨é€”ï¼š
- OLSå›å½’çš„è‡ªå˜é‡çŸ©é˜µ
- æœºå™¨å­¦ä¹ æ¨¡å‹çš„ç‰¹å¾çŸ©é˜µ
- å¤šå…ƒå›å½’åˆ†æçš„è§£é‡Šå˜é‡"""
            )
        ],
        "feature_names": Annotated[
            Optional[List[str]],
            Field(
                default=None, 
                description="""è‡ªå˜é‡åç§°åˆ—è¡¨

ğŸ“ æ ¼å¼ï¼š
- å­—ç¬¦ä¸²åˆ—è¡¨
- é•¿åº¦å¿…é¡»ä¸x_dataçš„åˆ—æ•°ä¸€è‡´
- å»ºè®®ä½¿ç”¨æè¿°æ€§åç§°

ğŸ’¡ ç¤ºä¾‹ï¼š
["å¹¿å‘Šæ”¯å‡º", "ä»·æ ¼", "ç«äº‰å¯¹æ‰‹æ•°é‡", "ä¿ƒé”€æ´»åŠ¨"]

ğŸ”§ ç”¨é€”ï¼š
- æé«˜ç»“æœå¯è¯»æ€§
- ä¾¿äºè§£é‡Šæ¨¡å‹ç³»æ•°
- ç”¨äºç”Ÿæˆå¯è§†åŒ–æ ‡ç­¾
- å¦‚æœä¸æä¾›ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆï¼ˆx1, x2, x3...ï¼‰

âš ï¸ æ³¨æ„ï¼š
- é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦
- ä¸­è‹±æ–‡å‡å¯
- å»ºè®®ç®€æ´æ˜äº†"""
            )
        ]
    },
    "single_var": {
        "data": Annotated[
            Optional[List[float]],
            Field(
                default=None, 
                description="""å•å˜é‡æ—¶é—´åºåˆ—æ•°æ®

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- ä¸€ç»´æ•°å€¼åˆ—è¡¨
- æŒ‰æ—¶é—´é¡ºåºæ’åˆ—
- å…ƒç´ ç±»å‹ï¼šæµ®ç‚¹æ•°

ğŸ“ è¦æ±‚ï¼š
- æ•°æ®å¿…é¡»æŒ‰æ—¶é—´é¡ºåºæ’åˆ—
- ä¸èƒ½åŒ…å«ç¼ºå¤±å€¼
- å»ºè®®æ—¶é—´é—´éš”å‡åŒ€ï¼ˆç­‰é—´éš”ï¼‰
- è‡³å°‘éœ€è¦5ä¸ªè§‚æµ‹ç‚¹è¿›è¡ŒåŸºæœ¬åˆ†æ
- å¤æ‚æ¨¡å‹ï¼ˆå¦‚ARIMAï¼‰å»ºè®®30+è§‚æµ‹ç‚¹

ğŸ’¡ ç¤ºä¾‹ï¼š
[100.5, 102.3, 101.8, 103.5, 104.2, 103.8, 105.1]  # è‚¡ç¥¨ä»·æ ¼åºåˆ—

ğŸ”§ ç”¨é€”ï¼š
- æ—¶é—´åºåˆ—åˆ†æ
- å¹³ç¨³æ€§æ£€éªŒï¼ˆADFã€KPSSï¼‰
- è‡ªç›¸å…³åˆ†æï¼ˆACFã€PACFï¼‰
- ARIMA/GARCHæ¨¡å‹
- é¢„æµ‹å’Œè¶‹åŠ¿åˆ†æ

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
- ç¡®ä¿æ•°æ®æŒ‰æ—¶é—´é¡ºåº
- å¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼
- è€ƒè™‘å­£èŠ‚æ€§è°ƒæ•´
- æ£€æŸ¥æ•°æ®å¹³ç¨³æ€§"""
            )
        ]
    },
    "panel": {
        "y_data": Annotated[
            Optional[List[float]],
            Field(
                default=None, 
                description="""é¢æ¿æ•°æ®å› å˜é‡

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- ä¸€ç»´æ•°å€¼åˆ—è¡¨
- åŒ…å«æ‰€æœ‰ä¸ªä½“æ‰€æœ‰æ—¶æœŸçš„è§‚æµ‹
- é•¿åº¦ = ä¸ªä½“æ•° Ã— æ—¶æœŸæ•°

ğŸ“ æ’åˆ—æ–¹å¼ï¼ˆå¯é€‰å…¶ä¸€ï¼‰ï¼š
1. æŒ‰ä¸ªä½“æ’åˆ—ï¼š[ä¸ªä½“1çš„æ‰€æœ‰æ—¶æœŸ, ä¸ªä½“2çš„æ‰€æœ‰æ—¶æœŸ, ...]
2. æŒ‰æ—¶æœŸæ’åˆ—ï¼š[æ—¶æœŸ1çš„æ‰€æœ‰ä¸ªä½“, æ—¶æœŸ2çš„æ‰€æœ‰ä¸ªä½“, ...]
3. éœ€ä¸entity_idså’Œtime_periodsçš„æ’åˆ—æ–¹å¼ä¸€è‡´

ğŸ’¡ ç¤ºä¾‹ï¼ˆ3ä¸ªå…¬å¸ï¼Œ2ä¸ªå¹´ä»½ï¼‰ï¼š
[1000, 1100, 800, 900, 1200, 1300]  # æŒ‰ä¸ªä½“æ’åˆ—
å…¬å¸1: 2020=1000, 2021=1100
å…¬å¸2: 2020=800,  2021=900
å…¬å¸3: 2020=1200, 2021=1300

ğŸ”§ ç”¨é€”ï¼š
- å›ºå®šæ•ˆåº”æ¨¡å‹
- éšæœºæ•ˆåº”æ¨¡å‹
- é¢æ¿æ•°æ®å›å½’åˆ†æ"""
            )
        ],
        "x_data": Annotated[
            Optional[List[List[float]]],
            Field(
                default=None, 
                description="""é¢æ¿æ•°æ®è‡ªå˜é‡çŸ©é˜µ

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- äºŒç»´æ•°å€¼åˆ—è¡¨
- è¡Œæ•° = ä¸ªä½“æ•° Ã— æ—¶æœŸæ•°
- åˆ—æ•° = è‡ªå˜é‡ä¸ªæ•°
- æ’åˆ—é¡ºåºå¿…é¡»ä¸y_dataä¸€è‡´

ğŸ“ è¦æ±‚ï¼š
- ä¸y_dataçš„è§‚æµ‹é¡ºåºå®Œå…¨å¯¹åº”
- æ‰€æœ‰è¡Œçš„åˆ—æ•°å¿…é¡»ç›¸åŒ
- ä¸èƒ½åŒ…å«ç¼ºå¤±å€¼

ğŸ’¡ ç¤ºä¾‹ï¼ˆ3ä¸ªå…¬å¸ï¼Œ2å¹´ï¼Œ2ä¸ªè‡ªå˜é‡ï¼‰ï¼š
[[50, 100],   # å…¬å¸1-2020: å‘˜å·¥=50, æŠ•èµ„=100
 [52, 110],   # å…¬å¸1-2021: å‘˜å·¥=52, æŠ•èµ„=110
 [40, 80],    # å…¬å¸2-2020
 [42, 90],    # å…¬å¸2-2021
 [60, 150],   # å…¬å¸3-2020
 [62, 160]]   # å…¬å¸3-2021

ğŸ”§ ç”¨é€”ï¼š
- é¢æ¿å›å½’çš„è§£é‡Šå˜é‡
- æ§åˆ¶æ—¶å˜ç‰¹å¾"""
            )
        ],
        "entity_ids": Annotated[
            Optional[List[str]],
            Field(
                default=None, 
                description="""ä¸ªä½“æ ‡è¯†ç¬¦åˆ—è¡¨

ğŸ“ æ ¼å¼ï¼š
- å­—ç¬¦ä¸²åˆ—è¡¨
- æ ‡è¯†æ¯ä¸ªè§‚æµ‹æ‰€å±çš„ä¸ªä½“ï¼ˆå¦‚å…¬å¸ã€å›½å®¶ã€ä¸ªäººï¼‰
- é•¿åº¦ = y_dataé•¿åº¦

ğŸ“Š è¦æ±‚ï¼š
- æ¯ä¸ªä¸ªä½“çš„æ ‡è¯†ç¬¦åœ¨æ‰€æœ‰æ—¶æœŸä¿æŒä¸€è‡´
- ä¸y_dataã€x_dataçš„é¡ºåºå®Œå…¨å¯¹åº”
- å»ºè®®ä½¿ç”¨æ¸…æ™°çš„æ ‡è¯†ç¬¦

ğŸ’¡ ç¤ºä¾‹ï¼ˆ3ä¸ªå…¬å¸ï¼Œå„2å¹´ï¼‰ï¼š
["å…¬å¸A", "å…¬å¸A", "å…¬å¸B", "å…¬å¸B", "å…¬å¸C", "å…¬å¸C"]
æˆ–
["1", "1", "2", "2", "3", "3"]

ğŸ”§ ç”¨é€”ï¼š
- è¯†åˆ«é¢æ¿æ•°æ®çš„æ¨ªæˆªé¢ç»´åº¦
- è®¡ç®—å›ºå®šæ•ˆåº”
- åˆ†ç»„å’Œèšåˆ
- Hausmanæ£€éªŒ

âš ï¸ æ³¨æ„ï¼š
- IDå¯ä»¥æ˜¯æ•°å­—æˆ–å­—ç¬¦ä¸²
- ä½†å¿…é¡»ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ å…¥
- ä¿æŒæ ¼å¼ä¸€è‡´æ€§"""
            )
        ],
        "time_periods": Annotated[
            Optional[List[str]],
            Field(
                default=None, 
                description="""æ—¶é—´æ ‡è¯†ç¬¦åˆ—è¡¨

ğŸ“ æ ¼å¼ï¼š
- å­—ç¬¦ä¸²åˆ—è¡¨
- æ ‡è¯†æ¯ä¸ªè§‚æµ‹æ‰€å±çš„æ—¶æœŸ
- é•¿åº¦ = y_dataé•¿åº¦

ğŸ“Š è¦æ±‚ï¼š
- æ¯ä¸ªæ—¶æœŸçš„æ ‡è¯†ç¬¦åœ¨æ‰€æœ‰ä¸ªä½“ä¿æŒä¸€è‡´
- ä¸y_dataã€x_dataçš„é¡ºåºå®Œå…¨å¯¹åº”
- å»ºè®®ä½¿ç”¨æ ‡å‡†æ—¶é—´æ ¼å¼

ğŸ’¡ ç¤ºä¾‹ï¼ˆ3ä¸ªå…¬å¸ï¼Œå„2å¹´ï¼‰ï¼š
["2020", "2021", "2020", "2021", "2020", "2021"]
æˆ–
["2020-01", "2020-02", "2020-01", "2020-02", "2020-01", "2020-02"]

ğŸ”§ ç”¨é€”ï¼š
- è¯†åˆ«é¢æ¿æ•°æ®çš„æ—¶é—´ç»´åº¦
- è®¡ç®—æ—¶é—´å›ºå®šæ•ˆåº”
- è¯†åˆ«æ—¶é—´è¶‹åŠ¿
- é¢æ¿å•ä½æ ¹æ£€éªŒ

âš ï¸ æ³¨æ„ï¼š
- å¯ä»¥æ˜¯å¹´ä»½ã€å­£åº¦ã€æœˆä»½ç­‰
- å¿…é¡»ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ å…¥
- ä¿æŒæ ¼å¼ç»Ÿä¸€"""
            )
        ],
        "feature_names": Annotated[
            Optional[List[str]],
            Field(
                default=None, 
                description="""è‡ªå˜é‡åç§°åˆ—è¡¨ï¼ˆåŒregressionç±»å‹ï¼‰

ğŸ“ æ ¼å¼ï¼š
- å­—ç¬¦ä¸²åˆ—è¡¨
- é•¿åº¦ = x_dataçš„åˆ—æ•°

ğŸ’¡ ç¤ºä¾‹ï¼š
["å‘˜å·¥æ•°", "ç ”å‘æŠ•èµ„", "å¸‚åœºä»½é¢", "è¡Œä¸šé›†ä¸­åº¦"]

ğŸ”§ ç”¨é€”ï¼š
- æé«˜ç»“æœå¯è¯»æ€§
- ä¾¿äºè§£é‡Šå›å½’ç³»æ•°
- å¦‚ä¸æä¾›ä¼šè‡ªåŠ¨ç”Ÿæˆ"""
            )
        ]
    },
    "time_series": {
        "data": Annotated[
            Optional[Dict[str, List[float]]],
            Field(
                default=None, 
                description="""å¤šå˜é‡æ—¶é—´åºåˆ—æ•°æ®å­—å…¸

ğŸ“Š æ•°æ®æ ¼å¼ï¼š
- é”®ï¼šå˜é‡åï¼ˆå­—ç¬¦ä¸²ï¼‰
- å€¼ï¼šæ—¶é—´åºåˆ—æ•°æ®ï¼ˆæµ®ç‚¹æ•°åˆ—è¡¨ï¼‰
- æ‰€æœ‰å˜é‡é•¿åº¦å¿…é¡»ç›¸åŒ
- æ•°æ®æŒ‰æ—¶é—´é¡ºåºæ’åˆ—

ğŸ“ è¦æ±‚ï¼š
- è‡³å°‘2ä¸ªå˜é‡ï¼ˆVARã€VECMæ¨¡å‹ï¼‰
- å•å˜é‡è¯·ä½¿ç”¨single_varç±»å‹
- æ‰€æœ‰åºåˆ—ç­‰é•¿ä¸”æŒ‰æ—¶é—´å¯¹é½
- æ—¶é—´é—´éš”å‡åŒ€
- VARæ¨¡å‹å»ºè®®40+è§‚æµ‹
- VECMæ¨¡å‹å»ºè®®60+è§‚æµ‹

ğŸ’¡ ç¤ºä¾‹ï¼š
{
    "GDP": [100.5, 102.3, 104.1, 105.8],     # GDPå¢é•¿ç‡åºåˆ—
    "CPI": [2.1, 2.3, 2.2, 2.4],             #  CPIé€šèƒ€ç‡åºåˆ—
    "åˆ©ç‡": [3.5, 3.6, 3.4, 3.7]             # åˆ©ç‡åºåˆ—
}

ğŸ”§ ç”¨é€”ï¼š
- VARæ¨¡å‹åˆ†æ
- VECMæ¨¡å‹åˆ†æ
- è„‰å†²å“åº”å‡½æ•°
- æ–¹å·®åˆ†è§£
- Grangerå› æœæ£€éªŒ
- åæ•´åˆ†æ

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
- ç¡®ä¿æ‰€æœ‰åºåˆ—æ—¶é—´å¯¹é½
- æ£€æŸ¥åºåˆ—å¹³ç¨³æ€§
- VARè¦æ±‚æ‰€æœ‰åºåˆ—å¹³ç¨³
- VECMå…è®¸éå¹³ç¨³åºåˆ—ï¼ˆéœ€åæ•´ï¼‰
- æ³¨æ„æ»åé˜¶æ•°é€‰æ‹©"""
            )
        ]
    }
}


def get_tool_params(tool_type: str, extra_params: Dict[str, Any] = None) -> Dict[str, Any]:
    """
    è·å–å·¥å…·çš„å®Œæ•´å‚æ•°å®šä¹‰
    
    Args:
        tool_type: å·¥å…·ç±»å‹
        extra_params: é¢å¤–çš„å‚æ•°å®šä¹‰
    
    Returns:
        å®Œæ•´çš„å‚æ•°å­—å…¸
    """
    params = {}
    
    # æ·»åŠ åŸºç¡€å‚æ•°
    if tool_type in TOOL_TYPE_PARAMS:
        params.update(TOOL_TYPE_PARAMS[tool_type])
    
    # æ·»åŠ æ–‡ä»¶è¾“å…¥å‚æ•°
    params.update(FILE_INPUT_PARAMS)
    
    # æ·»åŠ é¢å¤–å‚æ•°
    if extra_params:
        params.update(extra_params)
    
    return params