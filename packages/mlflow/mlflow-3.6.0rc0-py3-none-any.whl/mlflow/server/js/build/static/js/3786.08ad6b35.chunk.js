"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[3786],{14429:function(e,t,n){n.d(t,{UY:function(){return m},VA:function(){return c},oy:function(){return d},vF:function(){return o}});var i=n(46709),a=n(91105),r=n(79444);const o="startTimeLabel",s="startTime",l="endTime",d="LAST_7_DAYS",c=()=>{var e;const t=(0,r.U)(),[n,c]=(0,a.ok)(),u=n.get(o)||d;let g=n.get(s)||void 0,p=null!==(e=n.get(l))&&void 0!==e?e:void 0;if("CUSTOM"!==u){const e=m(t.dateNow,{startTimeLabel:u});g=e.startTime,p=e.endTime}else{var f;g=n.get(s)||void 0,p=null!==(f=n.get(l))&&void 0!==f?f:void 0}const T=(0,i.useMemo)((()=>({startTimeLabel:u,startTime:g,endTime:p})),[u,g,p]),h=(0,i.useCallback)(((e,t=!1)=>{c((t=>(void 0===(null===e||void 0===e?void 0:e.startTime)?t.delete(s):"CUSTOM"===e.startTimeLabel&&t.set(s,e.startTime),void 0===(null===e||void 0===e?void 0:e.endTime)?t.delete(l):"CUSTOM"===e.startTimeLabel&&t.set(l,e.endTime),void 0===(null===e||void 0===e?void 0:e.startTimeLabel)?t.delete(o):t.set(o,e.startTimeLabel),t)),{replace:t})}),[c]);return[T,h]};function m(e,t){return t.startTimeLabel&&"CUSTOM"!==t.startTimeLabel?function(e,t){switch(t){case"LAST_HOUR":return{startTime:new Date(new Date(e).setUTCHours((new Date).getUTCHours()-1)).toISOString(),endTime:e.toISOString()};case"LAST_24_HOURS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-1)).toISOString(),endTime:e.toISOString()};case"LAST_7_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-7)).toISOString(),endTime:e.toISOString()};case"LAST_30_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-30)).toISOString(),endTime:e.toISOString()};case"LAST_YEAR":return{startTime:new Date(new Date(e).setUTCFullYear((new Date).getUTCFullYear()-1)).toISOString(),endTime:e.toISOString()};case"ALL":return{startTime:void 0,endTime:e.toISOString()};default:throw new Error(`Unexpected start time label: ${t}`)}}(e,t.startTimeLabel):{startTime:t.startTime,endTime:t.endTime}}},33786:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var i=n(68248),a=n(91113),r=n(55570),o=n(42747),s=n(33908),l=n(91105),d=n(59930),c=n.n(d),m=n(54741),u=n(46709),g=n(43979),p=n(23125),f=n(27757),T=n(74060),h=n(73408);const v=({traces:e,selectedTurnIndex:t,setSelectedTurnIndex:n,setSelectedTrace:a})=>{const{theme:r}=(0,f.u)();return e?(0,h.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",minHeight:0,width:200,borderRight:`1px solid ${r.colors.border}`,gap:r.spacing.xs,paddingTop:r.spacing.sm,paddingRight:r.spacing.sm},""),children:e.map(((e,o)=>(0,h.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",gap:r.spacing.sm,backgroundColor:t===o?r.colors.actionDefaultBackgroundHover:void 0,padding:r.spacing.xs,borderRadius:r.borders.borderRadiusSm,cursor:"pointer"},""),onMouseEnter:()=>n(o),onClick:()=>a(e),children:[(0,h.Y)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",justifyContent:"center",width:r.general.iconSize,height:r.general.iconSize,borderRadius:r.borders.borderRadiusSm,backgroundColor:r.colors.backgroundSecondary},""),children:(0,h.Y)(T.ChainIcon,{color:"ai"})}),(0,h.FD)(f.T.Text,{children:["Turn ",o+1]})]},(0,p.getModelTraceId)(e))))}):null};var S={name:"xjt14x",styles:"width:60%"},x={name:"2ji30f",styles:"width:80%"},w={name:"maimdf",styles:"width:70%"};const D=()=>{const{theme:e}=(0,f.u)();return(0,h.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",minHeight:0,width:200,borderRight:`1px solid ${e.colors.border}`,gap:e.spacing.xs,paddingTop:e.spacing.sm,paddingRight:e.spacing.sm},""),children:[(0,h.Y)(T.TitleSkeleton,{css:S}),(0,h.Y)(T.TitleSkeleton,{css:x}),(0,h.Y)(T.TitleSkeleton,{css:w})]})};var b=n(31655),y=n(69986),I=n(48785);const L=({traces:e,selectedTurnIndex:t,setSelectedTurnIndex:n,setSelectedTrace:a})=>{const{theme:r}=(0,f.u)();return e?(0,h.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:0,height:"100%",overflowY:"auto",gap:r.spacing.sm,paddingTop:r.spacing.sm,paddingLeft:r.spacing.sm},""),children:e.map(((e,s)=>{const l=t===s,d=(0,p.getModelTraceId)(e);return(0,h.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",position:"relative",gap:r.spacing.sm,backgroundColor:l?r.colors.actionDefaultBackgroundHover:void 0,padding:r.spacing.md},""),onMouseEnter:()=>n(s),children:[(0,h.Y)(p.SingleChatTurnMessages,{trace:e},d),l&&(0,h.Y)(f.B,{componentId:"mlflow.experiment.chat-session.view-trace",size:"small",color:"primary",css:(0,i.AH)({position:"absolute",top:r.spacing.md,right:r.spacing.md,backgroundColor:r.colors.actionDefaultBackgroundDefault},""),onClick:()=>a(e),children:(0,h.Y)(o.sA,{id:"ynrYyB",defaultMessage:"View trace"})})]},d)}))}):null};var Y={name:"12x64ox",styles:"width:20%"},k={name:"12x64ox",styles:"width:20%"};const C=()=>{const{theme:e}=(0,f.u)();return(0,h.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:0,height:"100%",overflowY:"auto",gap:e.spacing.sm,paddingTop:e.spacing.sm,paddingLeft:e.spacing.sm},""),children:[(0,h.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,width:"60%",alignSelf:"flex-start"},""),children:[(0,h.Y)(T.TitleSkeleton,{css:Y}),[...Array(5).keys()].map((e=>(0,h.Y)(T.ParagraphSkeleton,{seed:`s-${e}`},e)))]}),(0,h.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,width:"60%",alignSelf:"flex-end"},""),children:[(0,h.Y)(T.TitleSkeleton,{css:k}),[...Array(5).keys()].map((e=>(0,h.Y)(T.ParagraphSkeleton,{seed:`s-${e}`},e)))]})]})};const A=({children:e})=>(0,h.Y)(h.FK,{children:e});var M={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},_={name:"1ndun5c",styles:"display:flex;flex:1;min-height:0"},U={name:"1ndun5c",styles:"display:flex;flex:1;min-height:0"};var E=(0,r.X)(a.A.mlflowServices.CHAT_SESSIONS,(()=>{const{theme:e}=(0,f.u)(),{experimentId:t,sessionId:n}=(0,l.g)(),[a,r]=(0,u.useState)(null),[o,d]=(0,u.useState)(null);c()(t,"Experiment ID must be defined"),c()(n,"Session ID must be defined");const{loading:S}=(0,m.L)({experimentId:t,options:{fetchPolicy:"cache-only"}}),x=(0,u.useMemo)((()=>[(0,s.$U)(t)]),[t]),w=(0,u.useMemo)((()=>(0,I._)({sessionId:n})),[n]),{data:Y,isLoading:k}=(0,s.Zn)({locations:x,filters:w,disabled:!1}),E=(0,u.useMemo)((()=>null===Y||void 0===Y?void 0:Y.sort(((e,t)=>new Date(e.request_time).getTime()-new Date(t.request_time).getTime()))),[Y]),H=y.U,{data:O,isLoading:R}=(0,s.Wx)(H,E);return(0,b.$F)()?(0,h.FD)("div",{css:M,children:[(0,h.Y)(g.J,{viewState:"single-chat-session",sessionId:n}),R||k?(0,h.FD)("div",{css:_,children:[(0,h.Y)(D,{}),(0,h.Y)(C,{})]}):(0,h.FD)("div",{css:U,children:[(0,h.Y)(v,{traces:null!==O&&void 0!==O?O:[],selectedTurnIndex:a,setSelectedTurnIndex:r,setSelectedTrace:d}),(0,h.Y)(L,{traces:null!==O&&void 0!==O?O:[],selectedTurnIndex:a,setSelectedTurnIndex:r,setSelectedTrace:d})]}),(0,h.Y)(T.Drawer.Root,{open:null!==o,onOpenChange:e=>{e||d(null)},children:(0,h.Y)(T.Drawer.Content,{componentId:"mlflow.experiment.chat-session.trace-data-drawer",title:o?(0,p.getModelTraceId)(o):"",width:"90vw",expandContentToFullHeight:!0,children:(0,h.Y)("div",{css:(0,i.AH)({height:"100%",marginLeft:-e.spacing.lg,marginRight:-e.spacing.lg,marginBottom:-e.spacing.lg},""),children:(0,h.Y)(A,{children:o&&(0,h.Y)(p.ModelTraceExplorer,{modelTrace:o})})})})})]}):(0,h.Y)("div",{})}),(0,h.Y)(o.sA,{id:"fYtbd8",defaultMessage:"An error occurred while rendering the chat session."}))},43979:function(e,t,n){n.d(t,{J:function(){return s}});var i=n(68248),a=n(27757),r=n(84411),o=n(73408);const s=({viewState:e,sessionId:t})=>{const{theme:n}=(0,a.u)();return(0,o.FD)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${n.colors.grey100}`,paddingBottom:`${n.spacing.sm}px`},""),children:[!("single-chat-session"===e)&&(0,o.Y)(r.$,{}),"single-chat-session"===e&&(0,o.Y)(a.T.Title,{level:3,withoutMargins:!0,children:t})]})}},48785:function(e,t,n){n.d(t,{_:function(){return r}});var i=n(33908),a=n(23125);const r=({sessionId:e})=>[{column:`${i.rc}:${a.SESSION_ID_METADATA_KEY}`,operator:e?i.tl.EQUALS:i.dD.ILIKE,value:null!==e&&void 0!==e?e:"%"}]},54741:function(e,t,n){n.d(t,{L:function(){return r}});var i=n(34794);const a=i.J1`
  query MlflowGetExperimentQuery($input: MlflowGetExperimentInput!) @component(name: "MLflow.ExperimentRunTracking") {
    mlflowGetExperiment(input: $input) {
      apiError {
        code
        message
      }
      experiment {
        artifactLocation
        creationTime
        experimentId
        lastUpdateTime
        lifecycleStage
        name
        tags {
          key
          value
        }
      }
    }
  }
`,r=({experimentId:e,options:t={}})=>{var n;const{data:r,loading:o,error:s,refetch:l}=(0,i.IT)(a,{variables:{input:{experimentId:e}},skip:!e,...t});return{loading:o,data:null===r||void 0===r||null===(n=r.mlflowGetExperiment)||void 0===n?void 0:n.experiment,refetch:l,apolloError:s,apiError:(()=>{var e;return null===r||void 0===r||null===(e=r.mlflowGetExperiment)||void 0===e?void 0:e.apiError})()}}},69986:function(e,t,n){n.d(t,{R:function(){return r},U:function(){return a}});var i=n(12803);async function a(e){var t;if(!e)return;const[n,a]=await Promise.all([i.x.getExperimentTraceInfoV3(e),i.x.getExperimentTraceData(e)]);return a?{info:(null===n||void 0===n||null===(t=n.trace)||void 0===t?void 0:t.trace_info)||{},data:a}:void 0}async function r(e){if(!e)return;const[t,n]=await Promise.all([i.x.getExperimentTraceInfo(e).then((e=>e.trace_info||{})),i.x.getExperimentTraceData(e)]);return n?{info:t,data:n}:void 0}},79444:function(e,t,n){n.d(t,{U:function(){return d},k:function(){return l}});var i=n(76118),a=n(46709),r=n(73408);const o=()=>({dateNow:new Date,lastRefreshTime:Date.now(),refresh:()=>{}}),s=(0,a.createContext)(o()),l=({config:e,children:t})=>{const n=o(),l=(0,i.merge)({},n,e),[d,c]=a.useState(l.lastRefreshTime),m=(0,a.useMemo)((()=>new Date(d)),[d]),u=(0,a.useCallback)((()=>{c(Date.now())}),[]);return(0,r.Y)(s.Provider,{value:{...l,dateNow:m,lastRefreshTime:d,refresh:u},children:t})},d=()=>{const e=(0,a.useContext)(s);return e||o()}},84411:function(e,t,n){n.d(t,{$:function(){return v}});var i=n(68248),a=n(46709),r=n(27757),o=n(74060),s=n(79081),l=n(33908),d=n(42747),c=n(92338),m=n(14429),u=n(76118),g=n(16453),p=n(79444),f=n(39595),T=n(92388),h=n(73408);const v=a.memo((()=>{const e=(0,d.tz)(),{theme:t}=(0,r.u)(),n=(0,f.jE)(),v=(0,T.C)({queryKey:[l.TH]}),[S,x]=(0,m.VA)(),w=(0,a.useMemo)((()=>(0,c.p)(e)),[e]),D=e.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),b=(0,p.U)();return(0,h.FD)("div",{css:(0,i.AH)({display:"flex",gap:t.spacing.sm,alignItems:"center"},""),children:[(0,h.FD)(o.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:D,value:S.startTimeLabel?[S.startTimeLabel]:[m.oy],children:[(0,h.Y)(o.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=w.find((t=>t.key===e)))||void 0===t?void 0:t.label},allowClear:!(0,u.isNil)(S.startTimeLabel)&&S.startTimeLabel!==m.oy,onClear:()=>{x({startTimeLabel:m.oy})},"data-testid":"time-range-select-dropdown"}),(0,h.Y)(o.DialogComboboxContent,{children:(0,h.Y)(o.DialogComboboxOptionList,{children:w.map((e=>(0,h.Y)(o.DialogComboboxOptionListSelectItem,{checked:S.startTimeLabel===e.key||e.key===m.oy&&(0,u.isNil)(S.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{x({...S,startTimeLabel:e.key})},children:e.label},e.key)))})})]}),"CUSTOM"===S.startTimeLabel&&(0,h.Y)(h.FK,{children:(0,h.Y)(g.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(S.startTime),to:S.endTime?new Date(S.endTime):b.dateNow},onChange:e=>{const t=e.target.value;x({...S,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:b.dateNow}},value:S.startTime?new Date(S.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:b.dateNow}},value:S.endTime?new Date(S.endTime):void 0}})}),(0,h.Y)(s.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:b.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,h.Y)(r.B,{type:"link",componentId:"mlflow.experiment-evaluation-monitoring.refresh-date-button",disabled:Boolean(v),onClick:()=>{b.refresh(),(0,l.BL)({queryClient:n})},children:(0,h.Y)(o.RefreshIcon,{})})})]})}))},92338:function(e,t,n){function i(e){return[{key:"LAST_HOUR",label:e.formatMessage({id:"bjoGjg",defaultMessage:"Last hour"})},{key:"LAST_24_HOURS",label:e.formatMessage({id:"JChRnq",defaultMessage:"Last 24 hours"})},{key:"LAST_7_DAYS",label:e.formatMessage({id:"eQsXm7",defaultMessage:"Last 7 days"})},{key:"LAST_30_DAYS",label:e.formatMessage({id:"p1H1KR",defaultMessage:"Last 30 days"})},{key:"LAST_YEAR",label:e.formatMessage({id:"EI7moF",defaultMessage:"Last year"})},{key:"ALL",label:e.formatMessage({id:"HeNa8H",defaultMessage:"All"})},{key:"CUSTOM",label:e.formatMessage({id:"TpmJlu",defaultMessage:"Custom"})}]}n.d(t,{p:function(){return i}})}}]);