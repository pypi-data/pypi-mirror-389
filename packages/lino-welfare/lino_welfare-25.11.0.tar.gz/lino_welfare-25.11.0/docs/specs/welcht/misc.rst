.. doctest docs/specs/welcht/misc.rst
.. _welfare.specs.misc:

=============
Miscellaneous
=============

.. contents::
   :local:
   :depth: 2

.. include:: /../docs/shared/include/tested.rst

>>> from lino import startup
>>> startup('lino_welfare.projects.mathieu.settings.doctests')
>>> from lino.api.doctest import *
>>> ses = rt.login('rolf')


Build all excerpts
===================

..
    Rendering some more excerpts

    These are the excerpts generated by the demo fixtures:

    >> with translation.override('en'):
    ...     ses.show(excerpts.Excerpts, column_names="id excerpt_type owner")

    >> import shutil
    >> obj = excerpts.Excerpt.objects.get(pk=26)
    >> rv = ses.run(obj.do_print)
    >> print(rv['open_url'])
    .. #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +REPORT_UDIFF
    /media/cache/appypdf/isip.Contract-1.pdf
    >> print(rv['success'])
    True

    The above `.pdf` file has been generated to a temporary cache
    directory of the developer's computer when this document had its last
    test run. The following lines the copied the file to the docs tree
    which is published together with the source code and thus publicly
    visible:

    >> tmppath = settings.SITE.project_dir + rv['open_url']
    >> shutil.copyfile(tmppath, 'isip.Contract-1.pdf')

    Link to this copy of the resulting file:
    :srcref:`/docs/tested/isip.Contract-1.pdf`

    Now the same in more generic. We write a formatter function and then
    call it on every excerpt. See the source code of this page if you want
    to see how we generated the following list:


Default template for excerpts
=============================

Check whether Lino returns the right default template for excerpts.

In :mod:`lino_xl.lib.excerpts` we define a template
:xfile:`excerpts/Default.odt`, but :mod:`lino_welfare.modlib.welfare`
overrides this template.

The rule is that **the *last* plugin wins** when Lino searches for
templates.

This means that if we want to see the welfare-specific version, our
:meth:`get_installed_plugins <lino.core.site.Site.get_installed_plugins>` in
:mod:`lino_welare.projects.std.settings` must yield
:mod:`lino_welfare.modlib.welfare` **after**
:mod:`lino_xl.lib.excerpts`.

The following test verifies this rule:

>>> print(settings.SITE.find_config_file('Default.odt', 'excerpts'))
... #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +REPORT_UDIFF -SKIP
/.../welfare/config/excerpts/Default.odt


Editing the print template of an excerpt
========================================

Here we want to see what the :class:`EditTemplate
<lino.modlib.printing.EditTemplate>` action says, especially
when called on an excerpt where Lino has two possible locations.

Note that we need a local config directory for the following test to work. On
travis we use :envvar:`LINO_CACHE_ROOT`, so there is no local config dir. That's
why this doctest must create one.

>>> lcd = settings.SITE.site_dir / 'config'
>>> rt.makedirs_if_missing(lcd)

After having created the directory, we must tell Lino to scan the file
system again:

>>> settings.SITE.confdirs.scan_config_dirs()

.. How to simulate the travis situation in a contributor environment::

    $ go mathieu
    $ export LINO_CACHE_ROOT=~/lino_cache
    $ pm prep
    $ go welfare
    $ dt docs/specs/welcht/misc.rst

>>> settings.SITE.confdirs.LOCAL_CONFIG_DIR.writeable
True

Excerpts are printables with *two* template groups.
A printable with several template groups will use the first one that exists, and will fail only if non of them exists.
The first template group is
given by the owner (e.g. `"immersion/Contract"`) and the second is just
`"excerpts"`. For example the owner of Excerpt #2 is an immersion training,
while the owner of Excerpt #4 is an aids confirmation:

>>> excerpts.Excerpt.objects.get(pk=2).get_template_groups() #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +IGNORE_EXCEPTION_DETAIL
['immersion/Contract', 'excerpts']
>>> excerpts.Excerpt.objects.get(pk=4).get_template_groups() #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +IGNORE_EXCEPTION_DETAIL
['aids/Confirmation', 'excerpts']

When creating a local copy of the factory template, Lino copies the factory file
to the directory given by the *first* group. Before doing so, it will ask for
user confirmation.  The following code snippet partly tests this situation.

>>> obj = excerpts.Excerpt.objects.get(pk=2)
>>> obj.owner
Contract #2 ("Stage d'immersion#2 (Edgar ENGELS)")

>>> ses.set_confirm_answer(False)
>>> with ses.capture_logger('DEBUG') as out:
...    rv = ses.run(obj.edit_template)
>>> print(out.getvalue())  #doctest: +NORMALIZE_WHITESPACE +ELLIPSIS
Gonna copy ...welfare/config/excerpts/Default.odt to .../config/immersion/Contract/Default.odt
>>> print(rv['message'])  #doctest: +NORMALIZE_WHITESPACE
Before you can edit this template we must create a local copy on the server. This will exclude the template from future updates.
D'accord?


Another thing is the location of the factory template.

>>> obj = excerpts.Excerpt.objects.get(pk=1)
>>> ses.set_confirm_answer(False)
>>> with ses.capture_logger('DEBUG') as out:
...     rv = ses.run(obj.edit_template)
>>> print(out.getvalue())  #doctest: +NORMALIZE_WHITESPACE +ELLIPSIS
Gonna copy .../lino_welfare/modlib/welfare/config/excerpts/Default.odt to .../config/immersion/Contract/Default.odt



Yet another series of GET requests
==================================

>>> ContentType = rt.models.contenttypes.ContentType

>>> json_fields = 'count rows title success no_data_text param_values'
>>> kw = dict(fmt='json', limit=10, start=0)
>>> demo_get('rolf', 'api/contacts/Companies', json_fields, 37, **kw)
>>> demo_get('rolf', 'api/households/Households', json_fields, 15, **kw)
>>> demo_get('rolf', 'api/contacts/Partners', json_fields, 147, **kw)

>>> demo_get('rolf', 'api/jobs/JobProviders', json_fields, 4, **kw)

>>> json_fields = 'count rows title success no_data_text'
>>> demo_get('rolf', 'api/countries/Countries', json_fields, 225, **kw)
>>> demo_get('rolf', 'api/jobs/Jobs', json_fields, 9, **kw)

>>> json_fields = 'count rows title success no_data_text param_values'
>>> demo_get('rolf', 'api/contacts/Persons', json_fields, 97, **kw)
>>> demo_get('rolf', 'api/pcsw/CoachedClients', json_fields, 29, **kw)
>>> demo_get('rolf', 'api/debts/Clients', json_fields, 0, **kw)
>>> demo_get('rolf', 'api/cal/MyEntries', json_fields, 9, **kw)
>>> demo_get('rolf', 'api/newcomers/NewClients', json_fields, 22, **kw)

Value for mt in the following snippets:

>>> mt = contenttypes.ContentType.objects.get_for_model(pcsw.Client).pk

>>> demo_get(
...    'rolf', 'api/newcomers/AvailableCoachesByClient', json_fields,
...    2, mt=mt, mk=21, **kw)
>>> demo_get('alicia', 'api/integ/Clients', json_fields, 7, **kw)
>>> demo_get('hubert', 'api/integ/Clients', json_fields, 17, **kw)

>>> alicia = settings.SITE.user_model.objects.get(username='alicia')

Rolf working as Alicia:

>>> kw = dict(fmt='json', limit=20, start=0, su=alicia.pk)
>>> demo_get('rolf', 'api/integ/Clients', json_fields, 7, **kw)

Some choices lists:

>>> kw = dict()
>>> fields = 'count rows'
>>> demo_get(
...    'rolf', 'choices/aids/IncomeConfirmations/aid_type', fields, 11, **kw)

>>> demo_get(
...    'rolf', 'choices/aids/RefundConfirmations/aid_type', fields, 11, **kw)

>>> demo_get(
...    'rolf', 'apchoices/pcsw/Clients/create_visit/user', fields, 4, **kw)

>>> demo_get(
...    'robin', 'choices/countries/Countries/actual_country', fields, 220, **kw)

>>> kw.update(mt=mt, mk=21, type=1)  # slave table requires a master instance
>>> demo_get(
...    'rolf', 'choices/clients/ContactsByClient/company', fields, 3, **kw)


Visibility of eID reader action
===============================

Here is a list of the tables that have the
:class:`lino.modlib.beid.mixins.FindByBeIdAction` and the user
profiles that can see it.

>>> from lino_xl.lib.beid.mixins import FindByBeIdAction
>>> print(analyzer.show_action_permissions(FindByBeIdAction))
... #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +REPORT_UDIFF
- debts.Clients.find_by_beid : visible for 120 300 420 admin 910
- integ.Clients.find_by_beid : visible for 100 110 120 130 420 admin 910
- newcomers.ClientsByFaculty.find_by_beid : visible for 100 110 120 130 200 210 220 300 400 410 420 430 800 admin 910
- newcomers.NewClients.find_by_beid : visible for 120 200 220 300 420 admin 910
- pcsw.AllClients.find_by_beid : visible for 110 120 410 420 admin 910
- pcsw.Clients.find_by_beid : visible for 100 110 120 130 200 210 220 300 400 410 420 430 800 admin 910
- pcsw.ClientsByNationality.find_by_beid : visible for 100 110 120 130 200 210 220 300 400 410 420 430 800 admin 910
- pcsw.CoachedClients.find_by_beid : visible for 100 110 120 130 200 300 400 410 420 430 admin 910
- reception.Clients.find_by_beid : visible for 100 110 120 130 200 210 220 300 400 410 420 430 800 admin 910
<BLANKLINE>




.. Visibility of merge action
   ==========================

..  Here is a list of the tables that have the
    :class:`lino.core.merge.MergeAction` and the user types that can
    see it.

    >>> from lino.core.merge import MergeAction
    >>> print(analyzer.show_action_permissions(MergeAction))
    ... #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +REPORT_UDIFF +SKIP
    - contacts.Companies.merge_row : visible for 110 210 410 800 admin 910
    - countries.Places.merge_row : visible for 110 210 410 800 admin 910
    - pcsw.Clients.merge_row : visible for 110 210 410 800 admin 910
    <BLANKLINE>



Visibility of the CloneRow action
=================================

Here is a list of the tables that have the
:class:`lino.mixins.clonable.CloneRow` and the user types that can
see it.


>>> from lino.mixins.clonable import CloneRow
>>> print(analyzer.show_action_permissions(CloneRow))
... #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE +REPORT_UDIFF
- cal.AllEntries.clone_row : visible for admin 910
- cal.ConflictingEvents.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 admin 910
- cal.EntriesByClient.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- cal.EntriesByController.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- cal.EntriesByDay.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- cal.EntriesByGuest.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- cal.EntriesByProject.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- cal.EntriesByRoom.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 admin 910
- cal.EntriesByType.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 admin 910
- cal.EventTypes.clone_row : visible for 110 120 410 420 admin 910
- cal.Events.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 admin 910
- cal.MyAssignedEvents.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 500 510 admin 910
- cal.MyEntries.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 500 510 admin 910
- cal.MyEntriesToday.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 500 510 admin 910
- cal.MyOverdueAppointments.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 500 510 admin 910
- cal.MyUnconfirmedAppointments.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 500 510 admin 910
- cal.OneEvent.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- cal.OverdueAppointments.clone_row : visible for 110 120 410 420 admin 910
- cal.RemoteCalendars.clone_row : visible for 110 120 410 420 admin 910
- cal.UpcomingEvents.clone_row : visible for 130 210 430
- calview.DailyPlanner.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- calview.DailyPlannerRows.clone_row : visible for 110 120 410 420 admin 910
- calview.DailySlave.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- calview.WeeklySlave.clone_row : visible for 110 120 410 420 admin 910
- cbss.AllIdentifyPersonRequests.clone_row : visible for admin 910
- cbss.AllManageAccessRequests.clone_row : visible for admin 910
- cbss.AllRetrieveTIGroupsRequests.clone_row : visible for admin 910
- cbss.IdentifyPersonRequests.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.IdentifyRequestsByPerson.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.ManageAccessRequests.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.ManageAccessRequestsByPerson.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.MyIdentifyPersonRequests.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.MyManageAccessRequests.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.MyRetrieveTIGroupsRequests.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.RetrieveTIGroupsRequests.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- cbss.RetrieveTIGroupsRequestsByPerson.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 admin 910
- clients.PartnersByClientContactType.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- coachings.CoachingEndings.clone_row : visible for 110 120 130 210 410 420 430 admin 910
- contacts.Companies.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- contacts.Partners.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- contacts.PartnersByCity.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- contacts.PartnersByCountry.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- contacts.Persons.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- countries.Places.clone_row : visible for 110 120 130 210 410 420 430 800 admin 910
- countries.PlacesByCountry.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- countries.PlacesByPlace.clone_row : visible for 110 120 130 210 410 420 430 800 admin 910
- courses.ActiveActivities.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.Activities.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.ActivitiesByLayout.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.ActivitiesByLine.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.ActivitiesBySlot.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.ActivitiesByTeacher.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.ActivitiesByTopic.clone_row : visible for nobody
- courses.AllActivities.clone_row : visible for admin 910
- courses.ClosedActivities.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.DraftActivities.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.EntriesByTeacher.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 admin 910
- courses.InactiveActivities.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.JobCourses.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.Lines.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.LinesByTopic.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.MyActivities.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 800 admin 910
- courses.MyCoursesGiven.clone_row : visible for 110 120 420 admin 910
- courses.Slots.clone_row : visible for admin 910
- courses.Topics.clone_row : visible for admin 910
- cv.EducationLevels.clone_row : visible for 110 120 420 admin 910
- dashboard.AllWidgets.clone_row : visible for admin 910
- dashboard.Widgets.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- dashboard.WidgetsByUser.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- debts.Accounts.clone_row : visible for admin 910
- debts.AccountsByGroup.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- debts.Actors.clone_row : visible for admin 910
- debts.ActorsByBudget.clone_row : visible for 120 300 420 admin 910
- debts.ActorsByPartner.clone_row : visible for 120 300 420 admin 910
- debts.AssetsByBudget.clone_row : visible for 120 300 420 admin 910
- debts.Budgets.clone_row : visible for admin 910
- debts.BudgetsByPartner.clone_row : visible for 120 300 420 admin 910
- debts.Clients.clone_row : visible for nobody
- debts.DistByBudget.clone_row : visible for 120 300 420 admin 910
- debts.Entries.clone_row : visible for admin 910
- debts.EntriesByAccount.clone_row : visible for admin 910
- debts.EntriesByBudget.clone_row : visible for 120 300 420 admin 910
- debts.EntriesByType.clone_row : visible for 120 300 420 admin 910
- debts.ExpensesByBudget.clone_row : visible for 120 300 420 admin 910
- debts.IncomesByBudget.clone_row : visible for 120 300 420 admin 910
- debts.LiabilitiesByBudget.clone_row : visible for 120 300 420 admin 910
- debts.MyBudgets.clone_row : visible for 120 300 420 admin 910
- excerpts.AllExcerpts.clone_row : visible for nobody
- excerpts.ExcerptTypes.clone_row : visible for admin 910
- excerpts.Excerpts.clone_row : visible for nobody
- excerpts.ExcerptsByOwner.clone_row : visible for nobody
- excerpts.ExcerptsByProject.clone_row : visible for nobody
- excerpts.ExcerptsByType.clone_row : visible for nobody
- excerpts.MyExcerpts.clone_row : visible for nobody
- extensible.PanelEvents.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 500 510 admin 910
- households.Households.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 800 admin 910
- households.HouseholdsByType.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 800 admin 910
- integ.Clients.clone_row : visible for nobody
- integ.CoachingEndingsByType.clone_row : visible for 110 120 130 210 410 420 430 admin 910
- integ.CoachingEndingsByUser.clone_row : visible for 110 120 130 210 410 420 430 admin 910
- integ.CompaniesAndContracts.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- integ.JobProvidersAndContracts.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- isip.EntriesByContract.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- jobs.Employers.clone_row : visible for 100 110 120 130 420 admin 910
- jobs.JobProviders.clone_row : visible for 100 110 120 130 420 admin 910
- jobs.JobTypes.clone_row : visible for 110 120 410 420 admin 910
- jobs.WorkplacesByProvider.clone_row : visible for 100 110 120 130 420 admin 910
- linod.SystemTasks.clone_row : visible for admin 910
- newcomers.ClientsByFaculty.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- newcomers.Competences.clone_row : visible for 110 120 410 420 admin 910
- newcomers.CompetencesByFaculty.clone_row : visible for 110 120 410 420 admin 910
- newcomers.CompetencesByUser.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- newcomers.MyCompetences.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- newcomers.NewClients.clone_row : visible for 120 200 220 300 420 admin 910
- notes.AllNotes.clone_row : visible for 110 120 420 admin 910
- notes.MyNotes.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- notes.Notes.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- notes.NotesByCompany.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 800 admin 910
- notes.NotesByEventType.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- notes.NotesByOwner.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- notes.NotesByPerson.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- notes.NotesByProject.clone_row : visible for 100 110 120 130 200 210 300 400 410 420 430 500 510 800 admin 910
- notes.NotesByType.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- pcsw.AllClients.clone_row : visible for 110 120 410 420 admin 910
- pcsw.Clients.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- pcsw.ClientsByNationality.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
- pcsw.CoachedClients.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 admin 910
- pcsw.DispenseReasons.clone_row : visible for 110 120 410 420 admin 910
- polls.Choices.clone_row : visible for 110 120 410 420 admin 910
- polls.ChoicesBySet.clone_row : visible for 110 120 410 420 admin 910
- polls.PollResult.clone_row : visible for 110 120 410 420 admin 910
- polls.Questions.clone_row : visible for 110 120 410 420 admin 910
- polls.QuestionsByPoll.clone_row : visible for 100 110 120 130 200 300 400 410 420 430 admin 910
- reception.Clients.clone_row : visible for 100 110 120 130 200 210 220 300 400 410 420 430 500 510 800 admin 910
<BLANKLINE>


>>> show_clonables()
- cal.Event : cal.Guest.event
- cal.EventType
- cal.RemoteCalendar
- calview.DailyPlannerRow
- cbss.IdentifyPersonRequest
- cbss.ManageAccessRequest
- cbss.RetrieveTIGroupsRequest
- coachings.CoachingEnding
- contacts.Company
- contacts.Partner : addresses.Address.partner
- contacts.Person : cv.LanguageKnowledge.person, cv.Obstacle.person, cv.Skill.person, cv.SoftSkill.person
- countries.Place
- courses.Course : courses.Enrolment.course
- courses.Line
- courses.Slot
- courses.Topic
- cv.EducationLevel
- dashboard.Widget
- debts.Account
- debts.Actor
- debts.Budget : debts.Actor.budget, debts.Entry.budget
- debts.Entry
- excerpts.Excerpt
- excerpts.ExcerptType
- households.Household : households.Member.household
- jobs.Employer
- jobs.JobProvider
- jobs.JobType
- linod.SystemTask
- newcomers.Competence
- notes.Note
- pcsw.Client : aids.IncomeConfirmation.client, aids.RefundConfirmation.client, aids.SimpleConfirmation.client, coachings.Coaching.client, pcsw.Dispense.client
- pcsw.DispenseReason
- polls.Choice
- polls.Question






Permissions
===========

Test whether everybody can display the detail of a client:

>>> o = pcsw.Client.objects.get(id=78)
>>> for u in ('robin', 'alicia', 'theresia', 'caroline', 'kerstin'):
...     print(tostring(rt.login(u).obj2html(o)))
... #doctest: +ELLIPSIS +NORMALIZE_WHITESPACE
<a href="…">BRECHT Bernd (78)</a>
<a href="…">BRECHT Bernd (78)</a>
<a href="…">BRECHT Bernd (78)</a>
<a href="…">BRECHT Bernd (78)</a>
<a href="…">BRECHT Bernd (78)</a>


Miscellaneous tests
===================

See :blogref:`20130508`:

>>> for model in (debts.Entry,):
...     for o in model.objects.all():
...         o.full_clean()





>>> show_change_watchers()  #doctest: +NORMALIZE_WHITESPACE +REPORT_UDIFF
+-----------------------+------------------------------+------------------------------------------+
| model                 | master_key                   | ignored_fields                           |
+=======================+==============================+==========================================+
| contacts.Partner      | None                         | address_column contact_details created   |
|                       |                              | created_natural list_item modified       |
|                       |                              | mti_navigator municipality name_column   |
|                       |                              | navigation_panel overview rowselect      |
|                       |                              | workflow_buttons                         |
+-----------------------+------------------------------+------------------------------------------+
| contacts.Person       | contacts.Person.partner_ptr  | address_column age contact_details       |
|                       |                              | created created_natural list_item        |
|                       |                              | modified mti_navigator municipality      |
|                       |                              | name_column navigation_panel overview    |
|                       |                              | rowselect workflow_buttons               |
+-----------------------+------------------------------+------------------------------------------+
| contacts.Company      | contacts.Company.partner_ptr | created modified                         |
+-----------------------+------------------------------+------------------------------------------+
| clients.ClientContact | client__partner_ptr          | list_item name_column navigation_panel   |
|                       |                              | overview rowselect workflow_buttons      |
+-----------------------+------------------------------+------------------------------------------+
| coachings.Coaching    | client__partner_ptr          | list_item name_column navigation_panel   |
|                       |                              | overview rowselect workflow_buttons      |
+-----------------------+------------------------------+------------------------------------------+
| pcsw.Client           | contacts.Person.partner_ptr  | active_contract address_column age       |
|                       |                              | applies_from applies_until               |
|                       |                              | cbss_relations cef_level_de cef_level_en |
|                       |                              | cef_level_fr coaches contact_details     |
|                       |                              | created created_natural eid_info         |
|                       |                              | find_appointment image                   |
|                       |                              | language_knowledge list_item modified    |
|                       |                              | mother_tongues mti_navigator             |
|                       |                              | municipality name_column                 |
|                       |                              | navigation_panel overview primary_coach  |
|                       |                              | rowselect workflow_buttons               |
+-----------------------+------------------------------+------------------------------------------+
| jobs.JobProvider      | contacts.Company.partner_ptr | created modified                         |
+-----------------------+------------------------------+------------------------------------------+
| jobs.Employer         | contacts.Company.partner_ptr | created modified                         |
+-----------------------+------------------------------+------------------------------------------+
| households.Household  | None                         | address_column contact_details created   |
|                       |                              | created_natural list_item modified       |
|                       |                              | mti_navigator municipality name_column   |
|                       |                              | navigation_panel overview rowselect      |
|                       |                              | workflow_buttons                         |
+-----------------------+------------------------------+------------------------------------------+
<BLANKLINE>

20240906 The following code snippet was used to try to reproduce a mysterious
thing that happened to an end user yesterday. The designation of one database
row had been copied over that of another, leading to two database rows with the
same designation.

>>> rt.login("romain").show(cal.EventTypes)
======================================== ======================================== =============================== ================= ==============================
 Bezeichnung                              Bezeichnung (de)                         Bezeichnung (en)                Klient einladen   Champ FSE
---------------------------------------- ---------------------------------------- ------------------------------- ----------------- ------------------------------
 Absences                                 Abwesenheiten                            Absences                        Nein
 Atelier                                  Atelier                                  Workshop                        Nein
 Consultations avec le bénéficiaire       Beratungen mit Klient                    Consultations with client       Nein
 Informational meetings                   Informational meetings                   Informational meetings          Ja                S.I.S. agréé
 Internal meetings with client            Internal meetings with client            Internal meetings with client   Ja                Séance d’information
 Interne                                  Intern                                   Internal                        Nein
 Jours fériés                             Feiertage                                Holidays                        Nein
 Privé                                    Privat                                   Private                         Nein
 Réunion                                  Versammlung                              Meeting                         Nein
 Réunions externe                         Réunions externe                         External meetings               Nein
 Réunions externes avec le bénéficiaire   Réunions externes avec le bénéficiaire   External meetings with client   Ja                Evaluation formation externe
 Réunions interne                         Réunions interne                         Internal meetings               Nein
 Évaluation                               Auswertung                               Evaluation                      Ja                Entretien individuel
======================================== ======================================== =============================== ================= ==============================
<BLANKLINE>
