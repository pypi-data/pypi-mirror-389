# Stata-MCP - AI åŠ©æ‰‹é¡¹ç›®ä»‹ç»

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

Stata-MCP æ˜¯ä¸€ä¸ªåŸºäº MCP (Model Context Protocol) åè®®çš„ Stata ç»Ÿè®¡åˆ†æåŠ©æ‰‹ï¼Œè®© AI èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·å®Œæˆå›å½’åˆ†æå’Œæ•°æ®ç»Ÿè®¡ä»»åŠ¡ã€‚é¡¹ç›®é€šè¿‡æä¾›æ ‡å‡†åŒ–çš„å·¥å…·å’Œæ¥å£ï¼Œä½¿ AI èƒ½å¤Ÿç†è§£ã€ç”Ÿæˆå’Œæ‰§è¡Œ Stata ä»£ç ã€‚

**æ ¸å¿ƒä»·å€¼**: è®© LLM èƒ½å¤Ÿåƒä¸“ä¸šçš„ç»Ÿè®¡åˆ†æå¸ˆä¸€æ ·ä½¿ç”¨ Stata è¿›è¡Œæ•°æ®åˆ†æã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### ä¸»è¦æ¨¡å—ç»“æ„
```
stata-mcp/
â”œâ”€â”€ src/stata_mcp/
â”‚   â”œâ”€â”€ __init__.py              # ä¸»æ¨¡å—å…¥å£ï¼ŒMCP æœåŠ¡å™¨é…ç½®
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ data_info/           # æ•°æ®æ–‡ä»¶åˆ†æ (CSV, DTA)
â”‚   â”‚   â”œâ”€â”€ rag/                 # RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ stata/               # Stata ç›¸å…³æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚       â”œâ”€â”€ stata_controller/ # Stata æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ stata_do/        # Stata æ‰§è¡Œå™¨
â”‚   â”‚       â””â”€â”€ stata_finder/    # Stata å®‰è£…æŸ¥æ‰¾å™¨
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·ç±»æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ Installer/          # å®‰è£…å™¨
â”‚   â”‚   â”œâ”€â”€ Prompt/             # æç¤ºè¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ usable.py           # å¯ç”¨æ€§æ£€æŸ¥
â”‚   â”œâ”€â”€ cli/                    # å‘½ä»¤è¡Œæ¥å£
â”‚   â”œâ”€â”€ mode/                   # ä¸åŒæ“ä½œæ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ langchain_agent.py  # LangChain åŸºç¡€çš„ä»£ç†æ¨¡å¼
â”‚   â”‚   â””â”€â”€ pmp/                # åŸºäºæç¤ºè¯çš„æ¨¡å¼
â”‚   â”œâ”€â”€ agent_as_tool/          # ä»£ç†ä½œä¸ºå·¥å…·é›†æˆ
â”‚   â”œâ”€â”€ evaluate/               # LLM è¯„ä¼°æ¨¡å—
â”‚   â””â”€â”€ sandbox/                # æ²™ç®±ç¯å¢ƒ
â”‚       â”œâ”€â”€ core/               # æ²™ç®±æ ¸å¿ƒ
â”‚       â””â”€â”€ jupyter_manager/    # Jupyter å†…æ ¸ç®¡ç†
â”œâ”€â”€ agent_examples/             # ä»£ç†æ¨¡å¼ç¤ºä¾‹
â”‚   â”œâ”€â”€ openai/                 # OpenAI ä»£ç†ç¤ºä¾‹
â”‚   â”œâ”€â”€ langchain/              # LangChain ä»£ç†ç¤ºä¾‹
â”‚   â””â”€â”€ task_prompt/            # ä»»åŠ¡æç¤ºè¯ç¤ºä¾‹
â”œâ”€â”€ main.py                     # åº”ç”¨å…¥å£
â””â”€â”€ pyproject.toml             # é¡¹ç›®é…ç½®
```

### æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶

1. **StataFinder** (`src/stata_mcp/core/stata/stata_finder/`): è·¨å¹³å° Stata å®‰è£…æ£€æµ‹
   - macOS: é€šè¿‡ç³»ç»Ÿè·¯å¾„æŸ¥æ‰¾
   - Windows: é€šè¿‡æ³¨å†Œè¡¨å’Œç¨‹åºæ–‡ä»¶æŸ¥æ‰¾
   - Linux: æ”¯æŒè‡ªå®šä¹‰è·¯å¾„é…ç½®

2. **StataController** (`src/stata_mcp/core/stata/stata_controller/`): Stata è¿›ç¨‹æ§åˆ¶
   - å‘½ä»¤æ‰§è¡Œç®¡ç†
   - ä¼šè¯çŠ¶æ€ç»´æŠ¤
   - é”™è¯¯å¤„ç†æœºåˆ¶

3. **StataDo** (`src/stata_mcp/core/stata/stata_do/`): Do æ–‡ä»¶æ‰§è¡Œå™¨
   - è·¨å¹³å° do æ–‡ä»¶æ‰§è¡Œ
   - æ—¥å¿—æ–‡ä»¶ç®¡ç†
   - ç»“æœè¾“å‡ºå¤„ç†

4. **Prompt ç®¡ç†ç³»ç»Ÿ** (`src/stata_mcp/utils/Prompt/`): AI æç¤ºè¯ç®¡ç†
   - å¤šè¯­è¨€æ”¯æŒ (ä¸­è‹±æ–‡)
   - è§’è‰²å®šä¹‰å’Œç­–ç•¥æç¤º
   - åŠ¨æ€æç¤ºè¯ç”Ÿæˆ

5. **ä»£ç†æ¨¡å¼** (`src/stata_mcp/mode/`): è‡ªä¸»åˆ†æä»£ç†
   - `langchain_agent.py`: LangChain åŸºç¡€çš„ä»£ç†æ¡†æ¶
   - `pmp/`: åŸºäºæç¤ºè¯çš„ä»£ç†æ¨¡å¼
   - å¤šè½®å¯¹è¯æ”¯æŒ

6. **ä»£ç†ä½œä¸ºå·¥å…·** (`src/stata_mcp/agent_as_tool/`): å·¥å…·é›†æˆ
   - `StataAgent`: å¯åµŒå…¥çš„ Stata ä»£ç†
   - ä¸å…¶ä»–ä»£ç†æ¡†æ¶é›†æˆ
   - è‡ªå®šä¹‰æ¨¡å‹é…ç½®

7. **è¯„ä¼°æ¨¡å—** (`src/stata_mcp/evaluate/`): LLM æ€§èƒ½è¯„ä¼°
   - è‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿ
   - è´¨é‡è¯„ä¼°å·¥å…·
   - åŸºå‡†è¯„ä¼°æ¡†æ¶

8. **RAG ç³»ç»Ÿ** (`src/stata_mcp/core/rag/`): çŸ¥è¯†æ£€ç´¢
   - æ–‡æ¡£ç´¢å¼•å’Œæœç´¢
   - ä¸Šä¸‹æ–‡æ„ŸçŸ¥å“åº”ç”Ÿæˆ
   - ç»Ÿè®¡çŸ¥è¯†åº“

## ğŸ› ï¸ å¦‚ä½•ä½¿ç”¨

### åŸºç¡€é…ç½®

åœ¨ AI å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­æ·»åŠ :
```json
{
  "mcpServers": {
    "stata-mcp": {
      "command": "uvx",
      "args": ["stata-mcp"]
    }
  }
}
```

### æ ¸å¿ƒå·¥å…·å‡½æ•°

AI å¯ä»¥é€šè¿‡ä»¥ä¸‹å·¥å…·ä¸ Stata äº¤äº’:

1. **`stata_do(dofile_path, is_read_log=True)`** - æ‰§è¡Œ Stata do æ–‡ä»¶
2. **`write_dofile(content)`** - å†™å…¥ Stata ä»£ç åˆ° do æ–‡ä»¶
3. **`append_dofile(original_dofile_path, content)`** - è¿½åŠ ä»£ç åˆ°ç°æœ‰ do æ–‡ä»¶
4. **`get_data_info(data_path, vars_list=None, encoding="utf-8")`** - è·å–æ•°æ®æ–‡ä»¶ä¿¡æ¯
5. **`ssc_install(command, is_replace=True)`** - å®‰è£… SSC åŒ…
6. **`help(cmd)`** - è·å– Stata å‘½ä»¤å¸®åŠ©
7. **`mk_dir(path)`** - åˆ›å»ºç›®å½•
8. **`load_figure(figure_path)`** - åŠ è½½å›¾è¡¨
9. **`read_file(file_path, encoding="utf-8")`** - è¯»å–æ–‡ä»¶å†…å®¹

### ä»£ç†æ¨¡å¼ä½¿ç”¨

#### äº¤äº’å¼ä»£ç†æ¨¡å¼
```bash
# è¿è¡Œä»£ç†æ¨¡å¼ï¼Œæä¾›äº¤äº’å¼ç•Œé¢
stata-mcp --agent

# æˆ–ä½¿ç”¨ uvx
uvx stata-mcp --agent
```

#### ä»£ç†ä½œä¸ºå·¥å…·é›†æˆ
```python
from agents import Agent, Runner
from stata_mcp.agent_as_tool import StataAgent

# åˆå§‹åŒ– Stata ä»£ç†
stata_agent = StataAgent()
sa_tool = stata_agent.as_tool()

# åˆ›å»ºåŒ…å« Stata å·¥å…·çš„ä¸»ä»£ç†
agent = Agent(
    name="Assistant",
    instructions="You are a helpful assistant",
    tools=[sa_tool],
)

# è¿è¡Œä»£ç†
async def main(task: str):
    result = await Runner.run(agent, input=task)
    return result
```

### è¯„ä¼°ç³»ç»Ÿ

é¡¹ç›®åŒ…å«å…¨é¢çš„ LLM è¯„ä¼°ç³»ç»Ÿï¼š
- **è‡ªåŠ¨è¯„åˆ†**: è¯„ä¼°åˆ†æè´¨é‡å’Œå‡†ç¡®æ€§
- **åŸºå‡†æµ‹è¯•**: æ ‡å‡†åŒ–è¯„ä¼°æ•°æ®é›†
- **æ€§èƒ½æŒ‡æ ‡**: å“åº”æ—¶é—´ã€å‡†ç¡®æ€§ã€å®Œæ•´æ€§
- **å¯¹æ¯”åˆ†æ**: æ¨¡å‹æ€§èƒ½æ¯”è¾ƒ

### RAG é›†æˆ

çŸ¥è¯†æ£€ç´¢åŠŸèƒ½ï¼š
- **æ–‡æ¡£æœç´¢**: æŸ¥æ‰¾ç›¸å…³ç»Ÿè®¡æ–‡çŒ®
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: æä¾›é¢†åŸŸç‰¹å®šä¸Šä¸‹æ–‡
- **çŸ¥è¯†åº“**: ç²¾é€‰çš„ç»Ÿè®¡æ–¹æ³•å’Œç¤ºä¾‹

### æç¤ºè¯ç³»ç»Ÿ

é¡¹ç›®å†…ç½®äº†ä¸“ä¸šçš„æç¤ºè¯æ¨¡æ¿:
- `stata_assistant_role()` - Stata åŠ©æ‰‹è§’è‰²å®šä¹‰
- `stata_analysis_strategy()` - Stata åˆ†æç­–ç•¥æŒ‡å—

## ğŸ§© ä»£ç è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

1. å…‹éš†é¡¹ç›®:
```bash
git clone https://github.com/sepinetam/stata-mcp.git
cd stata-mcp
```

2. å®‰è£…ä¾èµ–:
```bash
uv sync
```

3. è¿è¡Œæµ‹è¯•:
```bash
uv run pytest tests/
```

### ä»£ç è§„èŒƒ

- **ç±»å‹æ ‡æ³¨**: æ‰€æœ‰å‡½æ•°å¿…é¡»åŒ…å«å®Œæ•´çš„ç±»å‹æ ‡æ³¨
- **æ–‡æ¡£æ³¨é‡Š**: æ¯ä¸ªå‡½æ•°éƒ½éœ€è¦æœ‰è¯¦ç»†çš„è‹±æ–‡æ–‡æ¡£æ³¨é‡Š
- **å‘½åè§„èŒƒ**: ä½¿ç”¨æè¿°æ€§å˜é‡åï¼Œéµå¾ª PEP 8 è§„èŒƒ
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯ä¿¡æ¯

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°å·¥å…·å‡½æ•°**: åœ¨ `src/stata_mcp/__init__.py` ä¸­æ·»åŠ  `@stata_mcp.tool()` è£…é¥°å™¨
2. **æ–°æç¤ºè¯**: åœ¨ `src/stata_mcp/utils/Prompt/string.py` ä¸­æ·»åŠ å¤šè¯­è¨€æç¤ºè¯
3. **å¹³å°æ”¯æŒ**: åœ¨å¯¹åº”çš„å¹³å°æ¨¡å—ä¸­æ·»åŠ å®ç°

### æµ‹è¯•è¦æ±‚

- å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½
- è·¨å¹³å°å…¼å®¹æ€§æµ‹è¯•
- é”™è¯¯åœºæ™¯æµ‹è¯•

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

### è·¨å¹³å°æ”¯æŒ
- **macOS**: è‡ªåŠ¨æ£€æµ‹ Stata å®‰è£…è·¯å¾„
- **Windows**: æ”¯æŒæ³¨å†Œè¡¨æŸ¥æ‰¾å’Œç¨‹åºæ–‡ä»¶æ‰«æ
- **Linux**: æ”¯æŒè‡ªå®šä¹‰è·¯å¾„é…ç½®

### æ™ºèƒ½æ•°æ®è§£æ
- æ”¯æŒå¤šç§æ•°æ®æ ¼å¼ (.dta, .csv, .xlsx, .xls)
- è‡ªåŠ¨æ•°æ®ç»Ÿè®¡åˆ†æ
- ç¼ºå¤±å€¼æ£€æµ‹å’Œé¢æ¿æ•°æ®ç»“æ„è¯†åˆ«

### ä¸“ä¸šæç¤ºè¯ç³»ç»Ÿ
- å¤šè¯­è¨€è§’è‰²å®šä¹‰
- ç»Ÿè®¡åˆ†æç­–ç•¥æŒ‡å¯¼
- é”™è¯¯å¤„ç†å’Œè°ƒè¯•å»ºè®®

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Python 3.11+**: æ ¸å¿ƒç¼–ç¨‹è¯­è¨€
- **MCP Protocol**: AI äº¤äº’åè®®
- **LangChain**: ä»£ç†æ¡†æ¶å’Œå·¥å…·é›†æˆ
- **OpenAI Agents**: é«˜çº§ä»£ç†ç¼–æ’
- **pandas**: æ•°æ®å¤„ç†å’Œåˆ†æ
- **pexpect**: è·¨å¹³å°è¿›ç¨‹æ§åˆ¶
- **pathvalidate**: æ–‡ä»¶è·¯å¾„å®‰å…¨éªŒè¯
- **dotenv**: ç¯å¢ƒé…ç½®ç®¡ç†
- **FastMCP**: é«˜æ€§èƒ½ MCP æœåŠ¡å™¨æ¡†æ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

```python
# AI å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ä¸ Stata-MCP äº¤äº’

# 1. åˆ›å»ºåˆ†æ do æ–‡ä»¶
dofile_content = """
use "data.dta"
summarize
regress y x1 x2 x3
outreg2 using "results.txt", replace
"""

dofile_path = write_dofile(dofile_content)

# 2. æ‰§è¡Œåˆ†æ
result = stata_do(dofile_path, is_read_log=True)
print(result["log_content"])

# 3. è·å–æ•°æ®ä¿¡æ¯
data_info = get_data_info("data.dta")
print(data_info)
```

## ğŸ“Š é¡¹ç›®çŠ¶æ€

- âœ… macOS æ”¯æŒ (å·²å®Œæˆ)
- âœ… Windows æ”¯æŒ (å·²å®Œæˆ)
- ğŸ”„ Linux æ”¯æŒ (å¼€å‘ä¸­)
- ğŸ”„ æ›´å¤š LLM é›†æˆ (è§„åˆ’ä¸­)
- ğŸ”„ æ€§èƒ½ä¼˜åŒ– (è¿›è¡Œä¸­)

## ğŸ¤ è´¡çŒ®æ–¹å¼

1. **æŠ¥å‘Šé—®é¢˜**: åœ¨ GitHub Issues ä¸­æäº¤ bug æŠ¥å‘Šæˆ–åŠŸèƒ½è¯·æ±‚
2. **æäº¤ä»£ç **: Fork é¡¹ç›®å¹¶æäº¤ Pull Request
3. **æ–‡æ¡£æ”¹è¿›**: å¸®åŠ©å®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹
4. **æµ‹è¯•éªŒè¯**: å¸®åŠ©æµ‹è¯•ä¸åŒå¹³å°çš„å…¼å®¹æ€§

## ğŸ“ è”ç³»æ–¹å¼

- **ä½œè€…**: Sepine Tam (è°­æ·)
- **é‚®ç®±**: sepinetam@gmail.com
- **GitHub**: https://github.com/sepinetam

## ğŸ“„ è®¸å¯è¯

Apache License 2.0 - è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶

---

**Stata-MCP**: è®© AI æˆä¸ºä½ çš„ä¸“ä¸šç»Ÿè®¡åˆ†æå¸ˆåŠ©æ‰‹ï¼