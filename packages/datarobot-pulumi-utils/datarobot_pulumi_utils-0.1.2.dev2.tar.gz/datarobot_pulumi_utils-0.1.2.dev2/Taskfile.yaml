version: '3'

env:
  SRCDIR: ./src/
  TESTDIR: ./tests/

tasks:
  lint:
    desc: ğŸ§¹ Lint the codebase
    cmds:
      - echo "ğŸ§¹ Linting"
      - uv run ruff format $SRCDIR
      - uv run ruff check --fix $SRCDIR
      - uv run mypy --pretty $SRCDIR

  lint-check:
    desc: ğŸ§¹ Check whether the codebase is linted
    cmds:
        - echo "ğŸ§¹ Linting"
        - uv run ruff format --check $SRCDIR
        - uv run ruff check $SRCDIR
        - uv run mypy --pretty $SRCDIR

  test:
    desc: ğŸ§ª Run the tests
    cmds:
      - echo "ğŸ§ª Running the tests"
      - uv run coverage run -m pytest $TESTDIR $SRCDIR

  copyright:
    aliases: [license]
    desc: ğŸ“œ Apply license headers
    cmds:
      - echo "ğŸ“œ Applying license headers"
      - docker run  --rm -v $PWD:/github/workspace ghcr.io/apache/skywalking-eyes/license-eye:eb0e0b091ea41213f712f622797e37526ca1e5d6 -v info -c .licenserc.yaml header fix

  copyright-check:
    aliases: [license-check]
    desc: ğŸ“œ Checking for license headers
    cmds:
      - echo "ğŸ“œ Applying license headers"
      - docker run  --rm -v $PWD:/github/workspace ghcr.io/apache/skywalking-eyes/license-eye:eb0e0b091ea41213f712f622797e37526ca1e5d6 -v info -c .licenserc.yaml header check

  build:
    desc: ğŸ—ï¸ Build the package
    cmds:
      - echo "ğŸ—ï¸ Building the package"
      - uv build

  publish:
    desc: ğŸ“¦ Publish the package
    cmds:
      - echo "ğŸ“¦ Building the package"
      - uv publish

  clean:
    desc: ğŸ§¹ Clean temporary files
    cmds:
      - echo "ğŸ§¹ Cleaning temporary files.."
      - rm -rf dist
      - rm -rf .mypy_cache .pytest_cache .ruff_cache *.egg-info
      - rm -rf .coverage htmlcov coverage.xml