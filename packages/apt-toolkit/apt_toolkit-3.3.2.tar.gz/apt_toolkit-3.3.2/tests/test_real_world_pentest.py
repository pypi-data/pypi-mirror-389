
import unittest
from unittest.mock import patch, MagicMock
from campaigns.real_world_pentest import campaign_orchestrator

class TestRealWorldPentest(unittest.TestCase):

    @patch('campaigns.real_world_pentest.tools.recon.run_reconnaissance')
    @patch('campaigns.real_world_pentest.tools.initial_access.send_phishing_email')
    @patch('campaigns.real_world_pentest.tools.persistence.create_reverse_shell')
    @patch('campaigns.real_world_pentest.tools.exfiltration.exfiltrate_data')
    def test_campaign_orchestrator(self, mock_exfiltrate, mock_persistence, mock_initial_access, mock_recon):
        """Test that the campaign orchestrator runs through all phases without errors."""
        orchestrator = campaign_orchestrator.CampaignOrchestrator("example.com", "employee@example.com")
        orchestrator.run_campaign()

        mock_recon.assert_called_once_with("example.com")
        mock_initial_access.assert_called_once()
        # In the orchestrator, the persistence and exfiltration calls are commented out, so they should not be called.
        mock_persistence.assert_not_called()
        mock_exfiltrate.assert_not_called()

if __name__ == '__main__':
    unittest.main()
