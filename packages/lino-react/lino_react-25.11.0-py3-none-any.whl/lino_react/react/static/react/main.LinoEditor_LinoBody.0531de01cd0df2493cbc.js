"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[5375],{2983:(e,t,n)=>{n.r(t),n.d(t,{LinoEditor:()=>k,name:()=>A});var a=n(8168),l=n(467),r=n(4467),o=n(3029),i=n(2901),c=n(6822),s=n(5501),u=n(3954),m=n(991),d=n(4756),p=n.n(d),f=n(6540),b=n(6606),g=n(7970),v=n(2756);n(1151);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function q(e,t,n,a){var l=(0,m.A)((0,u.A)(1&a?e.prototype:e),t,n);return 2&a&&"function"==typeof l?function(e){return l.apply(n,e)}:l}var w,A="LinoEditor";w={AbortController:n.e(4166).then(n.t.bind(n,5568,23)),i18n:Promise.all([n.e(1304),n.e(8605),n.e(7211)]).then(n.bind(n,2292)),prContextMenu:Promise.all([n.e(8026),n.e(8887),n.e(5573),n.e(6836),n.e(1493)]).then(n.bind(n,3181)),prUtils:n.e(8026).then(n.bind(n,4881))};(0,b.RegisterImportPool)(w);var k=function(e){function t(e){var n,a,l,r;return(0,o.A)(this,t),a=this,l=t,r=[e],l=(0,u.A)(l),(n=(0,c.A)(a,y()?Reflect.construct(l,r||[],(0,u.A)(a).constructor):l.apply(a,r))).state=h(h({},n.state),{},{plain:"plain"===e.elem.field_options.format}),n.closeEditor=n.closeEditor.bind(n),n.onGlobalKeyDown=n.onGlobalKeyDown.bind(n),n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"prepare",value:(n=(0,l.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,q(t,"prepare",this,3)([]);case 1:this.controller=new this.ex.AbortController.default,this.ex.i18n=this.ex.i18n.default;case 2:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"onReady",value:function(){window.addEventListener("keydown",this.onGlobalKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onGlobalKeyDown),this.controller.abort()}},{key:"onGlobalKeyDown",value:function(e){"Escape"==e.code&&this.closeEditor(e)}},{key:"closeEditor",value:function(e){var t=this.c,n=function(){t.history.pushPath({pathname:"/api/".concat(t.value.packId,"/").concat(t.value.actorId,"/").concat(t.value.pk),params:t.actionHandler.defaultStaticParams()})};t.isModified()?t.actionHandler.discardModDConfirm({agree:n}):n()}},{key:"headerExtend",value:function(){var e=this;return f.createElement(f.Fragment,null,this.state.plain?(0,g.Zn)(this):g.PH.commonHeader(this),f.createElement("span",{className:"ql-formats"},f.createElement("button",{type:"button",onClick:function(){var t=(0,l.A)(p().mark(function t(n){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.c.actionHandler.submit({});case 1:t.sent.success&&e.closeEditor(n);case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),"aria-label":"Submit changes"},f.createElement("i",{className:"pi pi-save"})),f.createElement("button",{type:"button",onClick:this.closeEditor,"aria-label":"Close window"},f.createElement("i",{className:"pi pi-times"}))))}},{key:"render",value:function(){var e=this;return this.state.ready?f.createElement(b.URLContextType.Consumer,null,function(t){var n=t.controller.APP,r=(0,g.tA)(n,t.controller.actionHandler.silentFetch,e.controller.signal,t.controller.mentionValues,e.ex.i18n,e),o=r.modules,i=r.meta;return f.createElement("div",{className:"l-editor",spellCheck:!n.state.site_data.disable_spell_check,onContextMenu:(0,g.Y_)(e),onKeyDown:function(){var t=(0,l.A)(p().mark(function t(n){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.ctrlKey&&!n.metaKey||"KeyS"!==n.code){t.next=2;break}return n.stopPropagation(),n.preventDefault(),t.next=1,e.c.actionHandler.submit({});case 1:t.sent.success&&e.closeEditor(n),t.next=3;break;case 2:n.ctrlKey&&n.shiftKey&&"KeyL"==n.code?(n.stopPropagation(),n.preventDefault(),(0,g.TY)(e)):"Escape"!==n.code&&n.stopPropagation();case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},f.createElement("div",{id:i.toolbarID},e.headerExtend()),f.createElement(g.ki,{config:{modules:o,theme:"snow"},onTextChange:(0,g.zl)(e),onReady:function(t){window.elem=e,e.quill=t,(0,g.a7)(e,t),(0,g.kA)(t),t.focus()}}),f.createElement(e.ex.prContextMenu.ContextMenu,(0,a.A)({},(0,g.ZI)(e),{ref:function(t){return e.tableContextMenu=t}})),f.createElement("div",{id:"raw-editor-container",onKeyDown:function(e){return e.stopPropagation()}}))}):null}}]);var n}(v.LeafComponentInput);k.requiredModules=["i18n","AbortController","prContextMenu","prUtils"].concat(v.LeafComponentInput.requiredModules),k.iPool=Object.assign(w,v.LeafComponentInput.iPool.copy()),k.defaultProps=h(h({},v.LeafComponentInput.defaultProps),{},{leafIndex:0})},7970:(e,t,n)=>{n.d(t,{PH:()=>P,TY:()=>x,Y_:()=>v,ZI:()=>g,Zn:()=>C,a7:()=>E,kA:()=>q,ki:()=>i.Ay,tA:()=>h,zl:()=>y});var a=n(4467),l=n(296),r=n(5548),o=n(1356),i=n(1669),c=n(537),s=n(194),u=n(3117),m=n.n(u),d=n(6540),p=n(6606);n(5065);o.Ay.register("modules/imageDropAndPaste",c.A),o.Ay.register("modules/blotFormatter2",s.Ay),o.Ay.register({"blots/mention":r.Yj,"modules/mention":r.PX}),o.Ay.register("modules/htmlEditButton",m());var f,b=c.A.ImageData;f={queryString:Promise.all([n.e(4166),n.e(2298)]).then(n.bind(n,8091))};(0,p.RegisterImportPool)(f);var g=function(e){var t=e.ex.i18n,n=function(){return e.quill.focus(),e.quill.getModule("table")};return{model:[{command:function(e){n().insertColumnLeft()},icon:d.createElement("span",null," ⭰ "),label:t.t("Insert column left")},{command:function(e){n().insertColumnRight()},icon:d.createElement("span",null," ⭲ "),label:t.t("Insert column right")},{command:function(e){n().insertRowAbove()},icon:d.createElement("span",null," ⭱ "),label:t.t("Insert row above")},{command:function(e){n().insertRowBelow()},icon:d.createElement("span",null," ⭳ "),label:t.t("Insert row below")},{command:function(e){n().deleteColumn()},icon:"pi pi-delete-left",label:t.t("Delete column")},{command:function(e){n().deleteRow()},icon:"pi pi-eraser",label:t.t("Delete row")},{command:function(e){n().deleteTable()},icon:"pi pi-trash",label:t.t("Delete table")}]}},v=function(e){return e.state.plain?null:function(t){var n=e.quill.getModule("table").getTable();null!==(0,l.A)(n,1)[0]&&(t.preventDefault(),e.tableContextMenu.show(t))}},E=function(e,t){var n=e.getValue();e.state.plain?t.setText(n||""):t.clipboard.dangerouslyPasteHTML(n)},h=function(e,t,n,a,r,o){var i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c="l-ql-toolbar-".concat(o.props.elem.name),s={toolbar:"#".concat(c),mention:A({silentFetch:t,signal:n,mentionValues:a}),blotFormatter2:{debug:!0,resize:{useRelativeSize:!0},video:{registerBackspaceFix:!1}},table:!0};return i&&(s.htmlEditButton={msg:r.t('Edit HTML here, when you click "OK" the quill editor\'s contents will be replaced'),prependSelector:"div#raw-editor-container",okText:r.t("Ok"),cancelText:r.t("Cancel"),buttonTitle:r.t("Show HTML source")}),e.state.site_data.installed_plugins.includes("uploads")&&(s.imageDropAndPaste={handler:w(o)}),s.keyboard={bindings:{home:{key:"Home",shiftKey:null,handler:function(e,t){var n=o.quill,a=n.getLine(e.index),r=(0,l.A)(a,2),i=r[0];r[1];if(i&&"LI"===i.domNode.tagName){if(t.event.shiftKey){var c=i.offset(n.scroll);n.setSelection(c,e.index-c,"user")}else n.setSelection(i.offset(n.scroll),0,"user");return!1}return!0}}}},i||delete s.toolbar,{modules:s,meta:{toolbarID:c}}},y=function(e){return function(t,n,l){var r=e.quill,o=r.container.children[0],i=o?o.innerHTML:null,c=r.getText();if("<p><br></p>"===i&&(i=null),"api"===l){var s=r.container.children[0],u=document.createElement("div");if(u.innerHTML=e.getValue()||"",e.ex.prUtils.DomHandler.isEqualElement(s,u))return}!function(e,t){var n=t.textValue.slice(0,-1),l=(e.state.plain?n:t.htmlValue)||"";e.update((0,a.A)({},e.dataKey,l))}(e,{htmlValue:i,textValue:c,delta:t,source:l})}},q=function(e){e.getModule("toolbar").addHandler("image",function(t){var n;t&&((n=document.createElement("input")).setAttribute("type","file"),n.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),n.classList.add("ql-image"),n.addEventListener("change",function(t){var a,l=t.target.files;if(l.length>0){var r=(a=l[0]).type,o=new FileReader;o.onload=function(t){var l=t.target.result;w({quill:e})(l,r,new b(l,r,a.name)),n.value=""},o.readAsDataURL(a)}}),n.click())})},w=function(e){return function(t,n,a){var l=e.quill,r=(l.getSelection()||{}).index;(void 0===r||r<0)&&(r=l.getLength()),l.insertEmbed(r,"image",t)}},A=function(e){var t=e.silentFetch,n=e.signal,a=e.mentionValues;return{allowedChars:/^[A-Za-z0-9\s]*$/,mentionDenotationChars:window.App.state.site_data.suggestors,source:function(e,l,r){if(0===e.length){var o=a[r];l(o,e)}else f.resolve(["queryString"]).then(function(a){var o=a.queryString;t({path:"suggestions?".concat(o.default.stringify({query:e,trigger:r})),signal:n}).then(function(t){return l(t.suggestions,e)})})},listItemClass:"ql-mention-list-item",mentionContainerClass:"ql-mention-list-container",mentionListClass:"ql-mention-list",dataAttributes:["value","link","title","denotationChar"]}},k=d.createElement(d.Fragment,null,d.createElement("span",{className:"ql-formats"},d.createElement("select",{className:"ql-header",defaultValue:"0"},d.createElement("option",{value:"1"},"Header 1"),d.createElement("option",{value:"2"},"Header 2"),d.createElement("option",{value:"3"},"Header 3"),d.createElement("option",{value:"4"},"Header 4"),d.createElement("option",{value:"0"},"Normal")),d.createElement("select",{className:"ql-font"},d.createElement("option",{defaultValue:!0}),d.createElement("option",{value:"serif"}),d.createElement("option",{value:"monospace"}))),d.createElement("span",{className:"ql-formats"},d.createElement("select",{className:"ql-size"},d.createElement("option",{value:"small"}),d.createElement("option",{defaultValue:!0}),d.createElement("option",{value:"large"}),d.createElement("option",{value:"huge"}))),d.createElement("span",{className:"ql-formats"},d.createElement("button",{className:"ql-script",value:"sub"}),d.createElement("button",{className:"ql-script",value:"super"})),d.createElement("span",{className:"ql-formats"},d.createElement("button",{type:"button",className:"ql-bold","aria-label":"Bold"}),d.createElement("button",{type:"button",className:"ql-italic","aria-label":"Italic"}),d.createElement("button",{type:"button",className:"ql-underline","aria-label":"Underline"})),d.createElement("span",{className:"ql-formats"},d.createElement("select",{className:"ql-color"}),d.createElement("select",{className:"ql-background"})),d.createElement("span",{className:"ql-formats"},d.createElement("button",{type:"button",className:"ql-list",value:"ordered","aria-label":"Ordered List"}),d.createElement("button",{type:"button",className:"ql-list",value:"bullet","aria-label":"Unordered List"}),d.createElement("select",{className:"ql-align"},d.createElement("option",{defaultValue:!0}),d.createElement("option",{value:"center"}),d.createElement("option",{value:"right"}),d.createElement("option",{value:"justify"}))),d.createElement("span",{className:"ql-formats"},d.createElement("button",{type:"button",className:"ql-link","aria-label":"Insert Link"}),d.createElement("button",{type:"button",className:"ql-image","aria-label":"Insert Image"}),d.createElement("button",{type:"button",className:"ql-code-block","aria-label":"Insert Code Block"})),d.createElement("span",{className:"ql-formats"},d.createElement("button",{type:"button",className:"ql-clean","aria-label":"Remove Styles"}))),x=function(e){var t=e.props.urlParams.controller.APP.URLContext,n=(e.quill.getSelection()||{}).index;(void 0===n||n<0)&&(n=e.quill.getLength()),t.actionHandler.runAction({action_full_name:t.actionHandler.findUniqueAction("insert_reference").full_name,actorId:"about.About",response_callback:function(t){t.success&&e.quill.insertText(n,t.message)}})},C=function(e){return e.c.APP.state.site_data.installed_plugins.includes("memo")?d.createElement("span",{className:"ql-formats"},d.createElement("button",{type:"button",onClick:function(t){return x(e)},"aria-label":"Open link dialog"},d.createElement("i",{className:"pi pi-link"}))):null},P={header:k,commonHeader:function(e){return d.createElement(d.Fragment,null,k,C(e),d.createElement("span",{className:"ql-formats"},d.createElement("button",{type:"button",onClick:function(t){var n=e.ex.i18n.t("rows x columns"),l=e.ex.i18n.t("Rows"),r=e.ex.i18n.t("Columns"),o=e.props.urlParams.controller;o.APP.dialogFactory.createParamDialog(o,(0,a.A)((0,a.A)({},l,"IntegerFieldElement"),r,"IntegerFieldElement"),n,function(t){var n=parseInt(t.context.data[l]),a=parseInt(t.context.data[r]),o=e.quill.getModule("table");e.quill.focus(),o.insertTable(n,a);var i=t.current.root.props,c=i.factory,s=i.id;c.remove(s)})}},d.createElement("i",{className:"pi pi-table"}))))}}}}]);
//# sourceMappingURL=main.LinoEditor_LinoBody.0531de01cd0df2493cbc.js.map