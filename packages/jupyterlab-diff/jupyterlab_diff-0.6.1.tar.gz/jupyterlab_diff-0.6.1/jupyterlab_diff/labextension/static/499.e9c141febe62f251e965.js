"use strict";(self.webpackChunkjupyterlab_diff=self.webpackChunkjupyterlab_diff||[]).push([[499],{499:(e,t,o)=>{o.r(t),o.d(t,{default:()=>y});var i=o(762),r=o(424),l=o(544),n=o(356),s=o(325),c=o(198),a=o(24),d=o(337),h=o(332),u=o(694),f=o(256);class p extends f.Widget{constructor(e){var t,o;super(),this._toggleButton=null,this._cell=e.cell,this._cellFooterTracker=e.cellFooterTracker,this._originalSource=e.originalSource,this._newSource=e.newSource||e.cell.sharedModel.getSource(),this._trans=e.trans,this._showActionButtons=null===(t=e.showActionButtons)||void 0===t||t,this._openDiff=null===(o=e.openDiff)||void 0===o||o}addToFooter(){if(!this._cellFooterTracker||!this._cell)return;const e=this._cell.id,t=this._cellFooterTracker.getFooter(e);t&&(t.removeWidget("jupyterlab-diff"),t.removeToolbarItem("accept-diff"),t.removeToolbarItem("reject-diff"),t.removeToolbarItem("toggle-diff"),t.removeToolbarItem("compare"),t.addWidget(this),this._createButtons(t),this._cellFooterTracker.showFooter(e))}onAcceptClick(){this._cell&&(this._cell.sharedModel.setSource(this._newSource),this._closeDiffView())}onRejectClick(){this._cell&&(this._cell.sharedModel.setSource(this._originalSource),this._closeDiffView())}onToggleClick(){this.isHidden?this.show():this.hide()}_createButtons(e){if(this._toggleButton=new u.ToolbarButton({label:this._trans.__("Compare changes"),tooltip:this._trans.__("Compare changes"),enabled:!0,className:"jp-DiffView-toggle",onClick:()=>{this.onToggleClick()}}),e.addToolbarItemOnLeft("toggle-diff",this._toggleButton),this._showActionButtons){const t=new u.ToolbarButton({icon:u.undoIcon,tooltip:this._trans.__("Reject Changes"),enabled:!0,className:"jp-DiffView-reject",onClick:()=>this.onRejectClick()}),o=new u.ToolbarButton({icon:u.checkIcon,tooltip:this._trans.__("Accept Changes"),enabled:!0,className:"jp-DiffView-accept",onClick:()=>this.onAcceptClick()});e.addToolbarItemOnRight("reject-diff",t),e.addToolbarItemOnRight("accept-diff",o)}this._openDiff?this.show():this.hide()}_closeDiffView(){if(this._cellFooterTracker&&this._cell){const e=this._cell.id,t=this._cellFooterTracker.getFooter(e);t&&(t.removeWidget("jupyterlab-diff"),t.removeToolbarItem("accept-diff"),t.removeToolbarItem("reject-diff"),t.removeToolbarItem("toggle-diff"),t.removeToolbarItem("compare")),this._cellFooterTracker.hideFooter(e)}}}class _ extends p{constructor(e){super(e),this._splitView=null,this._originalCode=e.originalSource,this._modifiedCode=e.newSource,this.addClass("jp-SplitDiffView")}onAfterAttach(e){super.onAfterAttach(e),this._createSplitView()}onBeforeDetach(e){this._destroySplitView(),super.onBeforeDetach(e)}_createSplitView(){this._splitView||(this._splitView=new c.MergeView({a:{doc:this._originalCode,extensions:[h.basicSetup,(0,s.python)(),a.EditorView.editable.of(!1),d.jupyterTheme]},b:{doc:this._modifiedCode,extensions:[h.basicSetup,(0,s.python)(),a.EditorView.editable.of(!1),d.jupyterTheme]},parent:this.node}))}_destroySplitView(){this._splitView&&(this._splitView.destroy(),this._splitView=null)}}var w=o(195);function g(e){const{editorView:t,compartment:o,originalSource:i,newSource:r,isInitialized:l,sharedModel:n,onChunkChange:s,allowInlineDiffs:d=!1}=e,h=function(e,t){var o;return(0,c.unifiedMergeView)({original:e,allowInlineDiffs:null!==(o=null==t?void 0:t.allowInlineDiffs)&&void 0!==o&&o,mergeControls:(e,t)=>function(e,t){const o=document.createElement("button");o.className=`jp-merge-${e}-button`,o.onclick=e=>{e.preventDefault(),t(e)};const i=("accept"===e?u.checkIcon:u.undoIcon).element({tag:"span",elementSize:"small"});return o.appendChild(i),o}(e,t)})}(i,{allowInlineDiffs:d}),f=a.EditorView.updateListener.of((e=>{e.transactions.length>0&&s&&!function(e){const t=(0,c.getChunks)(e.state);return!!(t&&t.chunks.length>0)}(t)&&s()})),p=[h,f],_=[];l?_.push(o.reconfigure(p)):_.push(w.StateEffect.appendConfig.of(o.of(p))),n.setSource(r),t.dispatch({effects:_})}class b{constructor(e){var t,o;this.acceptAllButton=null,this.rejectAllButton=null,this.editor=e.editor,this._originalSource=e.originalSource,this._newSource=e.newSource,this.trans=e.trans,this.showActionButtons=null===(t=e.showActionButtons)||void 0===t||t,this.allowInlineDiffs=null!==(o=e.allowInlineDiffs)&&void 0!==o&&o,this._isInitialized=!1,this._isDisposed=!1,this._diffCompartment=new w.Compartment}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this.deactivate())}hideCellToolbar(){}showCellToolbar(){}activate(){this._applyDiff(),this.addToolbarButtons(),this.hideCellToolbar()}deactivate(){this.removeToolbarButtons(),this._cleanupEditor(),this.showCellToolbar()}_cleanupEditor(){const e=this._getEditorView();e&&e.dispatch({effects:[this._diffCompartment.reconfigure([])]})}acceptAll(){this.deactivate()}rejectAll(){this.getSharedModel().setSource(this._originalSource),this.deactivate()}_applyDiff(){const e=this._getEditorView();e?(g({editorView:e,compartment:this._diffCompartment,originalSource:this._originalSource,newSource:this._newSource,isInitialized:this._isInitialized,sharedModel:this.getSharedModel(),onChunkChange:()=>this.deactivate(),allowInlineDiffs:this.allowInlineDiffs}),this._isInitialized=!0):console.warn("No editor view found for diff")}_getEditorView(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.editor)||null}}class m extends b{constructor(e){super(e),this._wasRendered=!1,this._cell=e.cell,this._cellFooterTracker=e.cellFooterTracker,this.activate()}getSharedModel(){return this._cell.model.sharedModel}activate(){const{model:e}=this._cell;if("markdown"===e.type){const e=this._cell;e.rendered&&(this._wasRendered=!0,e.rendered=!1)}super.activate(),m._activeDiffCount++;const t=new MutationObserver((()=>{this.hideCellToolbar()}));t.observe(this._cell.node,{childList:!0,subtree:!0}),this._toolbarObserver=t}deactivate(){super.deactivate(),m._activeDiffCount=Math.max(0,m._activeDiffCount-1),this._wasRendered&&"markdown"===this._cell.model.type&&(this._cell.rendered=!0,this._wasRendered=!1),this._toolbarObserver&&(this._toolbarObserver.disconnect(),this._toolbarObserver=void 0)}hideCellToolbar(){const e=this._cell.node.querySelector("jp-toolbar");e&&(e.style.display="none")}showCellToolbar(){if(m._activeDiffCount>0)return;const e=this._cell.node.querySelector("jp-toolbar");e&&(e.style.display="")}addToolbarButtons(){if(!this._cellFooterTracker||!this._cell)return;const e=this._cell.id,t=this._cellFooterTracker.getFooter(e);t&&(this.acceptAllButton=new u.ToolbarButton({icon:u.checkIcon,label:this.trans.__("Accept All"),tooltip:this.trans.__("Accept all chunks"),enabled:!0,className:"jp-UnifiedDiff-acceptAll",onClick:()=>this.acceptAll()}),this.rejectAllButton=new u.ToolbarButton({icon:u.undoIcon,label:this.trans.__("Reject All"),tooltip:this.trans.__("Reject all chunks"),enabled:!0,className:"jp-UnifiedDiff-rejectAll",onClick:()=>this.rejectAll()}),this.showActionButtons&&(t.addToolbarItemOnRight("reject-all",this.rejectAllButton),t.addToolbarItemOnRight("accept-all",this.acceptAllButton)),this._cellFooterTracker.showFooter(e),this.hideCellToolbar())}removeToolbarButtons(){if(!this._cellFooterTracker||!this._cell)return;const e=this._cell.id,t=this._cellFooterTracker.getFooter(e);t&&(this.showActionButtons&&(t.removeToolbarItem("accept-all"),t.removeToolbarItem("reject-all")),this._cellFooterTracker.hideFooter(e),this.showCellToolbar())}}m._activeDiffCount=0;class S extends b{constructor(e){super(e),this._spacer=null,this._fileEditorWidget=e.fileEditorWidget,this.activate()}getSharedModel(){return this.editor.model.sharedModel}addToolbarButtons(){if(!this._fileEditorWidget||!this.showActionButtons)return;const e=this._fileEditorWidget.toolbar;e&&(e.node.hidden=!1,this._spacer=u.Toolbar.createSpacerItem(),this.acceptAllButton=new u.ToolbarButton({icon:u.checkIcon,label:this.trans.__("Accept All"),tooltip:this.trans.__("Accept all chunks"),enabled:!0,className:"jp-UnifiedFileDiff-acceptAll",onClick:()=>this.acceptAll()}),this.rejectAllButton=new u.ToolbarButton({icon:u.undoIcon,label:this.trans.__("Reject All"),tooltip:this.trans.__("Reject all chunks"),enabled:!0,className:"jp-UnifiedFileDiff-rejectAll",onClick:()=>this.rejectAll()}),e.addItem("diff-spacer",this._spacer),e.addItem("reject-all-diff",this.rejectAllButton),e.addItem("accept-all-diff",this.acceptAllButton))}removeToolbarButtons(){if(!this._fileEditorWidget)return;const e=this._fileEditorWidget.toolbar;e&&(this.showActionButtons&&(this._spacer&&(this._spacer.dispose(),this._spacer=null),this.acceptAllButton&&(this.acceptAllButton.dispose(),this.acceptAllButton=null),this.rejectAllButton&&(this.rejectAllButton.dispose(),this.rejectAllButton=null)),0===Array.from(e.names()).length&&(e.node.hidden=!0))}}const v="jupyterlab-diff";function T(e,t){const o=e.find((e=>e.context.path===t));return null!=o?o:e.currentWidget}function k(e,t){var o;const i=e.content,r=i.model;let l=null===(o=i.activeCell)||void 0===o?void 0:o.model;if(t&&r)for(let e=0;e<r.cells.length;e++){const o=r.cells.get(e);if(o.id===t){l=o;break}}return null!=l?l:null}const y=[{id:"jupyterlab-diff:split-cell-diff-plugin",description:"Show cell diff using side-by-side split view",requires:[n.ICellFooterTracker,i.INotebookTracker],optional:[r.ITranslator],autoStart:!0,activate:async(e,t,o,i)=>{const{commands:l}=e,n=(null!=i?i:r.nullTranslator).load(v);l.addCommand("jupyterlab-diff:split-cell-diff",{label:n.__("Show Cell Diff (Split View)"),describedBy:{args:{type:"object",properties:{cellId:{type:"string",description:n.__("ID of the cell to show diff for")},originalSource:{type:"string",description:n.__("Original source code to compare against")},newSource:{type:"string",description:n.__("New source code to compare with")},showActionButtons:{type:"boolean",description:n.__("Whether to show action buttons in the diff widget")},notebookPath:{type:"string",description:n.__("Path to the notebook containing the cell")},openDiff:{type:"boolean",description:n.__("Whether to open the diff widget automatically")}},required:["originalSource","newSource"]}},execute:async(e={})=>{const{cellId:i,originalSource:r,newSource:l,showActionButtons:s=!0,notebookPath:c,openDiff:a=!0}=e;if(!r||!l)return void console.error(n.__("Missing required arguments: originalSource and newSource"));const d=T(o,c);if(!d)return;const h=k(d,i);if(!h)return void console.error(n.__("Missing required arguments: cellId (or no active cell found)"));if(!t.getFooter(h.id))return void console.error(n.__("Footer not found for cell %1",h.id));const u={cell:h,cellFooterTracker:t,originalSource:r,newSource:l,showActionButtons:s,openDiff:a,trans:n};await async function(e){const{cell:t,cellFooterTracker:o,originalSource:i,newSource:r,trans:l,showActionButtons:n=!0,openDiff:s=!0}=e,c=new _({originalSource:i,newSource:r,cell:t,cellFooterTracker:o,showActionButtons:n,openDiff:s,trans:l});return c.addClass("jupyterlab-diff"),c.addToFooter(),c}(u)}})}},{id:"jupyterlab-diff:unified-cell-diff-plugin",description:"Show cell diff using unified view",requires:[n.ICellFooterTracker,i.INotebookTracker],optional:[r.ITranslator],autoStart:!0,activate:async(e,t,o,i)=>{const{commands:l}=e,n=(null!=i?i:r.nullTranslator).load(v),s=new Map;l.addCommand("jupyterlab-diff:unified-cell-diff",{label:n.__("Show Cell Diff (Unified)"),describedBy:{args:{type:"object",properties:{cellId:{type:"string",description:n.__("ID of the cell to show diff for")},originalSource:{type:"string",description:n.__("Original source code to compare against")},newSource:{type:"string",description:n.__("New source code to compare with")},showActionButtons:{type:"boolean",description:n.__("Whether to show action buttons for chunk acceptance")},allowInlineDiffs:{type:"boolean",description:n.__("Enable inline diffs (true) or disable (false)")},notebookPath:{type:"string",description:n.__("Path to the notebook containing the cell")}},required:["originalSource","newSource"]}},execute:async(e={})=>{const{cellId:i,originalSource:r,newSource:l,showActionButtons:c=!0,allowInlineDiffs:a=!1,notebookPath:d}=e;if(!r||!l)return void console.error(n.__("Missing required arguments: originalSource and newSource"));const h=T(o,d);if(!h)return;const u=k(h,i);if(!u)return void console.error(n.__("Missing required arguments: cellId (or no active cell found)"));const f=h.content.widgets.find((e=>e.model.id===u.id));if(!f||!f.editor)return void console.error(n.__("No editor found for cell %1",u.id));const p=s.get(u.id);p&&!p.isDisposed&&p.dispose();const _=await async function(e){return new m(e)}({cell:f,editor:f.editor,cellFooterTracker:t,originalSource:r,newSource:l,showActionButtons:c,allowInlineDiffs:a,trans:n});s.set(u.id,_)}})}},{id:"jupyterlab-diff:unified-file-diff-plugin",description:"Show file diff using unified view",requires:[l.IEditorTracker],optional:[r.ITranslator],autoStart:!0,activate:async(e,t,o)=>{const{commands:i}=e,l=(null!=o?o:r.nullTranslator).load(v),n=new Map;i.addCommand("jupyterlab-diff:unified-file-diff",{label:l.__("Diff File (Unified)"),describedBy:{args:{type:"object",properties:{filePath:{type:"string",description:l.__("Path to the file to diff. Defaults to current file in editor.")},originalSource:{type:"string",description:l.__("Original source code to compare against")},newSource:{type:"string",description:l.__("New source code to compare with")},showActionButtons:{type:"boolean",description:l.__("Whether to show action buttons for chunk acceptance. Defaults to true.")},allowInlineDiffs:{type:"boolean",description:l.__("Enable inline diffs (true) or disable (false)")}},required:["originalSource","newSource"]}},execute:async(e={})=>{var o;const{filePath:i,originalSource:r,newSource:s,showActionButtons:c=!0,allowInlineDiffs:a=!1}=e;if(!r||!s)return void console.error(l.__("Missing required arguments: originalSource and newSource"));let d=t.currentWidget;if(i){const e=t.find((e=>{var t;return(null===(t=e.context)||void 0===t?void 0:t.path)===i}));e&&(d=e)}if(d||(d=t.currentWidget),!d)return void console.error(l.__("No editor found for the file"));const h=d.content.editor;if(!h)return void console.error(l.__("No code editor found in the file widget"));const u=i||(null===(o=d.context)||void 0===o?void 0:o.path)||"default",f=n.get(u);f&&!f.isDisposed&&f.dispose();const p=await async function(e){return new S(e)}({editor:h,fileEditorWidget:d,originalSource:r,newSource:s,showActionButtons:c,allowInlineDiffs:a,trans:l});n.set(u,p)}})}}]}}]);