{% macro menu_category(menu, request) %}
{% if menu.is_visible(request) and menu.is_accessible(request) %}
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle {% if menu.is_active(request) %}active{% endif %}" data-bs-toggle="dropdown"
    href="#">
    <span class="nav-link-icon d-md-none d-lg-inline-block">
      {% if menu.icon %}<i class="{{ menu.icon }}"></i>{% endif %}
    </span>
    <span class="nav-link-title">{{ menu.display_name }}</span>
  </a>
  <div class="dropdown-menu show">
    <div class="dropdown-menu-columns">
      <div class="dropdown-menu-column">
        {% for sub_menu in menu.children %}
        {% if sub_menu.is_visible(request) and sub_menu.is_accessible(request) %}
        <a class="nav-link ps-lg-3 {% if sub_menu.is_active(request) %}active{% endif %}"
          href="{{ sub_menu.url(request) }}">
          <span class="nav-link-icon d-md-none d-lg-inline-block">
            {% if sub_menu.icon %}<i class="{{ sub_menu.icon }}"></i>{% endif %}
          </span>
          <span class="nav-link-title">{{ sub_menu.display_name }}</span>
        </a>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</li>
{% endif %}
{% endmacro %}

{% macro menu_item(menu, request) %}
{% if menu.is_visible(request) and menu.is_accessible(request) %}
<li class="nav-item">
  <a class="nav-link {% if menu.is_active(request) %}active{% endif %}" href="{{ menu.url(request) }}">
    <span class="nav-link-icon d-md-none d-lg-inline-block">
      {% if menu.icon %}<i class="{{ menu.icon }}"></i>{% endif %}
    </span>
    <span class="nav-link-title">{{ menu.display_name }}</span>
  </a>
</li>
{% endif %}
{% endmacro %}

{% macro display_menu(menu, request) %}
<div class="navbar-nav">
  {% for item in menu.items %}
  {% if item.type_ == "View" %}
  {{ menu_item(item, request) }}
  {% elif item.type_ == "Category" %}
  {{ menu_category(item, request) }}
  {% endif %}
  {% endfor %}
</div>
{% endmacro %}

{% macro render_field(field, mv, apply_class,kwargs={}) %}
<div class="form-row flex flex-wrap justify-start items-center gap-4 mb-3">
  <div class="mb-1 basis-full md:flex-1">

  {% if field.widget.input_type == 'checkbox' %}
    <div class="mt-2 flex align-center gap-4 {% if mv.only_view %} flex-col {% endif %}">
      {{ field.label(
        class_="label-text  !inline-block relative" + (' required' if field.flags.required else ''),
        **({'title': "This is a required field"} if field.flags.required else {})
      ) }}
      {% if mv.only_view  %}
      <div class="read-only bg-base-300 p-2 rounded">{{ field.data }}</div>
    {% else %}
      {{ field }}
    {% endif %}
    </div>
  {% else %}
  {{ field.label(
    class_="label-text py-2 px-1 !inline-block relative" + (' required' if field.flags.required else ''),
    **({'title': "This is a required field"} if field.flags.required else {})
  ) }}
  <div class="flex flex-col">
    {% if field.errors %}
    {{ field(class_="input w-full focus:outline-0 transition-all input-sm input-bordered focus:outline-offset-0 is-invalid") }}
    {% else %}
    {% if mv.only_view  %}
      <div class="read-only bg-base-300 p-2 rounded">{{ field.data }}</div>
    {% else %}
      {{ field|apply_class }}
      {% if field.id == "hashed_password" and mv.showed_passxxx %}
          <span class="pl-[5px] font-semibold py-2">
            Hashed Password: {{ mv.showed_passxxx }}
          </span>
      {% endif %}
    {% endif %}
    {% endif %}

    {% for error in field.errors %}
    <div class="invalid-feedback">{{ error }}</div>
    {% endfor %}
    {% if field.description %}
    <small class="text-muted">{{ field.description }}</small>
    {% endif %}
  </div>
{% endif %}
</div>
</div>
{% endmacro %}

{% macro render_form_fields(form, mv, apply_class,form_opts=None) %}
{% if form.hidden_tag is defined %}
{{ form.hidden_tag() }}
{% else %}
{% for f in form if f.widget.input_type == 'hidden' %}
{{ f }}
{% endfor %}
{% endif %}

{% for f in form if f.widget.input_type != 'hidden' %}
{{ render_field(f, mv, apply_class, kwargs) }}
{% endfor %}
{% endmacro %}
