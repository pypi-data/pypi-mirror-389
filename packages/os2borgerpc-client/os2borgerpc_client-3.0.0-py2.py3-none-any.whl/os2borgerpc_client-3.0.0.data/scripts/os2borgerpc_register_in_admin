#!python

import sys
import urllib.parse

from os2borgerpc.client.config import OS2borgerPCConfig
from os2borgerpc.client.admin_client import OS2borgerPCAdmin

computer_name = sys.argv[1]
site = sys.argv[2]

config = OS2borgerPCConfig()
configuration = config.get_data()

mac = configuration["mac"]
admin_url = configuration.get("admin_url", "https://os2borgerpc-admin.magenta.dk")
client_api_url = "/client-api/"

admin = OS2borgerPCAdmin(urllib.parse.urljoin(admin_url, client_api_url))

# Data collected, now register computer.

try:
    uid = admin.register_new_computer(mac, computer_name, site, configuration)
    config.set_value("uid", uid)
    config.save()

except Exception as e:
    print("Error:", str(e), file=sys.stderr)
    sys.exit(1)
