name: "Reusable - Scan"

on:
  workflow_call:
    inputs:
      stage-target:
        type: "string"
        required: true

jobs:
  image:
    name: "scan:${{ inputs.stage-target }}"
    runs-on: "ubuntu-24.04"
    container:
      image: "docker.io/semgrep/semgrep:1.140.0"
    steps:
      - name: "Checkout code"
        uses: "actions/checkout@v5"

      - name: "Run scans"
        run: "semgrep ci --no-suppress-errors"
        env:
          SEMGREP_APP_TOKEN: "${{ secrets.SEMGREP_APP_TOKEN }}"
