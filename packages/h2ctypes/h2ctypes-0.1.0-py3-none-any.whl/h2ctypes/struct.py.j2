import ctypes

class {{ struct_name }}(ctypes.Structure):
    _pack_ = {{ pack }}
    _field_ = (
{% for field_info in field_infos %}
        ( "{{ field_info['name'] }}", {{ field_info['ctypes'] }} ),
{% endfor %}
    )

    @staticmethod
    def field_names():
        return [{% for field_info in field_infos %}"{{field_info['name']}}",{% endfor %}]

    def field_vals(self):
        return [{% for field_info in field_infos %}self.{{field_info['name']}}, {% endfor %}]

    def get_bytes(self):
        return ctypes.string_at(ctypes.addressof(self), ctypes.sizeof(self))

    @staticmethod
    def _repr_cvalue(v):
        if hasattr(v, "_length_"):
            return list(map(_repr_cvalue, v))
        return v

    def __repr__(self):
        kvs = [f"{k}={self._repr_cvalue(getattr(self, k))}" for k, _ in self._fields_]
        return f"{self.__class__.__name__}({', '.join(kvs)})"
