<!-- Diff Groups -->
{% for group_key, group in groups.items() %}
{% if group.count > 0 %}
<div class="diff-group space-y-2" data-group="{{ group_key }}">
    <!-- Group Header (hidden for staged-only view or ungrouped 'changes' view) -->
    {% set hide_header = (group_key == 'staged' and not unstaged and not untracked) or (group_key == 'changes' and not untracked) %}
    {% if not hide_header %}
    <div class="group-header flex items-center space-x-3 px-2 py-2 cursor-pointer hover:bg-neutral-50 transition-colors rounded"
         onclick="toggleGroup('{{ group_key }}')">
        <span class="toggle-icon text-neutral-400 transition-transform duration-200" 
              data-expanded="true">â–¼</span>
        <h3 class="text-neutral-700">{{ group_key|title }}</h3>
        <span class="text-xs text-neutral-500 bg-neutral-100 px-2 py-1 rounded">
            {{ group.count }} files
        </span>
    </div>
    {% endif %}

    <!-- Group Files -->
    <div class="group-content space-y-4 {% if not hide_header %}ml-4{% endif %}" 
         data-group-content="{{ group_key }}">
        {% for file in group.files %}
        {% set group_name = group_key %}
        {% include "diff_file.html" with context %}
        {% endfor %}
    </div>
</div>
{% endif %}
{% endfor %}