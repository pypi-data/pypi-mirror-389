(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3785],{74833:function(e,t,s){var a=s(56127),l=/^\s+/;e.exports=function(e){return e?e.slice(0,a(e)+1).replace(l,""):e}},56127:function(e){var t=/\s/;e.exports=function(e){for(var s=e.length;s--&&t.test(e.charAt(s)););return s}},66726:function(e,t,s){var a=s(11611),l=s(82846),n=s(91936),r=Math.max,i=Math.min;e.exports=function(e,t,s){var o,d,u,c,m,p,y=0,g=!1,v=!1,h=!0;if("function"!=typeof e)throw TypeError("Expected a function");function f(t){var s=o,a=d;return o=d=void 0,y=t,c=e.apply(a,s)}function x(e){var s=e-p,a=e-y;return void 0===p||s>=t||s<0||v&&a>=u}function j(){var e,s,a,n=l();if(x(n))return k(n);m=setTimeout(j,(e=n-p,s=n-y,a=t-e,v?i(a,u-s):a))}function k(e){return(m=void 0,h&&o)?f(e):(o=d=void 0,c)}function b(){var e,s=l(),a=x(s);if(o=arguments,d=this,p=s,a){if(void 0===m)return y=e=p,m=setTimeout(j,t),g?f(e):c;if(v)return clearTimeout(m),m=setTimeout(j,t),f(p)}return void 0===m&&(m=setTimeout(j,t)),c}return t=n(t)||0,a(s)&&(g=!!s.leading,u=(v="maxWait"in s)?r(n(s.maxWait)||0,t):u,h="trailing"in s?!!s.trailing:h),b.cancel=function(){void 0!==m&&clearTimeout(m),y=0,o=p=d=m=void 0},b.flush=function(){return void 0===m?c:k(l())},b}},56141:function(e,t,s){var a=s(32866);e.exports=function(e,t){return a(e,t)}},82846:function(e,t,s){var a=s(77400);e.exports=function(){return a.Date.now()}},91936:function(e,t,s){var a=s(74833),l=s(11611),n=s(55193),r=0/0,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,d=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(n(e))return r;if(l(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=l(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var s=o.test(e);return s||d.test(e)?u(e.slice(2),s?2:8):i.test(e)?r:+e}},90988:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/systems",function(){return s(74233)}])},30952:function(e,t,s){"use strict";s.d(t,{f:function(){return o}});var a=s(24246),l=s(66726),n=s.n(l),r=s(27378),i=s(26917);let o=e=>{let{value:t,onChange:s,placeholder:l,...o}=e,[d,u]=(0,r.useState)(t);(0,r.useEffect)(()=>{u(t||"")},[t]);let c=n()(s,500),m=(0,r.useCallback)(e=>{u(e),c(e)},[]);return(0,a.jsx)(i.Z,{value:d,onChange:m,onClear:()=>{u(""),s("")},placeholder:l,...o})}},35287:function(e,t,s){"use strict";var a=s(24246),l=s(98227),n=s(88038),r=s.n(n);s(27378),t.Z=e=>{let{children:t,title:s,fullHeight:n,fullWidth:i,mainProps:o}=e;return(0,a.jsxs)(l.kCb,{"data-testid":s,direction:"column",height:n?"100vh":"calc(100vh - 48px)",width:i?"100vw":"calc(100vw - 240px)",children:[(0,a.jsxs)(r(),{children:[(0,a.jsxs)("title",{children:["Fides Admin UI - ",s]}),(0,a.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)(l.kCb,{px:10,py:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0,...o,children:t})]})}},33335:function(e,t,s){"use strict";s.d(t,{E:function(){return a}});let a=e=>e.toLowerCase().replace(/[ .]/g,"_").replace(/[^a-zA-Z0-9_<>-]/g,"")},74233:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return X}});var a=s(24246),l=s(98227),n=s(27378),r=s(35287),i=s(58754),o=s(86677),d=s(25980),u=s(77830),c=()=>{let{dictionaryService:e}=(0,d.hz)(),t=(0,o.useRouter)();return(0,a.jsxs)(l.jqI,{className:"absolute right-8 top-8",children:[e&&(0,a.jsx)(l.S0p,{trigger:["click"],menu:{items:[{label:"Create new system",key:"add-system",onClick:()=>t.push(u.N5)},{label:"Add multiple systems",key:"add-multiple-systems",onClick:()=>t.push(u.bJ)}]},children:(0,a.jsx)(l.wpx,{type:"primary","data-testid":"add-system-btn",icon:(0,a.jsx)(l.PJP._ME,{}),children:"Add system"})}),!e&&(0,a.jsx)(l.wpx,{type:"primary","data-testid":"add-system-btn",onClick:()=>t.push(u.N5),children:"Add new system"})]})},m=s(30952),p=s(812),y=s(65450),g=s(34090),v=s(83766),h=s.n(v),f=s(55484),x=s(97181),j=s(40324),k=s(28079),b=s(1315),_=s(92818);let w="all-suggested";var S=e=>{let{options:t,loading:s,name:r,suggestedDataUses:i,...o}=e,[d,u,{setValue:c}]=(0,g.U$)(r),m=!!(u.touched&&u.error),p=(0,n.useMemo)(()=>{let e=[],s=[];return null==t||t.forEach(t=>{i.includes(t.value)?e.push(t):s.push(t)}),{suggested:e,all:s}},[t,i]),y=p.suggested.length?[{label:"Select all suggested",value:w},{label:(0,a.jsxs)(l.vyj,{children:[(0,a.jsx)(l.QMR,{size:14}),(0,a.jsx)("span",{children:"Suggested data uses"})]}),value:"suggested",options:p.suggested},{label:(0,a.jsxs)(l.vyj,{children:[(0,a.jsx)(l.PJP.BBB,{}),(0,a.jsx)("span",{children:"All data uses"})]}),value:"all",options:p.all}]:p.all;return(0,a.jsxs)(l.jqI,{vertical:!0,gap:"small",children:[(0,a.jsx)(l.jqI,{align:"center",children:(0,a.jsx)(j.__,{htmlFor:o.id||r,fontSize:"xs",my:0,mr:1,children:"Data uses"})}),(0,a.jsx)(l.WPr,{options:y,mode:"multiple",placeholder:"Select data uses",allowClear:!0,loading:s,value:d.value,onChange:e=>{e.includes(w)?c(h()([...i,...e.filter(e=>e!==w)])):c(e)},status:m?"error":void 0,virtual:!1,...o}),(0,a.jsx)(j.Bc,{isInvalid:m,message:u.error,fieldName:d.name})]})},C=s(65735);let E=f.Ry().shape({name:f.Z_().required("Name is required").label("Name"),label_color:f.Z_().required("Color is required").label("Color"),systems:f.IX().of(f.Z_()).label("Systems"),data_uses:f.IX().of(f.Z_()).label("Data uses")});var T=e=>{let{selectedSystemKeys:t=[],onSubmit:s,onCancel:r,isSubmitting:i=!1}=e,{data:o=[],isLoading:d}=(0,k.fd)(),{data:u,isLoading:c}=(0,b.K3)(),m=(0,n.useMemo)(()=>o.map(e=>({label:e.name||e.fides_key,value:e.fides_key})),[o]),p=(0,n.useMemo)(()=>{var e;let s=null!==(e=null==u?void 0:u.filter(e=>t.includes(e.fides_key)))&&void 0!==e?e:[];return h()(null==s?void 0:s.flatMap(e=>e.privacy_declarations.map(e=>e.data_use)))},[u,t]),y=(0,n.useMemo)(()=>{var e;return null!==(e=null==u?void 0:u.map(e=>({label:e.name||e.fides_key,value:e.fides_key})))&&void 0!==e?e:[]},[u]),v={name:"",description:"",label_color:C.Ej.TAXONOMY_WHITE,systems:t,data_uses:[],active:!0};return(0,a.jsx)(g.J9,{initialValues:v,validationSchema:E,onSubmit:s,enableReinitialize:!0,children:e=>{let{isValid:t,dirty:s}=e;return(0,a.jsx)(g.l0,{children:(0,a.jsxs)(l.jqI,{vertical:!0,gap:"middle",children:[(0,a.jsx)(l.AntTypography.Title,{level:2,children:"Create system group"}),(0,a.jsx)(j.j0,{name:"name",label:"Name",isRequired:!0,variant:"stacked",placeholder:"Enter system group name"}),(0,a.jsx)(j.Ks,{name:"description",label:"Description",variant:"stacked",placeholder:"Enter system group description",resize:!1}),(0,a.jsx)(x.d,{name:"systems",label:"Systems",mode:"multiple",placeholder:"Select systems",options:y,layout:"stacked",allowClear:!0,loading:c}),(0,a.jsx)(_.Z,{name:"label_color",label:"Color"}),(0,a.jsx)(S,{name:"data_uses",options:m,loading:d,suggestedDataUses:p}),(0,a.jsxs)(l.jqI,{gap:"small",justify:"space-between",className:"pt-4",children:[(0,a.jsx)(l.wpx,{onClick:r,disabled:i,children:"Cancel"}),(0,a.jsx)(l.wpx,{type:"primary",htmlType:"submit",loading:i,disabled:!t||!s||i,"data-testid":"save-btn",children:"Create group"})]})]})})}})},I=s(31793),A=s(31883),P=e=>{let{selectedRowKeys:t,createModalIsOpen:s,setCreateModalIsOpen:r,handleCreateSystemGroup:i,handleBulkAddToGroup:o,groupMenuItems:u}=e,[c,m]=l.Pg3.useMessage(),[g,v]=(0,n.useState)(!1),[h]=(0,y.WP)(),{plus:f}=(0,d.hz)(),{data:x}=(0,I.wv)({page:1,size:100,include_external:!1}),[j]=(0,y.C9)(),k=(0,n.useCallback)(async e=>{let s=await h({data_steward:e,system_keys:t});(0,A.D4)(s)?c.error((0,p.e$)(s.error,"A problem occurred assigning stewards")):c.success("".concat(t.length," systems assigned to ").concat(e," successfully"))},[h,t,c]),b=async()=>{let e=await j(t);(0,A.D4)(e)?c.error((0,p.e$)(e.error,"A problem occurred deleting systems")):c.success("".concat(t.length," systems deleted successfully"))},_=(0,n.useMemo)(()=>{let e=[];return u.length&&f&&e.push(t.length?{key:"add-to-system-group",label:"Add to system group",children:[{key:"new-group",label:"Create new group +",onClick:()=>r(!0)},{type:"divider"},...u.map(e=>({key:e.key,label:e.label,onClick:()=>o(e.key)}))]}:{key:"new-group",label:"Create system group +",onClick:()=>r(!0)}),(null==x?void 0:x.items.length)&&e.push({key:"assign-data-steward",label:"Assign data steward",disabled:!t.length,children:x.items.map(e=>({key:e.username,label:e.username,onClick:()=>k(e.username)}))},{type:"divider"}),e.push({key:"delete",label:"Delete",disabled:!t.length,onClick:()=>{v(!0)}}),e},[u,f,null==x?void 0:x.items,t.length,r,o,k]);return(0,a.jsxs)(a.Fragment,{children:[m,(0,a.jsx)(l.$zI,{open:g,onCancel:()=>v(!1),onOk:b,okText:"Delete",okType:"danger",centered:!0,children:(0,a.jsxs)(l.AntTypography.Paragraph,{children:["Delete ",t.length," systems? This action cannot be undone."]})}),(0,a.jsx)(l.$zI,{open:s,destroyOnHidden:!0,onCancel:()=>r(!1),centered:!0,width:768,footer:null,children:(0,a.jsx)(T,{selectedSystemKeys:t.map(e=>e.toString()),onSubmit:i,onCancel:()=>r(!1)})}),(0,a.jsx)(l.S0p,{trigger:["click"],menu:{items:_},children:(0,a.jsx)(l.wpx,{icon:(0,a.jsx)(l.PJP._ME,{}),children:"Actions"})})]})},D=s(19904),M=s(26070),N=s(3110),z=s(99640),O=s(8125),q=s(16394),Z=s(33335),R=s(69353),$=s(88832),W=s(34929),F=e=>{let{privacyDeclarations:t,...s}=e,{getDataUseDisplayName:l}=(0,W.Z)(),n=t.map(e=>e.data_use).map(e=>({label:l(e),key:e}));return(0,a.jsx)(M.Q,{values:n,...s})},J=s(56141),G=s.n(J),K=s(22583);let U="update-system-groups-msg";var B=e=>{let{selectedGroups:t,allGroups:s,system:r,columnState:i,...o}=e,[d,u]=(0,n.useState)(!1),[c,m]=(0,n.useState)(t.map(e=>e.fides_key)),[y,g]=l.Pg3.useMessage(),[v]=(0,b.qQ)(),h=async()=>{if(u(!1),G()(c,t.map(e=>e.fides_key)))return;y.open({key:U,type:"loading",content:"Updating groups for ".concat(r.name,"...")});let e=await v({...r,system_groups:c});(0,A.D4)(e)?y.open({key:U,type:"error",content:(0,p.e$)(e.error,"Failed to update system groups")}):y.open({key:U,type:"success",content:"Groups updated for ".concat(r.name)}),setTimeout(()=>{y.destroy(U)},3e3)};return(0,a.jsxs)(l.jqI,{gap:"small",...o,children:[g,!d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.j8w,{onClick:()=>u(!0),addable:!0,"data-testid":"group-add-btn","aria-label":"Add group"}),(0,a.jsx)(M.Q,{values:t.map(e=>e&&{label:e.name,key:e.fides_key,tagProps:{color:e.label_color?"".concat(K.j[e.label_color]):void 0,bordered:!1}}),columnState:i})]}),d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.WPr,{options:s.map(e=>({label:e.name,value:e.fides_key})),mode:"tags",defaultValue:t.map(e=>e.fides_key),defaultOpen:!0,onChange:e=>{m(e)},onOpenChange:e=>{e||h()},onBlur:()=>u(!1),"aria-label":"Select groups"}),(0,a.jsx)(l.wpx,{"aria-label":"Update groups",icon:(0,a.jsx)(l.PJP.MCw,{}),onClick:h})]})]})},Q=()=>{let{data:e}=(0,R.QD)(),t=(0,n.useMemo)(()=>e?e.reduce((e,t)=>({...e,[t.fides_key]:t}),{}):{},[e]),{data:s}=(0,I.wv)({page:1,size:100,include_external:!1}),[r]=(0,y.DW)(),[i]=(0,R.Xz)(),[u]=(0,R.Nr)(),[c,m]=(0,n.useState)(!1),[g,v]=(0,n.useState)(!1),[f,x]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1),[b,_]=(0,n.useState)(null),w=(0,O.o)({pagination:{defaultPageSize:25,pageSizeOptions:[25,50,100]},search:{defaultSearchQuery:""},sorting:{defaultSortKey:$.E.NAME,defaultSortOrder:"ascend",validColumns:[$.E.NAME]}}),{columnFilters:S,pageIndex:E,pageSize:T,searchQuery:P,updateSearch:W,sortKey:J,sortOrder:G}=w,{data:K,isLoading:U,isFetching:Q}=(0,y.xF)({page:E,size:T,search:P,sort_by:J,sort_asc:"ascend"===G,show_deleted:!0,...S}),V=(0,n.useMemo)(()=>{var e,t;return{enableSelection:!0,dataSource:null!==(e=null==K?void 0:K.items)&&void 0!==e?e:[],totalRows:null!==(t=null==K?void 0:K.total)&&void 0!==t?t:0,isLoading:U,isFetching:Q,getRowKey:e=>e.fides_key,customTableProps:{locale:{emptyText:(0,a.jsx)("div",{children:"No systems found"})}}}},[K,U,Q]),{tableProps:X,selectionProps:L}=(0,O.V)(w,V),{selectedRowKeys:H}=null!=L?L:{},[Y,ee]=l.Pg3.useMessage(),{plus:et}=(0,d.hz)(),es=(0,o.useRouter)(),ea=(0,D.Tg)([C.Sh.SYSTEM_DELETE]),el=async e=>{let t=await r(e.fides_key);(0,A.D4)(t)?Y.error((0,p.e$)(t.error,"Failed to delete system")):Y.success("Successfully deleted system"),k(!1)},en=async e=>{let t={...e,fides_key:(0,Z.E)(e.name),active:!0},s=await u(t);if((0,A.D4)(s))Y.error((0,p.e$)(s.error));else{var a,l;let e="System group '".concat(s.data.name,"' created");(null===(a=s.data.systems)||void 0===a?void 0:a.length)===1?e+=" with system '".concat(s.data.systems[0],"'"):(null===(l=s.data.systems)||void 0===l?void 0:l.length)&&(e+=" with ".concat(s.data.systems.length," systems")),Y.success(e)}x(!1)},er=(0,n.useCallback)(async e=>{var s;if(!H)return;let a=t[e],l=await i({...a,systems:h()([...null!==(s=a.systems)&&void 0!==s?s:[],...H.map(e=>e.toString())])});(0,A.D4)(l)?Y.error((0,p.e$)(l.error)):Y.success("".concat(null==H?void 0:H.length," systems added to group '").concat(e,"'"))},[t,i,H,Y]),ei=(0,n.useMemo)(()=>{var t;return null!==(t=null==e?void 0:e.map(e=>({key:e.fides_key,label:e.name,onClick:()=>er(e.fides_key)})))&&void 0!==t?t:[]},[e,er]);return{tableProps:X,selectionProps:L,columns:(0,n.useMemo)(()=>{var n;return[{title:"Name",dataIndex:"name",key:$.E.NAME,render:(e,t)=>(0,a.jsx)(z.Z,{href:"/systems/configure/".concat(t.fides_key),"data-testid":"system-link-".concat(t.fides_key),children:e||t.fides_key}),ellipsis:!0,fixed:"left",sorter:!0,sortOrder:J===$.E.NAME?G:null},{dataIndex:"system_groups",key:$.E.SYSTEM_GROUPS,render:(s,l)=>{var n;return(0,a.jsx)(B,{selectedGroups:null!==(n=null==s?void 0:s.map(e=>null==t?void 0:t[e]).filter(e=>!!e))&&void 0!==n?n:[],allGroups:e,system:{...l,system_groups:null!=s?s:[]},columnState:{isWrapped:!0,isExpanded:c},className:"w-[432px]"})},title:"Groups",hidden:!et,menu:{items:N.DI,onClick:e=>{e.domEvent.stopPropagation(),"expand-all"===e.key?m(!0):"collapse-all"===e.key&&m(!1)}},filters:(0,q.nZ)(null==e?void 0:e.map(e=>e.fides_key),e=>{var s,a;return null!==(a=null===(s=t[e])||void 0===s?void 0:s.name)&&void 0!==a?a:e}),filteredValue:(null==S?void 0:S.system_groups)||null},{title:"Data uses",menu:{items:N.DI,onClick:e=>{e.domEvent.stopPropagation(),"expand-all"===e.key?v(!0):"collapse-all"===e.key&&v(!1)}},dataIndex:"privacy_declarations",key:$.E.DATA_USES,render:e=>(0,a.jsx)(F,{privacyDeclarations:e,columnState:{isWrapped:!0,isExpanded:g}})},{title:"Data stewards",dataIndex:"data_stewards",key:$.E.DATA_STEWARDS,render:e=>(0,a.jsx)(M.v,{values:null!=e?e:[],valueSuffix:"users"}),filters:(0,q.nZ)(null==s?void 0:null===(n=s.items)||void 0===n?void 0:n.map(e=>e.username)),filteredValue:(null==S?void 0:S.data_stewards)||null},{title:"Description",dataIndex:"description",key:$.E.DESCRIPTION,render:e=>(0,a.jsx)("div",{className:"max-w-96",children:(0,a.jsx)(l.AntTypography.Text,{ellipsis:{tooltip:e},children:e})}),ellipsis:!0},{title:"Actions",key:$.E.ACTIONS,render:(e,t)=>(0,a.jsxs)(l.jqI,{gap:"small",children:[(0,a.jsx)(l.wpx,{size:"small",onClick:()=>es.push("/systems/configure/".concat(t.fides_key)),icon:(0,a.jsx)(l.PJP.I8b,{}),"data-testid":"edit-btn",children:"Edit"}),ea&&(0,a.jsx)(l.wpx,{size:"small",onClick:()=>{_(t),k(!0)},icon:(0,a.jsx)(l.PJP.ZNm,{}),"data-testid":"delete-btn",children:"Delete"})]}),fixed:"right"}]},[J,G,et,e,null==S?void 0:S.system_groups,null==S?void 0:S.data_stewards,null==s?void 0:s.items,c,t,g,ea,es]),searchQuery:P,updateSearch:W,columnFilters:S,pageIndex:E,pageSize:T,createModalIsOpen:f,setCreateModalIsOpen:x,deleteModalIsOpen:j,setDeleteModalIsOpen:k,setSelectedSystemForDelete:_,handleCreateSystemGroup:en,handleDelete:el,handleBulkAddToGroup:er,messageContext:ee,groupMenuItems:ei,selectedSystemForDelete:b}},V=()=>{var e,t;let{tableProps:s,selectionProps:n,columns:r,searchQuery:i,updateSearch:o,createModalIsOpen:d,setCreateModalIsOpen:u,deleteModalIsOpen:c,setDeleteModalIsOpen:p,handleDelete:y,handleCreateSystemGroup:g,handleBulkAddToGroup:v,messageContext:h,groupMenuItems:f,selectedSystemForDelete:x}=Q();return(0,a.jsxs)(a.Fragment,{children:[h,(0,a.jsxs)(l.jqI,{justify:"space-between",className:"mb-4",children:[(0,a.jsx)(m.f,{value:i,onChange:o,"data-testid":"system-search"}),(0,a.jsxs)(l.jqI,{gap:"small",children:[(0,a.jsx)(P,{selectedRowKeys:null!==(e=null==n?void 0:n.selectedRowKeys)&&void 0!==e?e:[],createModalIsOpen:d,setCreateModalIsOpen:u,handleCreateSystemGroup:g,handleBulkAddToGroup:v,groupMenuItems:f}),(0,a.jsx)(l.$zI,{open:c,onCancel:()=>p(!1),onOk:()=>!!x&&y(x),okText:"Delete",okType:"danger",cancelText:"Cancel",centered:!0,children:(0,a.jsxs)(l.AntTypography.Paragraph,{children:["Are you sure you want to delete"," ",null!==(t=null==x?void 0:x.name)&&void 0!==t?t:null==x?void 0:x.fides_key,"? This action cannot be undone."]})})]})]}),(0,a.jsx)(l.V5H,{...s,columns:r,rowSelection:n})]})},X=()=>(0,a.jsx)(r.Z,{title:"System inventory",children:(0,a.jsxs)(l.xuv,{"data-testid":"system-management",children:[(0,a.jsx)(i.Z,{heading:"System inventory",breadcrumbItems:[{title:"All systems"}],rightContent:(0,a.jsx)(c,{})}),(0,a.jsx)(V,{})]})})}},function(e){e.O(0,[431,7245,9965,5581,2888,9774,179],function(){return e(e.s=90988)}),_N_E=e.O()}]);