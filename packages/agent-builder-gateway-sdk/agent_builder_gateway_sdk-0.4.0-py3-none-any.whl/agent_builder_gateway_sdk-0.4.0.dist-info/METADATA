Metadata-Version: 2.4
Name: agent-builder-gateway-sdk
Version: 0.4.0
Summary: Python SDK for Agent Builder Gateway - ç”¨äº AI æ„å»ºçš„ç¨‹åºè°ƒç”¨é¢„åˆ¶ä»¶
Author: Agent Builder Team
License: MIT
License-File: LICENSE
Requires-Python: >=3.11
Requires-Dist: httpx>=0.27.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: python-dotenv>=1.0.0
Provides-Extra: dev
Requires-Dist: black>=24.0.0; extra == 'dev'
Requires-Dist: mypy>=1.8.0; extra == 'dev'
Requires-Dist: pytest-asyncio>=0.23.0; extra == 'dev'
Requires-Dist: pytest-cov>=4.1.0; extra == 'dev'
Requires-Dist: pytest>=8.0.0; extra == 'dev'
Requires-Dist: ruff>=0.1.0; extra == 'dev'
Description-Content-Type: text/markdown

# Gateway SDK

Python SDK for Gateway - ç”¨äºè°ƒç”¨é¢„åˆ¶ä»¶

## æ¦‚è¿°

Gateway SDK æ˜¯ä¸€ä¸ªç”¨äºè°ƒç”¨é¢„åˆ¶ä»¶çš„ Python SDKã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… ç®€æ´çš„ API
- âœ… æ”¯æŒ JWT Token å’Œ API Key è®¤è¯
- âœ… æµå¼å“åº”æ”¯æŒï¼ˆSSEï¼‰
- âœ… å®Œæ•´çš„ç±»å‹æç¤º
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

## å®‰è£…

```bash
pip install agent-builder-gateway-sdk
```

## å¿«é€Ÿå¼€å§‹

### åˆå§‹åŒ–å®¢æˆ·ç«¯

```python
from gateway_sdk import GatewayClient

# ä½¿ç”¨ JWT Token
client = GatewayClient(jwt_token="your-jwt-token")

# æˆ–ä½¿ç”¨ API Key
client = GatewayClient(api_key="sk-xxx")

# ç™½åå•æ¨¡å¼ï¼ˆé€‚ç”¨äº OpenHands ç­‰ç™½åå•ç¯å¢ƒï¼‰
client = GatewayClient()  # æ— éœ€æä¾›è®¤è¯ä¿¡æ¯
```

**ç™½åå•æ¨¡å¼è¯´æ˜**ï¼š
- å¦‚æœä½ çš„ç¯å¢ƒå·²é…ç½®ç™½åå•ï¼ˆå¦‚ OpenHandsã€å†…éƒ¨å¼€å‘ç¯å¢ƒï¼‰ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºå®¢æˆ·ç«¯è€Œæ— éœ€æä¾›è®¤è¯ä¿¡æ¯
- SDK ä¼šä»¥æ— é‰´æƒæ¨¡å¼å‘é€è¯·æ±‚ï¼Œç”± Gateway åŸºäº IP ç™½åå•è¿›è¡ŒéªŒè¯
- è¿™ç§æ¨¡å¼ç®€åŒ–äº†å¼€å‘æµç¨‹ï¼Œæ— éœ€ç®¡ç† token

### è°ƒç”¨é¢„åˆ¶ä»¶

```python
result = client.run(
    prefab_id="llm-client",
    version="1.0.0",
    function_name="chat",
    parameters={"messages": [{"role": "user", "content": "Hello"}]}
)

if result.is_success():
    print(result.get_result())
else:
    print(f"Error: {result.error}")
```

### é“¾å¼è°ƒç”¨

```python
llm = client.prefab("llm-client", "1.0.0")
result = llm.call("chat", messages=[...], model="gpt-4")
```

### æµå¼å“åº”

```python
for event in client.run(..., stream=True):
    if event.type == "content":
        print(event.data, end="", flush=True)
    elif event.type == "done":
        print("\nå®Œæˆ")
```

### æ‰¹é‡è°ƒç”¨

```python
from gateway_sdk import PrefabCall

calls = [
    PrefabCall(
        prefab_id="translator",
        version="1.0.0",
        function_name="translate",
        parameters={"text": "Hello", "target": "zh"}
    ),
    PrefabCall(
        prefab_id="translator",
        version="1.0.0",
        function_name="translate",
        parameters={"text": "World", "target": "zh"}
    )
]

result = client.run_batch(calls)
for r in result.results:
    if r.is_success():
        print(r.get_result())
```

### æ–‡ä»¶å¤„ç†

**é‡è¦**: SDK åªæ¥æ”¶ S3 URLï¼Œä¸è´Ÿè´£æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ã€‚

```python
# ä¼ é€’ S3 URL ä½œä¸ºæ–‡ä»¶è¾“å…¥
result = client.run(
    prefab_id="video-processor",
    version="1.0.0",
    function_name="extract_audio",
    parameters={"format": "mp3"},
    files={"video": ["s3://bucket/input.mp4"]}
)

# è¾“å‡ºæ–‡ä»¶ä¹Ÿæ˜¯ S3 URL
output_files = result.get_files()
# {"audio": ["s3://bucket/output.mp3"]}
```

**æ–‡ä»¶å¤„ç†æµç¨‹**:
1. ğŸ“¤ ä½¿ç”¨ S3 å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶ï¼Œè·å– S3 URL
2. ğŸ“ å°† S3 URL ä¼ é€’ç»™ SDK
3. ğŸ“¥ ä»è¿”å›çš„ S3 URL ä¸‹è½½ç»“æœæ–‡ä»¶

## API å‚è€ƒ

### GatewayClient

#### åˆå§‹åŒ–

```python
GatewayClient(
    base_url: str = "http://nodeport.sensedeal.vip:30566",
    api_key: Optional[str] = None,
    jwt_token: Optional[str] = None,
    timeout: int = 60
)
```

**å‚æ•°**ï¼š
- `api_key`: API Key
- `jwt_token`: JWT Token
- `timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

**æ³¨æ„**ï¼šå¿…é¡»æä¾› `api_key` æˆ– `jwt_token` ä¹‹ä¸€ã€‚

#### æ–¹æ³•

**run()** - æ‰§è¡Œå•ä¸ªé¢„åˆ¶ä»¶

```python
run(
    prefab_id: str,
    version: str,
    function_name: str,
    parameters: Dict[str, Any],
    files: Optional[Dict[str, List[str]]] = None,  # ä»…æ¥å— S3 URL
    stream: bool = False
) -> Union[PrefabResult, Iterator[StreamEvent]]
```

å‚æ•°:
- `files`: æ–‡ä»¶è¾“å…¥ï¼Œæ ¼å¼ä¸º `{"å‚æ•°å": ["s3://url1", "s3://url2"]}`ï¼Œ**ä»…æ¥å— S3 URL**

**run_batch()** - æ‰¹é‡æ‰§è¡Œ

```python
run_batch(calls: List[PrefabCall]) -> BatchResult
```

**prefab()** - è·å–é¢„åˆ¶ä»¶å¯¹è±¡

```python
prefab(prefab_id: str, version: str) -> Prefab
```

**list_prefabs()** - åˆ—å‡ºé¢„åˆ¶ä»¶

```python
list_prefabs(status: Optional[str] = None) -> List[PrefabInfo]
```

**get_prefab_spec()** - è·å–é¢„åˆ¶ä»¶è§„æ ¼

```python
get_prefab_spec(prefab_id: str, version: Optional[str] = None) -> Dict[str, Any]
```

### PrefabResult

é¢„åˆ¶ä»¶æ‰§è¡Œç»“æœã€‚

**å±æ€§**ï¼š
- `status`: è°ƒç”¨çŠ¶æ€ï¼ˆSUCCESS / FAILEDï¼‰
- `output`: è¾“å‡ºæ•°æ®
- `error`: é”™è¯¯ä¿¡æ¯
- `job_id`: ä»»åŠ¡ ID

**æ–¹æ³•**ï¼š
- `is_success()`: åˆ¤æ–­æ˜¯å¦æˆåŠŸ
- `get(key, default)`: è·å–è¾“å‡ºå­—æ®µ
- `get_result()`: è·å–ä¸šåŠ¡ç»“æœ
- `get_files()`: è·å–è¾“å‡ºæ–‡ä»¶

### StreamEvent

æµå¼äº‹ä»¶ã€‚

**å±æ€§**ï¼š
- `type`: äº‹ä»¶ç±»å‹ï¼ˆstart / content / progress / done / errorï¼‰
- `data`: äº‹ä»¶æ•°æ®

## é”™è¯¯å¤„ç†

```python
from gateway_sdk.exceptions import (
    GatewayError,
    AuthenticationError,
    PrefabNotFoundError,
    ValidationError,
    QuotaExceededError,
    ServiceUnavailableError,
    MissingSecretError,
)

try:
    result = client.run(...)
except AuthenticationError as e:
    print(f"è®¤è¯å¤±è´¥: {e}")
except PrefabNotFoundError as e:
    print(f"é¢„åˆ¶ä»¶ä¸å­˜åœ¨: {e}")
except MissingSecretError as e:
    print(f"ç¼ºå°‘å¯†é’¥: {e.secret_name}")
except QuotaExceededError as e:
    print(f"é…é¢è¶…é™: {e.used}/{e.limit}")
except GatewayError as e:
    print(f"é”™è¯¯: {e}")
```

## ç¤ºä¾‹ä»£ç 

- `examples/basic_usage.py` - åŸºç¡€ç”¨æ³•
- `examples/streaming.py` - æµå¼å“åº”

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•å¤„ç†è¶…æ—¶ï¼Ÿ**

A: è®¾ç½® `timeout` å‚æ•°ï¼š
```python
client = GatewayClient(jwt_token="...", timeout=120)
```

**Q: å¦‚ä½•è°ƒè¯•ï¼Ÿ**

A: å¯ç”¨æ—¥å¿—ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

**Q: å¦‚ä½•åœæ­¢æµå¼å“åº”ï¼Ÿ**

A: ä½¿ç”¨ `break` è·³å‡ºå¾ªç¯ï¼š
```python
for event in client.run(..., stream=True):
    if some_condition:
        break
```

## è®¸å¯è¯

MIT License
