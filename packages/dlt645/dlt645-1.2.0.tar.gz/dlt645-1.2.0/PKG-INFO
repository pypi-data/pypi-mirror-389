Metadata-Version: 2.4
Name: dlt645
Version: 1.2.0
Summary: DLT645åè®®Pythonå®ç°åº“
Home-page: https://gitee.com/chen-dongyu123/dlt645
Author: Chen Dongyu
Author-email: Chen Dongyu <1755696012@qq.com>
Maintainer-email: Chen Dongyu <1755696012@qq.com>
License: Apache License 2.0
Project-URL: Homepage, https://gitee.com/chen-dongyu123/dlt645
Project-URL: Repository, https://gitee.com/chen-dongyu123/dlt645
Project-URL: Issues, https://gitee.com/chen-dongyu123/dlt645/issues
Project-URL: Changelog, https://gitee.com/chen-dongyu123/dlt645/tree/master/python/CHANGELOG.md
Project-URL: Documentation, https://gitee.com/chen-dongyu123/dlt645/wiki
Keywords: dlt645,protocol,communication,energy,meter
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Communications
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.7
Description-Content-Type: text/markdown
Requires-Dist: loguru>=0.7.0
Requires-Dist: pyserial>=3.5
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov>=2.0; extra == "dev"
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: flake8>=3.8; extra == "dev"
Requires-Dist: mypy>=0.800; extra == "dev"
Dynamic: author
Dynamic: home-page
Dynamic: requires-python

# DLT645åè®®å¤šè¯­è¨€å®ç°åº“

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„DLT645ç”µèƒ½è¡¨é€šä¿¡åè®®çš„å¤šè¯­è¨€å®ç°é¡¹ç›®ï¼ŒåŒæ—¶æ”¯æŒC++ã€Pythonå’ŒGoä¸‰ç§ç¼–ç¨‹è¯­è¨€ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£å’ŒåŠŸèƒ½ã€‚

## ğŸŒ´é€šè®¯æ”¯æŒ

| åŠŸèƒ½                            | çŠ¶æ€ |
| ------------------------------- | ---- |
| **TCPå®¢æˆ·ç«¯ï¼ˆæ–¹ä¾¿é€šè®¯æµ‹è¯•ï¼‰** ğŸ¾ | âœ…    |
| **TCPæœåŠ¡ç«¯ï¼ˆæ–¹ä¾¿é€šè®¯æµ‹è¯•ï¼‰** ğŸ¾ | âœ…    |
| **RTUä¸»ç«™** ğŸ¾                   | âœ…    |
| **RTUä»ç«™** ğŸ¾                   | âœ…    |

## ğŸŒ´ åŠŸèƒ½å®Œæˆæƒ…å†µ

| åŠŸèƒ½                                           | çŠ¶æ€ |
| ---------------------------------------------- | -- |
| **è¯»ã€å†™é€šè®¯åœ°å€** ğŸ¾  | âœ…  |
| **å¹¿æ’­æ ¡æ—¶** ğŸ¾  | âœ…  |
| **ç”µèƒ½é‡** ğŸ¾  | âœ…  |
| **æœ€å¤§éœ€é‡åŠå‘ç”Ÿæ—¶é—´** ğŸ¾         | âœ… |
| **å˜é‡** ğŸ¾                | âœ… |
| **å‚å˜é‡** ğŸ¾            | âœ… |
| **äº‹ä»¶è®°å½•** ğŸ¾                 | âŒ |
| **å†»ç»“é‡** ğŸ¾               | âŒ |
| **è´Ÿè·çºªå½•** ğŸ¾           | âŒ |

å› ä¸ºæœ¬äººä½¿ç”¨DLT645åè®®éœ€æ±‚å¤§å¤šæ˜¯è¯»å–ç”µèƒ½è¡¨ä¸Šçš„ç”µèƒ½ã€éœ€é‡ã€å˜é‡ç­‰æ•°æ®ï¼Œåç»­çš„åŠŸèƒ½æš‚æ— å¼€å‘è®¡åˆ’ï¼Œå¦‚æœéœ€è¦å¯ä»¥è”ç³»æˆ‘

## é€‰æ‹©è¯­è¨€ç‰ˆæœ¬

è¯·é€‰æ‹©æ‚¨æ„Ÿå…´è¶£çš„è¯­è¨€ç‰ˆæœ¬æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š

- [C++ç‰ˆæœ¬](../cpp/README.md)
- Pythonç‰ˆæœ¬
- [Goç‰ˆæœ¬](../go/README.md)

## DLT645åè®®Pythonå®ç°åº“

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„DLT645ç”µèƒ½è¡¨é€šä¿¡åè®®Pythonå®ç°åº“ï¼Œæ”¯æŒTCPå’ŒRTUä¸¤ç§é€šä¿¡æ–¹å¼ï¼Œå¯ç”¨äºç”µèƒ½è¡¨æ•°æ®è¯»å†™å’Œé€šä¿¡æµ‹è¯•ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸŒ **å¤šç§é€šä¿¡æ–¹å¼**ï¼šæ”¯æŒTCPå’ŒRTUï¼ˆä¸²å£ï¼‰é€šä¿¡
- ğŸ“Š **å®Œæ•´åè®®æ”¯æŒ**ï¼šå®ç°DLT645åè®®çš„ä¸»è¦åŠŸèƒ½
- ğŸ”Œ **å®¢æˆ·ç«¯/æœåŠ¡ç«¯**ï¼šåŒæ—¶æä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŠŸèƒ½
- ğŸ“ˆ **å¤šç§æ•°æ®ç±»å‹**ï¼šæ”¯æŒç”µèƒ½é‡ã€æœ€å¤§éœ€é‡ã€å˜é‡æ•°æ®è¯»å†™
- ğŸ›¡ï¸ **è®¾å¤‡è®¤è¯**ï¼šæ”¯æŒè®¾å¤‡åœ°å€éªŒè¯å’Œå¯†ç ä¿æŠ¤
- ğŸ“ **å®Œå–„æ—¥å¿—**ï¼šå†…ç½®æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºè°ƒè¯•
- ğŸ¯ **æ˜“äºä½¿ç”¨**ï¼šç®€æ´çš„APIè®¾è®¡ï¼Œå¿«é€Ÿä¸Šæ‰‹

## æ”¯æŒçš„æ•°æ®ç±»å‹

- **ç”µèƒ½é‡æ•°æ®**ï¼ˆ00ç±»ï¼‰ï¼šæ­£å‘æœ‰åŠŸç”µèƒ½ã€åå‘æœ‰åŠŸç”µèƒ½ç­‰
- **æœ€å¤§éœ€é‡æ•°æ®**ï¼ˆ01ç±»ï¼‰ï¼šæœ€å¤§éœ€é‡åŠå‘ç”Ÿæ—¶é—´
- **å˜é‡æ•°æ®**ï¼ˆ02ç±»ï¼‰ï¼šå®æ—¶ç”µå‹ã€ç”µæµã€åŠŸç‡ç­‰
- **å‚å˜é‡æ•°æ®**ï¼ˆ04ç±»ï¼‰ï¼šè®¾å¤‡å‚æ•°ã€é…ç½®ä¿¡æ¯ç­‰

## å®‰è£…

```bash
pip install dlt645
```

## å¿«é€Ÿå¼€å§‹

### åˆ›å»ºTCPæœåŠ¡å™¨

```python
from dlt645 import MeterServerService

# åˆ›å»ºTCPæœåŠ¡å™¨
server_svc = MeterServerService.new_tcp_server("127.0.0.1", 8021, 3000)

# è®¾ç½®è®¾å¤‡åœ°å€
server_svc.set_address(b'\x01\x02\x03\x04\x05\x06')

# å†™ç”µèƒ½
server_svc.set_00(0x00000000, 50.5)
    
# å†™æœ€å¤§éœ€é‡
server_svc.set_01(0x01010000, Demand(78.0, datetime.strptime("2023-01-01 12:00:00", "%Y-%m-%d %H:%M:%S")))
        
# å†™å‚å˜é‡
server_svc.set_04(0x04000101, "25110201")   # 2025å¹´11æœˆ2æ—¥æ˜ŸæœŸä¸€
server_svc.set_04(0x04000204, "10") 		# è®¾ç½®è´¹ç‡æ•°ä¸º10

# å¯åŠ¨æœåŠ¡å™¨
server_svc.server.start()
```

![](../resource/python/1.png)

### åˆ›å»ºRTUæœåŠ¡å™¨

```python
from dlt645 import MeterServerService

# åˆ›å»ºRTUæœåŠ¡å™¨
server_svc = MeterServerService.new_rtu_server(port="COM11",data_bits=8,stop_bits=1,baud_rate=9600,parity="N",timeout=1.0)

# è®¾ç½®è®¾å¤‡åœ°å€
server_svc.set_address(b'\x01\x02\x03\x04\x05\x06')

# å†™ç”µèƒ½
server_svc.set_00(0x00000000, 50.5)
    
# å†™æœ€å¤§éœ€é‡
server_svc.set_01(0x01010000, Demand(78.0, datetime.strptime("2023-01-01 12:00:00", "%Y-%m-%d %H:%M:%S")))

# å¯åŠ¨æœåŠ¡å™¨
server_svc.server.start()
```

![](../resource/python/2.png)

### åˆ›å»ºTCPå®¢æˆ·ç«¯

```python
from dlt645 import MeterClientService

client_svc = MeterClientService.new_tcp_client("127.0.0.1", 10521, timeout=1)

# è¯»å–é€šè®¯åœ°å€
address_data = client_svc.read_address()

# è®¾ç½®é€šè®¯åœ°å€
client_svc.set_address(address_data.value)

# è¯»å–ç”µèƒ½æ•°æ®
data_item = client_svc.read_00(0x00000000)

# è¯»å–æœ€å¤§éœ€é‡åŠå‘ç”Ÿæ—¶é—´
data_item2 = client_svc.read_01(0x01010000)

# è¯»å–å˜é‡æ•°æ®
data_item3 = client_svc.read_02(0x02010100)

# è¯»å–å‚å˜é‡
data_item4 = client_svc.read_04(0x04000101)
print(f"æ—¥æœŸåŠæ˜ŸæœŸ: {data_item4}")

data_item5 = client_svc.read_04(0x04000204)
print(f"è´¹ç‡æ•°: {data_item5}")
```

![](../resource/python/3.png)

### åˆ›å»ºRTUå®¢æˆ·ç«¯

```python
from dlt645 import MeterClientService

# åˆ›å»ºRTUå®¢æˆ·ç«¯
client = MeterClientService.new_rtu_client(
    port="COM10",
    baudrate=9600,
    databits=8,
    stopbits=1,
    parity="N",
    timeout=0.5
)

# è¯»å–é€šè®¯åœ°å€
address_data = client_svc.read_address()

# è®¾ç½®é€šè®¯åœ°å€
client_svc.set_address(address_data.value)

# è¯»å–ç”µèƒ½æ•°æ®
data_item = client_svc.read_00(0x00000000)

# è¯»å–æœ€å¤§éœ€é‡åŠå‘ç”Ÿæ—¶é—´
data_item2 = client_svc.read_01(0x01010000)

# è¯»å–å˜é‡æ•°æ®
data_item3 = client_svc.read_02(0x02010100)

# è¯»å–å‚å˜é‡
data_item4 = client_svc.read_04(0x04000101)
print(f"æ—¥æœŸåŠæ˜ŸæœŸ: {data_item4}")

data_item5 = client_svc.read_04(0x04000204)
print(f"è´¹ç‡æ•°: {data_item5}")
```
![](../resource/python/4.png)

### ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æµ‹è¯•

æµ‹è¯•æ•ˆæœ

![](../resource/python/5.gif)

## APIå‚è€ƒ

### æœåŠ¡å™¨ç«¯API

#### MeterServerService

ä¸»è¦çš„æœåŠ¡å™¨æœåŠ¡ç±»ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š
- `new_tcp_server(ip: str, port: int, timeout: float)` - åˆ›å»ºTCPæœåŠ¡å™¨ï¼ˆç±»æ–¹æ³•ï¼‰
- `new_rtu_server(port: str, data_bits: int, stop_bits: int, baud_rate: int, parity: str, timeout: float)` - åˆ›å»ºRTUæœåŠ¡å™¨ï¼ˆç±»æ–¹æ³•ï¼‰
- `set_00(di: int, value: float)` - è®¾ç½®ç”µèƒ½é‡æ•°æ®
- `set_01(di: int, demand: Demand)` - è®¾ç½®æœ€å¤§éœ€é‡æ•°æ®
- `set_02(di: int, value: float)` - è®¾ç½®å˜é‡æ•°æ®
- `set_04(di: int, value: float)` - è®¾ç½®å‚å˜é‡æ•°æ®
- `set_address(address: bytearray)` - è®¾ç½®è®¾å¤‡åœ°å€
- `set_password(password: bytearray)` - è®¾ç½®å¯†ç 

### å®¢æˆ·ç«¯API

#### MeterClientService

ä¸»è¦çš„å®¢æˆ·ç«¯æœåŠ¡ç±»ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š

- `new_tcp_client(ip: str, port: int, timeout: float)` - åˆ›å»ºTCPå®¢æˆ·ç«¯ï¼ˆç±»æ–¹æ³•ï¼‰
- `new_rtu_client(port: str, baudrate: int, databits: int, stopbits: int, parity: str, timeout: float)` - åˆ›å»ºRTUå®¢æˆ·ç«¯ï¼ˆç±»æ–¹æ³•ï¼‰
- `read_00(di: int)` - è¯»å–ç”µèƒ½é‡æ•°æ®
- `read_01(di: int)` - è¯»å–æœ€å¤§éœ€é‡æ•°æ®
- `read_02(di: int)` - è¯»å–å˜é‡æ•°æ®
- `read_04(di: int)` - è¯»å–å‚å˜é‡æ•°æ®
- `read_address()` - è¯»å–è®¾å¤‡åœ°å€
- `write_address(new_address: bytes)` - å†™å…¥è®¾å¤‡åœ°å€
- `set_address(address: bytes)` - è®¾ç½®æœ¬åœ°è®¾å¤‡åœ°å€
- `set_password(password: bytes)` - è®¾ç½®å¯†ç 

## æ•°æ®æ ‡è¯†è¯´æ˜

DLT645åè®®ä½¿ç”¨4å­—èŠ‚çš„æ•°æ®æ ‡è¯†æ¥æ ‡è¯†ä¸åŒçš„æ•°æ®é¡¹ï¼š

### ç”µèƒ½é‡æ•°æ®ï¼ˆ00ç±»ï¼‰
- `0x00000000` - æ€»æœ‰åŠŸç”µèƒ½
- `0x00010000` - æ­£å‘æœ‰åŠŸç”µèƒ½
- `0x00020000` - åå‘æœ‰åŠŸç”µèƒ½

### æœ€å¤§éœ€é‡æ•°æ®ï¼ˆ01ç±»ï¼‰  
- `0x01000000` - æ€»æœ€å¤§éœ€é‡
- `0x01010000` - æ­£å‘æœ€å¤§éœ€é‡

### å˜é‡æ•°æ®ï¼ˆ02ç±»ï¼‰
- `0x02010100` - Aç›¸ç”µå‹
- `0x02010200` - Bç›¸ç”µå‹
- `0x02010300` - Cç›¸ç”µå‹
- `0x02020100` - Aç›¸ç”µæµ
- `0x02020200` - Bç›¸ç”µæµ
- `0x02020300` - Cç›¸ç”µæµ

### å‚å˜é‡æ•°æ®ï¼ˆ04ç±»ï¼‰
- `0x04000101` - æ—¥æœŸåŠæ˜ŸæœŸ(0ä»£è¡¨æ˜ŸæœŸå¤©)
- `0x04000102` - æ—¶é—´

## é…ç½®æ–‡ä»¶

åº“åŒ…å«äº†ä¸°å¯Œçš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†å„ç§æ•°æ®ç±»å‹ï¼š

- `config/energy_types.json` - ç”µèƒ½é‡æ•°æ®ç±»å‹é…ç½®
- `config/demand_types.json` - æœ€å¤§éœ€é‡æ•°æ®ç±»å‹é…ç½®  
- `config/variable_types.json` - å˜é‡æ•°æ®ç±»å‹é…ç½®
- `config/parameter_types.json` - å‚å˜é‡æ•°æ®ç±»å‹é…ç½®

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚

- Python >= 3.7
- loguru >= 0.5.0
- pyserial >= 3.4

### è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -e .[dev]

# è¿è¡Œæµ‹è¯•
pytest
```

### è°ƒè¯•æ—¥å¿—

åº“ä½¿ç”¨loguruè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```python
from loguru import logger
logger.add("dlt645.log", level="DEBUG")
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†é€šä¿¡è¶…æ—¶ï¼Ÿ
A: å¯ä»¥åœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶è®¾ç½®timeoutå‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨try-catchæ•è·è¶…æ—¶å¼‚å¸¸ã€‚

### Q: æ”¯æŒå“ªäº›ä¸²å£å‚æ•°ï¼Ÿ
A: æ”¯æŒæ ‡å‡†çš„ä¸²å£å‚æ•°ï¼šæ³¢ç‰¹ç‡ï¼ˆ1200-115200ï¼‰ã€æ•°æ®ä½ï¼ˆ7-8ï¼‰ã€åœæ­¢ä½ï¼ˆ1-2ï¼‰ã€æ ¡éªŒä½ï¼ˆN/E/Oï¼‰ã€‚

### Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Ÿ
A: å¯ä»¥ä¿®æ”¹configç›®å½•ä¸‹çš„JSONé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æ–°çš„æ•°æ®æ ‡è¯†å’Œæ ¼å¼å®šä¹‰ã€‚

## è®¸å¯è¯

Apache License 2.0

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## è”ç³»æ–¹å¼

- ä½œè€…ï¼šChen Dongyu
- é‚®ç®±ï¼š1755696012@qq.com
- é¡¹ç›®åœ°å€ï¼šhttps://gitee.com/chen-dongyu123/dlt645
