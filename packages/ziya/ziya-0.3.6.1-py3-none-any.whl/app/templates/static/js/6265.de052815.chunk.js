"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[6265],{46265:(e,n,t)=>{t.r(n),t.d(n,{default:()=>z});var s=t(65043),i=t(85271),o=t(6381),r=t(32442),a=t(42214),l=t(10491),d=t(6051),c=t(94828),m=t(15492),g=t(57721),h=t(15615),u=t(88143),x=t(31219),p=t(33359),y=t(70579);const v=e=>{let{index:n,isInline:t=!1}=e;const{currentMessages:i,currentConversationId:v,addMessageToConversation:f,setIsStreaming:j,setConversations:C,streamingConversations:w,addStreamingConversation:b,streamedContentMap:A,setStreamedContentMap:M,removeStreamingConversation:S,editingMessageIndex:k,setEditingMessageIndex:I}=(0,o.v)(),[R,z]=(0,s.useState)(i[n].content),{checkedKeys:N}=(0,a.X)(),E=(0,s.useRef)(null),{TextArea:K}=l.A,$=k===n;(0,s.useEffect)(()=>{$&&E.current&&setTimeout(()=>{E.current&&E.current.focus()},100)},[$]);return(0,y.jsxs)("div",{children:[t&&$&&null,$&&!t&&(0,y.jsxs)("div",{style:{width:"100%"},children:[(0,y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",width:"100%"},children:[(0,y.jsx)("div",{className:"message-sender",children:"You:"}),(0,y.jsxs)(d.A,{children:[(0,y.jsx)(c.A,{title:"Cancel editing",children:(0,y.jsx)(m.Ay,{icon:(0,y.jsx)(h.A,{}),onClick:()=>{I(null),z(i[n].content)},size:"small",children:"Cancel"})}),(0,y.jsx)(c.A,{title:"Save changes to context",children:(0,y.jsx)(m.Ay,{icon:(0,y.jsx)(u.A,{}),onClick:()=>{C(e=>e.map(e=>{if(e.id===v){const t=e.messages.map((e,t)=>t===n?{...e,content:R,_timestamp:Date.now()}:e);return{...e,messages:t,_version:Date.now()}}return e})),I(null)},size:"small",children:"Save"})}),(0,y.jsx)(c.A,{title:"Send to model, remove newer responses",children:(0,y.jsx)(m.Ay,{icon:(0,y.jsx)(x.A,{}),onClick:async()=>{I(null),M(new Map);const e=i.slice(0,n+1);e[n]={...e[n],content:R,_timestamp:Date.now(),_edited:!0,_truncatedAfter:!0},C(n=>n.map(n=>n.id===v?{...n,messages:e,_version:Date.now(),_editInProgress:!0}:n)),b(v);try{const n=await(0,r.f)(e,R,(0,g.F)(N),v,A,M,j,S,f,w.has(v));if(n){f({content:n,role:"assistant"},v),C(e=>e.map(e=>e.id===v?{...e,_editInProgress:!1}:e))}}catch(t){console.error("Error sending message:",t),S(v)}finally{j(!1)}},size:"small",type:"primary",children:"Submit"})})]})]}),(0,y.jsx)(K,{ref:E,autoFocus:!0,style:{width:"100%",minHeight:"100px",resize:"vertical"},value:R,onChange:e=>z(e.target.value),autoSize:{minRows:3,maxRows:20},placeholder:"Edit your message..."})]}),!$&&(t||!$)&&(0,y.jsx)(c.A,{title:"Edit",children:(0,y.jsx)(m.Ay,{icon:(0,y.jsx)(p.A,{}),onClick:()=>{I(n)}})})]})};var f=t(91686),j=t(42144),C=t(22643),w=t(9356),b=t(8347);const A=(0,s.memo)(e=>{let{previousModel:n,newModel:t,changeKey:s}=e;const{isDarkMode:i}=(0,b.D)(),o={container:{padding:"12px 16px",borderRadius:"8px",backgroundColor:i?"rgba(25, 118, 210, 0.15)":"rgba(25, 118, 210, 0.08)",border:"1px solid "+(i?"#2c6cb0":"#90caf9"),marginBottom:"12px",marginTop:"4px",display:"flex",alignItems:"center",boxShadow:i?"0 2px 8px rgba(0, 0, 0, 0.15)":"0 1px 3px rgba(0, 0, 0, 0.1)"},icon:{fontSize:"20px",marginRight:"12px",color:i?"#90caf9":"#1976d2"},text:{color:i?"#e3f2fd":"#0d47a1",fontWeight:500,fontSize:"14px"},modelName:{fontWeight:600,color:i?"#bbdefb":"#1565c0"}};return(0,y.jsxs)("div",{style:o.container,children:[(0,y.jsx)("span",{style:o.icon,children:"\ud83d\udd04"}),(0,y.jsxs)("span",{style:o.text,children:["Model changed from ",(0,y.jsx)("span",{style:o.modelName,children:n})," to ",(0,y.jsx)("span",{style:o.modelName,children:t})]})]})},(e,n)=>(!e.changeKey||!n.changeKey||e.changeKey===n.changeKey)&&(e.previousModel===n.previousModel&&e.newModel===n.newModel&&e.changeKey===n.changeKey));A.displayName="ModelChangeNotification";const M=A;var S=t(8627),k=t(89277),I=t(35589);const R=(0,s.memo)(e=>{let{enableCodeApply:n}=e;const{currentMessages:t,editingMessageIndex:l,isTopToBottom:d,isLoadingConversation:h,addStreamingConversation:u,streamingConversations:x,currentConversationId:p,setIsStreaming:b,setStreamedContentMap:A,isStreaming:R,addMessageToConversation:z,removeStreamingConversation:N,streamedContentMap:E,userHasScrolled:K,updateProcessingState:$,setConversations:_,toggleMessageMute:T}=(0,o.v)(),{checkedKeys:D}=(0,a.X)(),{setQuestion:F}=(0,S.J)(),L=(0,s.useRef)(!0),W=(0,s.useMemo)(()=>({isCurrentlyStreaming:x.has(p),hasStreamedContent:E.has(p)&&""!==E.get(p),streamedContent:E.get(p)||""}),[x,E,p]),{isCurrentlyStreaming:Y,hasStreamedContent:B}=W,H=t.length>50,P=(0,s.useCallback)(e=>{let{index:n,style:s}=e;const i=d?n:t.length-1-n,o=t[i];return o?(0,y.jsx)("div",{style:s,className:`message ${o.role||""}${o.muted?" muted":""}`}):(0,y.jsx)("div",{style:s})},[t,d]),O=H?null:d?t:[...t].reverse(),Q=(0,s.useRef)(0),U=(0,s.useRef)(new Set),X=(0,s.useRef)(new Set);(0,s.useCallback)(e=>E.has(e)&&""!==E.get(e),[E]);(0,s.useEffect)(()=>{Math.abs(t.length-Q.current)>2&&((0,k.QU)()&&(0,k.cY)("Conversation messages updated:",{messageCount:t.length,previousCount:Q.current,isVisible:L.current,displayOrder:d?"top-down":"bottom-up"}),Q.current=t.length);const e=new IntersectionObserver(e=>{e.forEach(e=>{L.current=e.isIntersecting})},{threshold:.1});return()=>e.disconnect()},[d,t.length]),(0,s.useEffect)(()=>{const e=e=>{const{previousModel:n,newModel:t}=e.detail,s=`${n}->${t}`;X.current.has(s)||(X.current.add(s),n&&t&&z({role:"system",content:`Model changed from ${n} to ${t}`,modelChange:{from:n,to:t,changeKey:s}},p))};return window.addEventListener("modelChanged",e),()=>{X.current.clear(),U.current.clear(),window.removeEventListener("modelChanged",e)}},[p,z]);const q=h?t.length>0?`Loading messages (${t.length} loaded)...`:"Loading conversation...":"",J=h&&t.length>0,V=h&&0===t.length,G=e=>{const n=t[e],s=e===t.length-1,i=e+1,o=i<t.length?t[i]:null,r=i<t.length;return"human"===(null===n||void 0===n?void 0:n.role)&&!Y&&!B&&(s||r&&"assistant"!==(null===o||void 0===o?void 0:o.role))},Z=e=>G(e)?(0,y.jsx)(c.A,{title:"The AI response may have failed. Click to retry.",children:(0,y.jsx)(m.Ay,{icon:(0,y.jsx)(j.A,{}),type:"primary",size:"small",onClick:async()=>{const n=t[e];u(p);try{const e=t.filter(e=>!e.muted);await(0,r.f)(e,n.content,(0,g.F)(D||[]),p,E,A,b,N,z,x.has(p),e=>$(p,e))}catch(s){b(!1),N(p),console.error("Error retrying message:",s)}},children:"Retry AI Response"})}):null,ee=e=>{if(l===e)return null;const n=t[e];return G(e)?null:n&&"system"!==n.role?(0,y.jsx)(c.A,{title:n.muted?"Unmute (include in context)":"Mute (exclude from context)",children:(0,y.jsx)(m.Ay,{icon:n.muted?(0,y.jsx)(C.A,{}):(0,y.jsx)(w.A,{}),type:"default",size:"small",style:{padding:"0 8px",minWidth:"32px",height:"32px"},onClick:()=>{T(p,e)}})}):null},ne=e=>{if(l===e)return null;const n=t[e];return G(e)?null:n&&"human"===n.role?Y?null:(0,y.jsx)(c.A,{title:"Resubmit this question",children:(0,y.jsx)(m.Ay,{icon:(0,y.jsx)(j.A,{}),type:"default",size:"small",style:{padding:"0 8px",minWidth:"32px",height:"32px"},onClick:()=>{A(new Map);const s=t.slice(0,e+1),i=s.filter(e=>!e.muted);_(e=>e.map(e=>e.id===p?{...e,messages:s,_version:Date.now()}:e)),u(p),(async()=>{try{await(0,r.f)(i,n.content,(0,g.F)(D||[]),p,E,A,b,N,z,x.has(p),e=>$(p,e))}catch(e){b(!1),N(p),console.error("Error resubmitting message:",e)}})(),F("")}})}):null};return(0,y.jsxs)("div",{style:{position:"relative"},children:[V&&(0,y.jsx)("div",{style:{position:"fixed",top:"var(--header-height)",left:"var(--folder-panel-width)",right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,y.jsx)(f.A,{size:"large",tip:q})}),(0,y.jsxs)("div",{style:{opacity:h?.5:1,minHeight:"50px"},className:"conversation-messages-container",children:[J&&(0,y.jsxs)("div",{style:{position:"sticky",top:0,backgroundColor:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"8px 16px",borderRadius:"4px",margin:"8px 0",display:"flex",alignItems:"center",gap:"8px",zIndex:1e3},children:[(0,y.jsx)(f.A,{size:"small"}),(0,y.jsx)("span",{children:q})]}),(null===O||void 0===O?void 0:O.map((e,s)=>{const i=d?s:t.length-1-s,o=i+1,r=o<t.length,a=r?t[o]:null,c="human"===e.role&&!Y&&!B&&(i===t.length-1||r&&"assistant"!==(null===a||void 0===a?void 0:a.role));"system"===e.role&&e.modelChange?(e.modelChange.from,e.modelChange.to):e.content;return(0,y.jsx)("div",{className:`message ${e.role||""}${e.muted?" muted":""}${c?" needs-response":""}`,children:"system"===e.role&&e.modelChange?(0,y.jsx)(M,{previousModel:e.modelChange.from,changeKey:e.modelChange.changeKey,newModel:e.modelChange.to}):e.content?(0,y.jsxs)(y.Fragment,{children:["human"===e.role&&(0,y.jsxs)("div",{style:{display:l===i?"none":"flex",justifyContent:"space-between"},children:[(0,y.jsx)("div",{className:"message-sender",children:"You:"}),(0,y.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginRight:"8px"},children:[ee(i),ne(i),c&&Z(i),(0,y.jsx)(v,{index:i,isInline:!0})]})]}),"human"===e.role&&l===i?(0,y.jsx)(v,{index:i,isInline:!1}):"human"===e.role&&e.content?(0,y.jsx)("div",{className:"message-content",children:(0,y.jsx)(I.MarkdownRenderer,{markdown:e.content,enableCodeApply:n,isStreaming:R||x.has(p)})}):"assistant"===e.role&&e.content?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,y.jsx)("div",{className:"message-sender",children:"AI:"}),(0,y.jsx)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginRight:"8px"},children:ee(i)}),Z(i)]}),(0,y.jsx)("div",{className:"message-content",children:(0,y.jsx)(I.MarkdownRenderer,{markdown:e.content,enableCodeApply:n,isStreaming:R||x.has(p)})})]}):null]}):null},`message-${e.id||s}`)}))||(H?(0,y.jsx)("div",{style:{height:"400px",width:"100%"},children:(0,y.jsx)(i.Y1,{height:400,itemCount:t.length,itemSize:100,width:"100%",children:P})}):null),(!O||0===O.length)&&!H&&(0,y.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#999"},children:"No messages in this conversation yet."})]})]})},(e,n)=>e.enableCodeApply===n.enableCodeApply);R.displayName="Conversation";const z=R}}]);
//# sourceMappingURL=6265.de052815.chunk.js.map