let t,g,h,_,b;const r=document.getElementById("letter"),m=document.getElementById("capital"),u=document.getElementById("number"),v=document.getElementById("symbol"),p=document.getElementById("length"),e=document.getElementById("password"),i=document.getElementById("password-repeat"),w=document.getElementById("loader"),L=document.getElementById("submit-btn"),f=document.getElementById("submit-btn-inactive"),S=document.querySelectorAll(".show-password");window.onload=async function(){const s=(await(await fetch("/api/v1/system/version")).json()).result,n=document.getElementById("versionHolder_2");n.textContent=s,navigator.userAgent.indexOf("Chrome")!=-1||navigator.userAgent.indexOf("Edg")!=-1||navigator.userAgent.indexOf("Edge")!=-1||navigator.userAgent.indexOf("Firefox")!=-1||(document.getElementById("browserWarning").style.display="block");const c=await fetch("/api/v1/settings");var d=(await c.json()).result;if(t={},c.status===200||c.status===403&&d.length>0){let o=0;for(let l of d)l.setting==="service.password_policy.minimum_lowercase_letters"?(isNaN(l.effective_value)||(t.minimumLowercaseLetters=l.effective_value),o++):l.setting==="service.password_policy.minimum_uppercase_letters"?(isNaN(l.effective_value)||(t.minimumUppercaseLetters=l.effective_value),o++):l.setting==="service.password_policy.minimum_digits"?(isNaN(l.effective_value)||(t.minimumDigits=l.effective_value),o++):l.setting==="service.password_policy.minimum_symbols"?(isNaN(l.effective_value)||(t.minimumSymbols=l.effective_value),o++):l.setting==="service.password_policy.minimum_length"&&(isNaN(l.effective_value)||(t.minimumLength=l.effective_value),o++);o!==5&&console.error("Expected 5 password_policy settings; received "+o)}t.minimumDigits===0&&u.classList.add("hide"),t.minimumLowercaseLetters===0&&r.classList.add("hide"),t.minimumLength===0&&p.classList.add("hide"),t.minimumUppercaseLetters===0&&m.classList.add("hide"),t.minimumSymbols===0&&v.classList.add("hide"),r.querySelector("b").innerText=parseInt(t.minimumLowercaseLetters),m.querySelector("b").innerText=parseInt(t.minimumUppercaseLetters),u.querySelector("b").innerText=parseInt(t.minimumDigits),v.querySelector("b").innerText=parseInt(t.minimumSymbols),p.querySelector("b").innerText=parseInt(t.minimumLength),r.querySelector("span").innerText=t.minimumLowercaseLetters>1?"s":"",m.querySelector("span").innerText=t.minimumUppercaseLetters>1?"s":"",u.querySelector("span").innerText=t.minimumDigits>1?"s":"",v.querySelector("span").innerText=t.minimumSymbols>1?"s":"",p.querySelector("span").innerText=t.minimumLength>1?"s":"",g=new RegExp("(?=(.*[a-z]){"+parseInt(t.minimumLowercaseLetters)+",})"),h=new RegExp("(?=(.*[A-Z]){"+parseInt(t.minimumUppercaseLetters)+",})"),_=new RegExp("(?=(.*[0-9]){"+parseInt(t.minimumDigits)+",})"),b=new RegExp("(?=(.*[^a-zA-Z0-9]){"+parseInt(t.minimumSymbols)+",})");function y(){e.value.match(g)?(r.classList.remove("invalid"),r.classList.add("valid")):(r.classList.remove("valid"),r.classList.add("invalid")),e.value.match(h)?(m.classList.remove("invalid"),m.classList.add("valid")):(m.classList.remove("valid"),m.classList.add("invalid")),e.value.match(_)?(u.classList.remove("invalid"),u.classList.add("valid")):(u.classList.remove("valid"),u.classList.add("invalid")),e.value.match(b)?(v.classList.remove("invalid"),v.classList.add("valid")):(v.classList.remove("valid"),v.classList.add("invalid")),e.value.length>=t.minimumLength?(p.classList.remove("invalid"),p.classList.add("valid")):(p.classList.remove("valid"),p.classList.add("invalid"));const o=document.getElementById("match_warning");e.value!==i.value&&i.value.length===0?(i.classList.remove("wrong_input"),i.classList.add("lacks_input"),o.classList.add("hide")):e.value!==i.value&&i.value.length>0?(i.classList.remove("lacks_input"),i.classList.add("wrong_input"),o.classList.remove("hide")):(i.classList.remove("lacks_input"),i.classList.remove("wrong_input"),o.classList.add("hide")),e.value.match(g)&&e.value.match(_)&&e.value.match(b)&&e.value.match(h)&&e.value.length>=t.minimumLength&&e.value==i.value?(L.classList.remove("hide"),f.classList.add("hide")):(L.classList.add("hide"),f.classList.remove("hide"))}e.addEventListener("keyup",y),i.addEventListener("keyup",y)};function I(a){if(a.key==="Enter")if(a.preventDefault(),e.value.match(g)&&e.value.match(_)&&e.value.match(b)&&e.value.match(h)&&e.value.length>=t.minimumLength&&e.value==i.value)x();else return}async function x(){if(e.value!==i.value){E("Passwords do not match");return}L.style.display="none",f.classList.add("hide"),w.classList.remove("hide"),e.tabIndex="-1",i.tabIndex="-1",e.disabled=!0,i.disabled=!0;const a=await fetch("/api/v1/auth/bootstrap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({superadminPassword:e.value})});if(a.ok)C(),setTimeout(function(){f.classList.add("hide"),w.classList.add("hide"),L.style.display="block",e.tabIndex="1",i.tabIndex="1",e.disabled=!1,i.disabled=!1,document.location.href="/#/connectivity"},3e3);else{const s=await a.json();E(s.message),f.classList.add("hide"),w.classList.add("hide"),L.style.display="block",e.tabIndex="1",i.tabIndex="1",e.disabled=!1,i.disabled=!1}}function k(a){const s=a.target.parentElement.querySelector(".icon");s.classList.contains("icon-eye")?(s.classList.remove("icon-eye"),s.classList.add("icon-eye-closed")):s.classList.contains("icon-eye-closed")&&(s.classList.remove("icon-eye-closed"),s.classList.add("icon-eye"));const n=s.parentElement.parentElement.querySelector("input");n.type!="password"?n.type="password":n.type="text"}function C(){const a=document.getElementById("error");a.innerHTML="";const s=document.createElement("div");s.classList.add("alert"),s.classList.add("alert--info");const n=document.createElement("div");n.classList.add("alert__icon"),n.classList.add("icon-info-outline"),s.appendChild(n);const c=document.createElement("div");c.classList.add("alert__message");const d=document.createElement("a"),y=document.createTextNode("If your browser does not automatically redirect you, please click here.");d.appendChild(y),c.appendChild(d),d.title="redirection",d.href="/#/connectivity",s.appendChild(c),a.appendChild(s)}function E(a){const s=document.getElementById("error");s.innerHTML="";const n=document.createElement("div");n.classList.add("alert"),n.classList.add("alert--warning");const c=document.createElement("div");c.classList.add("alert__icon"),c.classList.add("icon-warning-outline"),n.appendChild(c);const d=document.createElement("div");d.classList.add("alert__message"),d.textContent=a,n.appendChild(d),s.appendChild(n)}e.onkeyup=I;i.onkeyup=I;L.onclick=x;for(let a of S)a.addEventListener("click",s=>{k(s)});
