Metadata-Version: 2.4
Name: qthreadwithreturn
Version: 1.6.19
Summary: PySide6 é«˜çº§çº¿ç¨‹å·¥å…·åº“ - å¸¦è¿”å›å€¼çš„çº¿ç¨‹ç±»å’Œçº¿ç¨‹æ± æ‰§è¡Œå™¨
Author-email: PythonImporter <271374667@qq.com>
Maintainer-email: PythonImporter <271374667@qq.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/271374667/QThreadWithReturn
Project-URL: Repository, https://github.com/271374667/QThreadWithReturn.git
Project-URL: Issues, https://github.com/271374667/QThreadWithReturn/issues
Keywords: qt,pyside6,threading,concurrent,futures,gui,pyqt,async,thread-pool,worker-thread
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pyside6>=6.4.0
Dynamic: license-file

<div align="center">

# QThreadWithReturn

![QThreadWithReturn](https://socialify.git.ci/271374667/QThreadWithReturn/image?description=1&language=1&name=1&pattern=Plus&theme=Auto)

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://python.org)
[![PySide6](https://img.shields.io/badge/PySide6-6.4+-green.svg)](https://www.qt.io/qt-for-python)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Tests](https://img.shields.io/badge/Tests-252%20passed-brightgreen.svg)](tests/)

åŸºäº PySide6 çš„å¤šçº¿ç¨‹é«˜åº¦å°è£…åº“ï¼Œç®€åŒ– GUI åº”ç”¨ä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚

ç®€å•æ˜“ç”¨ï¼Œæ”¯æŒè¿”å›å€¼å’Œå›è°ƒæœºåˆ¶ï¼Œé¿å…å¤æ‚çš„ä¿¡å·æ§½è®¾ç½®ã€å®Œå–„çš„å†…å­˜å›æ”¶ã€è¶…æ—¶æ§åˆ¶å’Œä»»åŠ¡å–æ¶ˆåŠŸèƒ½ã€çº¿ç¨‹æ± æ”¯æŒã€ä»¥åŠå®Œæ•´çš„ç±»å‹æç¤ºã€‚

</div>

## ç®€ä»‹

`QThreadWithReturn` çµæ„Ÿæ¥è‡ªæ—¥å¸¸çš„å·¥ä½œä»¥åŠè¯¥åº“çš„å‰è¾ˆ `qasync` åº“ï¼Œç”±äº qasync ä¼šæœ‰å¼‚æ­¥ä¼ æŸ“çš„é—®é¢˜ï¼Œå¦‚æœéœ€è¦åœ¨ä»¥å¾€çš„é¡¹ç›®é‡Œé¢å¼•å…¥ qasync ä¼šå¯¼è‡´éœ€è¦å¯¹ç°æœ‰ä»£ç è¿›è¡Œå¤§è§„æ¨¡çš„ä¿®æ”¹ã€‚QThreadWithReturn ä¸ºäº†èƒ½å¤Ÿåœ¨æ—§é¡¹ç›®é‡Œé¢æ¸è¿›å¼åœ°å¼•å…¥å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæä¾›äº†ä¸€ä¸ªç±»ä¼¼äº `concurrent.futures.Future` çš„ APIï¼Œèƒ½å¤Ÿè®©æ‚¨åœ¨ä¸æ”¹å˜ç°æœ‰ä»£ç ç»“æ„çš„æƒ…å†µä¸‹ï¼Œè½»æ¾åœ°æ”¹å–„å¤šçº¿ç¨‹ã€‚

## å¿«é€Ÿå¼€å§‹

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„é“¶è¡Œå–æ¬¾çš„ä¾‹å­

```python
"""
QThreadWithReturnçš„åŸºç¡€ä¾‹å­
"""

import time

from PySide6.QtCore import Qt
from PySide6.QtWidgets import QApplication, QWidget, QPushButton, QLabel

from qthreadwithreturn import QThreadWithReturn


class Bank:
    """æ¨¡æ‹Ÿé“¶è¡Œå–æ¬¾æ“ä½œ

    è¿™é‡Œæ˜¯è€—æ—¶æ“ä½œçš„ä¾‹å­ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­é€»è¾‘åº”è¯¥æ”¾åœ¨å…¶ä»–çš„æ¨¡å—ä¸­ï¼Œä¸åº”è¯¥å’Œç•Œé¢ä»£ç æ··åœ¨ä¸€èµ·
    è¿™æ ·åšåªæ˜¯ä¸ºäº†æ¼”ç¤º QThreadWithReturn çš„ä½¿ç”¨
    """

    def draw(self, amount: float) -> str:
        """æ¨¡æ‹Ÿå–æ¬¾æ“ä½œ"""
        time.sleep(2)  # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        return f"æˆåŠŸå–æ¬¾ {amount} å…ƒ"


class MyWindow(QWidget):
    def __init__(self):
        super().__init__()

        self.setWindowTitle("QThreadWithReturn ç¤ºä¾‹")
        self.setGeometry(100, 100, 300, 200)

        self.bank = Bank()

        self.button = QPushButton("å–æ¬¾ 100 å…ƒ", self)
        self.button.setGeometry(50, 50, 200, 40)

        self.label = QLabel("ç­‰å¾…å–æ¬¾...", self)
        self.label.setAlignment(Qt.AlignmentFlag.AlignHCenter)
        self.label.setGeometry(50, 100, 200, 40)

        self.button.clicked.connect(self.start_draw)

    def start_draw(self):
        """å¼€å§‹å–æ¬¾æ“ä½œ"""
        self.button.setEnabled(False)
        self.label.setText("å–æ¬¾ä¸­...")

        # ä½¿ç”¨ QThreadWithReturn è¿›è¡Œå–æ¬¾æ“ä½œ
        # é€šè¿‡finishedå’Œfailureä¸¤ä¸ªé—­åŒ…å‡½æ•°èŠ‚çº¦äº†ä¸¤ä¸ªä¿¡å·ï¼Œè¿è¡Œå®Œæ¯•ä¹‹åè¿”å›å€¼ä¼šè‡ªåŠ¨ä¼ å…¥finishedå‡½æ•°
        # å¦‚æœå‘ç”Ÿå¼‚å¸¸åˆ™ä¼šä¼ å…¥failureå‡½æ•°
        def finished(result: str):
            # æˆåŠŸåè‡ªåŠ¨è°ƒç”¨(ä¼ å…¥å‚æ•°ä¸ºself.bank.drawçš„è¿”å›å€¼)
            self.label.setText(result)
            self.button.setEnabled(True)

        def failure(result: Exception):
            # å¤±è´¥åè‡ªåŠ¨è°ƒç”¨(ä¼ å…¥å‚æ•°ä¸ºself.bank.drawæŠ›å‡ºçš„å¼‚å¸¸)
            self.label.setText(f"å–æ¬¾å¤±è´¥: {result}")
            self.button.setEnabled(True)

        thread = QThreadWithReturn(self.bank.draw, 100)  # è°ƒç”¨å–æ¬¾æ–¹æ³•,ä¼ å…¥å‚æ•°100
        thread.add_done_callback(finished)
        thread.add_failure_callback(failure)
        thread.start()


if __name__ == '__main__':
    app = QApplication([])
    window = MyWindow()
    window.show()
    app.exec()

```

## ğŸš€ å®‰è£…

```bash
# ä½¿ç”¨ uv
uv add qthreadwithreturn

uv sync # å®‰è£…ä¾èµ–

# ä½¿ç”¨ pip  
pip install qthreadwithreturn
pip install PySide6 # å¦‚æœè¿˜æ²¡æœ‰å®‰è£… PySide6 çš„è¯(å¯é€‰)
```

## âœ¨ ç‰¹æ€§

### ğŸ¯ QThreadWithReturn

- `concurrent.futures.Future` çš„ APIï¼Œæ— éœ€äºŒæ¬¡å­¦ä¹ ï¼Œå¿«é€Ÿä¸Šæ‰‹
- å†…ç½®è¶…æ—¶æ§åˆ¶å’Œä»»åŠ¡å–æ¶ˆ(åŒ…æ‹¬å¼ºåˆ¶åœæ­¢)
- è‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- æ”¯æŒä»»æ„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€æ–¹æ³•ã€lambda ç­‰ï¼‰
- å®Œæ•´çš„ç±»å‹æç¤º
- ä¸ Qt äº‹ä»¶å¾ªç¯æ— ç¼é›†æˆ

### ğŸŠâ€â™‚ï¸ QThreadPoolExecutor

- `concurrent.futures.ThreadPoolExecutor` çš„ APIï¼Œæ— éœ€äºŒæ¬¡å­¦ä¹ ï¼Œå¿«é€Ÿä¸Šæ‰‹
- çº¿ç¨‹æ± ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦
- æ”¯æŒçº¿ç¨‹åˆå§‹åŒ–å™¨å’Œå‘½å
- æ”¯æŒ `as_completed` æ–¹æ³•æŒ‰å®Œæˆé¡ºåºå¤„ç†ä»»åŠ¡
- ä»»åŠ¡å–æ¶ˆå’Œå¼ºåˆ¶åœæ­¢æ”¯æŒ
- å®Œæ•´çš„ç±»å‹æç¤º
- ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ”¯æŒ


## ğŸ“– API å‚è€ƒ

è¿™é‡Œåªç»™å‡ºå…¬å¼€æ–¹æ³•çš„ç®€è¦è¯´æ˜ï¼Œå®Œæ•´çš„æ–‡æ¡£è¯·å‚è€ƒå…·ä½“çš„å‡½æ•°æ–‡æ¡£,åœ¨å®‰è£…äº† `qthreadwithreturn` ä¹‹ååœ¨ IDE ä¸­æ‚¬æµ®å°±å¯ä»¥æŸ¥çœ‹å¸®åŠ©

### QThreadWithReturn

å¸¦è¿”å›å€¼çš„ Qt çº¿ç¨‹ç±»ï¼Œæä¾›ç±»ä¼¼ `concurrent.futures.Future` çš„ APIã€‚

| æ–¹æ³•                                                   | æè¿°                         |
| ------------------------------------------------------ | ---------------------------- |
| `start(timeout_ms: int = -1)`                          | å¯åŠ¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡             |
| `result(timeout_ms: int = -1)`                         | è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œé˜»å¡ç­‰å¾…   |
| `exception(timeout_ms: int = -1)`                      | è·å–ä»»åŠ¡æ‰§è¡Œæ—¶æŠ›å‡ºçš„å¼‚å¸¸     |
| `cancel(force_stop: bool = False)`                     | å–æ¶ˆçº¿ç¨‹æ‰§è¡Œ                 |
| `running()`                                            | æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ         |
| `done()`                                               | æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²å®Œæˆ           |
| `cancelled()`                                          | æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ           |
| `wait(timeout_ms: int = -1, force_stop: bool = False)` | ç­‰å¾…ä»»åŠ¡å®Œæˆ                 |
| `add_done_callback(callback: Callable)`                | æ·»åŠ ä»»åŠ¡æˆåŠŸå®Œæˆåçš„å›è°ƒå‡½æ•° |
| `add_failure_callback(callback: Callable)`             | æ·»åŠ ä»»åŠ¡å¤±è´¥åçš„å›è°ƒå‡½æ•°     |

### QThreadPoolExecutor

çº¿ç¨‹æ± æ‰§è¡Œå™¨ï¼ŒAPI å…¼å®¹ `concurrent.futures.ThreadPoolExecutor`ã€‚

ä¸å»ºè®®ä½¿ç”¨ `with` è¯­å¥ï¼Œå› ä¸ºåœ¨ GUI åº”ç”¨ä¸­ä¼šå¯¼è‡´ UI é˜»å¡ã€‚

#### é™æ€æ–¹æ³•

| æ–¹æ³•                                                                   | è¿”å›ç±»å‹                        | æè¿°                                       |
| ---------------------------------------------------------------------- | ------------------------------- | ------------------------------------------ |
| `as_completed(fs: Iterable["QThreadWithReturn"], timeout: float = -1)` | `Iterator["QThreadWithReturn"]` | è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‰å®Œæˆé¡ºåºç”Ÿæˆ Future å¯¹è±¡ |

#### å®ä¾‹æ–¹æ³•

| æ–¹æ³•                                                                                      | æè¿°                                       |
| ----------------------------------------------------------------------------------------- | ------------------------------------------ |
| `submit(fn: Callable, /, *args, **kwargs)`                                                | æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± æ‰§è¡Œ                       |
| `shutdown(wait: bool = False, *, cancel_futures: bool = False, force_stop: bool = False)` | å…³é—­çº¿ç¨‹æ±                                  |
| `add_done_callback(callback: Callable)`                                                   | æ·»åŠ æ± çº§åˆ«å®Œæˆå›è°ƒï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶æ‰§è¡Œ   |
| `add_failure_callback(callback: Callable)`                                                | æ·»åŠ ä»»åŠ¡çº§åˆ«å¤±è´¥å›è°ƒï¼Œå½“ä»»ä½•ä»»åŠ¡å¤±è´¥æ—¶æ‰§è¡Œ |

- **add_done_callback**ï¼šå½“æ‰€æœ‰æ´»è·ƒä»»åŠ¡å®Œæˆä¸”æ²¡æœ‰å¾…å¤„ç†ä»»åŠ¡æ—¶è§¦å‘
- **add_failure_callback**ï¼šæ¯ä¸ªå¤±è´¥ä»»åŠ¡éƒ½ä¼šè§¦å‘ä¸€æ¬¡

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

- **é—®é¢˜æŠ¥å‘Š**: [GitHub Issues](https://github.com/271374667/QThreadWithReturn/issues)
- **è®¨è®º**: [GitHub Discussions](https://github.com/271374667/QThreadWithReturn/discussions)
- **é‚®ä»¶**: 271374667@qq.com
