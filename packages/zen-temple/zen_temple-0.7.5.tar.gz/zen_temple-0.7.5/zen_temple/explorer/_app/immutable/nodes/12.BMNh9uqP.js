import"../chunks/DsnmJJEf.js";import{s as Te,o as dt}from"../chunks/C6tn_jEF.js";import{p as $e,c as se,f as O,a as _,j as qe,h as k,m as M,r as j,i as h,g as e,l as n,q as Ge,s as w,b as R,u as je,e as ct,t as ft,d as s,n as Ye,k as vt}from"../chunks/BPIoXquA.js";import{i as J}from"../chunks/lzapwbvy.js";import{u as gt,g as _t,a as Ue,b as xe,e as pt,i as mt}from"../chunks/BUFwSDdR.js";import{s as We}from"../chunks/BeKPjfAQ.js";import{M as ht,r as bt,g as wt,n as yt,c as xt,p as Ct,o as St,a as Tt}from"../chunks/rdcgL5Y9.js";import{A as de}from"../chunks/CAngS_wK.js";import{C as ke}from"../chunks/D7Ip14_O.js";import{F as kt,b as ce,c as ze,f as Pt,t as Dt,r as Et,j as Ce,n as Lt,h as Ve}from"../chunks/BG-hj6TZ.js";import{D as Bt}from"../chunks/BEdcgSQn.js";import{T as Se}from"../chunks/CLrfXApy.js";import{u as fe}from"../chunks/F3PdWuc7.js";import{E as _e}from"../chunks/Dmw0JB4Z.js";var It=k('<div class="text-center text-muted mb-2">Click on a bar to see a production and consumption breakdown.</div>'),Nt=k('<div class="row mb-2"><div class="col-lg-6"><h3 class="text-center h5"> </h3> <!></div> <div class="col-lg-6"><h3 class="text-center h5"> </h3> <!></div></div>');function Ot(pe,m){$e(m,!0);let te=n(()=>{if(m.year==null)return[];const a=m.labels.findIndex(i=>i===m.year);return m.datasets.filter(i=>i.stack===m.solution).map(i=>({data:i.data.find((P,D)=>D===a),color:i.backgroundColor,label:i.label}))});function K(){return{animation:{duration:0},responsive:!0,plugins:{tooltip:{callbacks:{label:a=>{const i=Number(a.raw||0),P=a.dataset.data.map(z=>Number(z||0)).reduce((z,E)=>z+E,0),D=(i*100/P).toFixed(2);return`${a.dataset.label}: ${a.formattedValue}${m.tooltipSuffix} (${D}%)`}}},legend:{position:"top"}},radius:"90%"}}function re(a,i){if(m.year==null)return[];const P=e(te).filter(E=>E.data&&a(Number(E.data))),D=P.map(E=>E.data),z=P.map(E=>E.color);return[{label:i,data:D,backgroundColor:z}]}function q(a){return m.year==null?[]:e(te).filter(i=>i.data&&a(Number(i.data))).map(i=>i.label||"")}let f=n(()=>re(a=>a>1e-6,"Production")),l=n(()=>q(a=>a>1e-6)),Q=n(K),X=n(()=>re(a=>a<-1e-6,"Consumption")),Y=n(()=>q(a=>a<-1e-6)),me=n(K);var U=se(),W=O(U);{var Z=a=>{var i=It();_(a,i)},G=a=>{var i=Nt(),P=M(i),D=M(P),z=M(D);j(D);var E=h(D,2);ke(E,{type:"pie",get datasets(){return e(f)},get labels(){return e(l)},get options(){return e(Q)},downloadable:!1}),j(P);var ie=h(P,2),ne=M(ie),ve=M(ne);j(ne);var L=h(ne,2);ke(L,{type:"pie",get datasets(){return e(X)},get labels(){return e(Y)},get options(){return e(me)},downloadable:!1}),j(ie),j(i),Ge(()=>{Te(z,`Breakdown of Production for ${m.year??""} (${m.solution??""})`),Te(ve,`Breakdown of Consumption for ${m.year??""} (${m.solution??""})`)}),_(a,i)};J(W,a=>{m.year==null||m.solution==null?a(Z):a(G,!1)})}_(pe,U),qe()}var At=k('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),Ft=k('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),Rt=k("<!> <!> <!>",1),Mt=k("<!> <!> <!>",1),jt=k("<!> <!> <!> <!>",1),Yt=k("<!> <!>",1),Ut=k('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Wt=k("<div></div>"),zt=k('<div class="text-center">No carriers with this selection.</div>'),Vt=k('<div class="text-center">No data with this selection.</div>'),$t=k("<!> <div><!></div>",1),qt=k('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <h2 class="visually-hidden">Plots</h2> <div class="plot"><!></div>',1);function ir(pe,m){$e(m,!0);let te=w(R([])),K=w(R([])),re=w(R([])),q=R([{id:"conversion",short_id:"conv",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",short_id:"stor",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"transport",short_id:"tran",title:"Transport",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_transport",positive_label:"Transport in",positive_suffix:" (transport in)",negative:"flow_transport_loss",negative_label:"Transport out",negative_suffix:" (transport out)"},{id:"import_export",short_id:"imp_exp",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",short_id:"dem_shed",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),f=w(R([null])),l=w(null),Q=w(R([])),X=w(R([])),Y=w(R([])),me=n(()=>[...e(Q),...e(X),...e(Y)]),U=w(!1),W=w(R([])),Z=w(R([])),G=w(null),a=w(null),i=null,P=null,D=null,z="",E="",ie="",ne="",ve="",L=w(!1),F=w(!1),He=n(()=>{if(!e(f)[0]?.solution_name||!e(l))return"";let t=e(f)[0].solution_name.split(".");return[t[t?.length-1],e(f)[0].scenario_name,e(l)].join("_")}),le=n(()=>e(f).some(t=>t===null)),Pe=w(R([])),De=n(()=>{let t=null;return!t&&e(l)&&(t=e(Pe).find(r=>r.carrier==e(l))),t&&(t[0]||t.units)||""}),Ee=n(()=>e(Z).map(t=>t.toString())),Le=n(()=>e(U)?"":` ${e(De)}`),Je=n(()=>({datasets:{bar:{borderColor:"rgb(255, 0, 0)",borderWidth:t=>!e(G)||!e(a)||t.chart.data.labels?.[t.dataIndex]!==e(G)||t.chart.data.datasets?.[t.datasetIndex].stack!==e(a)?0:5,borderRadius:2,borderSkipped:"middle"}},animation:{duration:0},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(U)?"":` [${e(De)}]`)},max:e(U)?1:void 0,suggestedMin:e(U)?-1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const Ke={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}${e(Le)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`},labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y||0)>1e-6,borderWidth:0}};function Qe(t){return Tt(t).map(r=>({...r,lineWidth:0}))}let oe=n(()=>{if(e(le))return[];const t=new Set;return e(f).forEach(o=>{o.detail.system.set_carriers.forEach(u=>t.add(u))}),Array.from(t).sort()}),he=n(()=>{if(e(le)||e(l)===null)return[];const t=new Set;return e(f).forEach(o=>{Object.entries(o.detail.carriers_input).concat(Object.entries(o.detail.carriers_output)).filter(u=>e(l)&&u[1].includes(e(l))).forEach(u=>t.add(u[0]))}),Array.from(t).sort()}),be=n(()=>{if(e(le)||e(l)===null)return[];const t=new Set;return e(f).forEach(o=>{o.detail.system.set_storage_technologies.forEach(u=>{o.detail.reference_carrier[u]===e(l)&&t.add(u)})}),Array.from(t).sort()}),we=n(()=>{if(e(le)||e(l)===null)return[];const t=new Set;return e(f).forEach(o=>{o.detail.system.set_transport_technologies.forEach(u=>{o.detail.reference_carrier[u]===e(l)&&t.add(u)})}),Array.from(t).sort()});je(()=>{e(oe),ct(()=>{e(f)&&e(oe).length>0&&(!e(l)||e(l)&&!e(oe).includes(e(l)))&&s(l,e(oe)[0],!0)})}),fe(()=>e(he),()=>!!e(f),()=>z,()=>i,t=>s(Q,t,!0),t=>z=t,t=>i=t),fe(()=>e(be),()=>!!e(f),()=>E,()=>P,t=>s(X,t,!0),t=>E=t,t=>P=t),fe(()=>e(we),()=>!!e(f),()=>ie,()=>D,t=>s(Y,t,!0),t=>ie=t,t=>D=t),fe(()=>e(re),()=>!!e(f),()=>ne,()=>null,t=>s(W,t,!0),t=>ne=t,()=>{}),fe(()=>e(K),()=>!!e(f),()=>ve,()=>null,t=>s(Z,t,!0),t=>ve=t,()=>{}),dt(()=>{s(l,_t("car")||null,!0),q.forEach(t=>{t.show=Ue(t.short_id,t.show),t.subdivision=Ue(t.short_id+"_sub",t.subdivision)}),i=xe("conv_tech"),P=xe("stor_tech"),D=xe("tran_tech")}),je(()=>{e(l),q.forEach(t=>{t.show,t.subdivision}),e(Q),e(X),ft().then(()=>{let t={car:e(l),conv_tech:e(Q).map(r=>e(he).indexOf(r)).join("~"),stor_tech:e(X).map(r=>e(be).indexOf(r)).join("~"),tran_tech:e(Y).map(r=>e(we).indexOf(r)).join("~")};q.forEach(r=>{t[r.short_id]=r.show?"1":"0",t[r.short_id+"_sub"]=r.subdivision?"1":"0"}),gt(t)})});async function Xe(){s(G,null),s(a,null),await et()}function Ze(t,r){if(!t)return;const o=e(ge)[r].stack;if(!o||e(G)===t&&e(a)===o){s(G,null),s(a,null);return}s(G,t,!0),s(a,o||null,!0)}async function et(){if(e(le))return;s(F,!0),s(te,[],!0);const t=e(f),r=await Promise.all(t.map(o=>Pt(o.solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","flow_transport","flow_transport_loss","shed_demand","demand"],o.scenario_name,"demand")));s(te,r.map(o=>q.flatMap(u=>[o[u.positive]?.data||[],o[u.negative]?.data||[]])),!0),r.length>0&&r[0].unit?.data&&s(Pe,r[0].unit.data,!0),s(F,!1)}function Be(t,r,o,u,V){if(!e(l))return _e.empty();const B={carrier:[e(l)],node:e(W)};r.filter_by_technologies&&(B.technology=e(me));const b=r.subdivision?["technology"]:[];let A=t.filterByCriteria(B).filterDataByIndex(e(Z).map(y=>e(K).indexOf(y))).groupBy(b).mapIndex(y=>({...y,label:r.subdivision?y.technology+(u||""):o}));return V!==void 0&&(A=A.mapData(V)),A}let tt=n(()=>{if(e(W).length==0||e(Z).length==0||e(te).length==0)return[[],[]];Et(),bt();const t=[];return[e(f).flatMap((o,u)=>{const V=e(te)[u];if(!o||!V.length)return[];let B=q.flatMap((d,x)=>{if(!d.show)return[];let S=_e.fromRows(V[2*x]),ae=_e.fromRows(V[2*x+1]);if(d.id==="transport"){const v=S,T=ae.filterByCriteria({technology:e(Y),edge:Ce(o.detail.edges,e(W),!0)});S=v.filterByCriteria({technology:e(Y),edge:Ce(o.detail.edges,e(W),!0)}).mapEntries((c,p)=>{const g=T.find($=>$.index.technology===c.technology&&$.index.edge===c.edge)?.data;return!g||g.length!==p.length?{index:c,data:p}:{data:p.map(($,H)=>$-g[H]),index:c}}),ae=v.filterByCriteria({technology:e(Y),edge:Ce(o.detail.edges,e(W),!1)})}let I=Be(S,d,d.positive_label,d.positive_suffix),ee=Be(ae,d,d.negative_label,d.negative_suffix,v=>-v);return[I,ee]}),b=_e.concatenate(B);e(U)&&(b=b.normalize());let A=wt(o.solution_name,o.scenario_name),y=u>0?yt():void 0;return t.push(xt(A,y)),b.toArray().map(d=>{const x=d.index.label,S=Lt(x);return{label:x,data:d.data,borderColor:S,backgroundColor:y!==void 0?Ct.draw(y,Ve(S)):Ve(S),stack:A}})}),t]}),Ie=n(()=>vt(e(tt),2)),ge=n(()=>e(Ie)[0]),rt=n(()=>e(Ie)[1]);var Ne=qt(),Oe=h(O(Ne),2);kt(Oe,{children:(t,r)=>{var o=Yt(),u=O(o);ce(u,{title:"Solution Selection",children:(b,A)=>{{let y=n(()=>e(F)||e(L));ht(b,{onSelected:Xe,get disabled(){return e(y)},get solutions(){return e(f)},set solutions(d){s(f,d,!0)},get years(){return e(K)},set years(d){s(K,d,!0)},get nodes(){return e(re)},set nodes(d){s(re,d,!0)},get loading(){return e(L)},set loading(d){s(L,d,!0)}})}}});var V=h(u,2);{var B=b=>{var A=jt(),y=O(A);ce(y,{title:"Carrier Selection",children:(I,ee)=>{var v=se(),C=O(v);{var T=c=>{ze(c,{label:"Carrier",content:(g,N=Ye)=>{{let $=n(()=>Dt(e(oe))),H=n(()=>e(L)||e(F));Bt(g,{get formId(){return N()},get options(){return e($)},get disabled(){return e(H)},get value(){return e(l)},set value(ye){s(l,ye,!0)}})}}})};J(C,c=>{e(oe).length>0&&c(T)})}_(I,v)}});var d=h(y,2);ce(d,{title:"Production Component Selection",children:(I,ee)=>{var v=se(),C=O(v);pt(C,17,()=>q,mt,(T,c,p)=>{var g=Ft(),N=M(g);We(N,"for","variables"+p);var $=M(N,!0);j(N);var H=h(N,2),ye=M(H);Se(ye,{formId:"variables"+p,get value(){return e(c).show},set value(ue){e(c).show=ue}}),j(H);var st=h(H,2);{var it=ue=>{var Fe=At(),Re=O(Fe);We(Re,"for","subdivision"+p);var Me=h(Re,2),lt=M(Me);Se(lt,{formId:"subdivision"+p,get value(){return e(c).subdivision},set value(ut){e(c).subdivision=ut}}),j(Me),_(ue,Fe)};J(st,ue=>{e(c).show&&e(c).show_subdivision&&ue(it)})}j(g),Ge(()=>Te($,e(c).title)),_(T,g)}),_(I,v)}});var x=h(d,2);ce(x,{title:"Technology Selection",children:(I,ee)=>{var v=Rt(),C=O(v);{let p=n(()=>e(L)||e(F));de(C,{label:"Conversion",get elements(){return e(he)},get disabled(){return e(p)},get value(){return e(Q)},set value(g){s(Q,g,!0)}})}var T=h(C,2);{let p=n(()=>e(L)||e(F));de(T,{label:"Storage",get elements(){return e(be)},get disabled(){return e(p)},get value(){return e(X)},set value(g){s(X,g,!0)}})}var c=h(T,2);{let p=n(()=>e(L)||e(F));de(c,{label:"Transport",get elements(){return e(we)},get disabled(){return e(p)},get value(){return e(Y)},set value(g){s(Y,g,!0)}})}_(I,v)}});var S=h(x,2);{var ae=I=>{ce(I,{title:"Data Selection",children:(ee,v)=>{var C=Mt(),T=O(C);ze(T,{label:"Normalization",content:(N,$=Ye)=>{Se(N,{get formId(){return $()},get value(){return e(U)},set value(H){s(U,H,!0)}})}});var c=h(T,2);{let g=n(()=>e(L)||e(F));de(c,{label:"Nodes",get elements(){return e(re)},get disabled(){return e(g)},get value(){return e(W)},set value(N){s(W,N,!0)}})}var p=h(c,2);{let g=n(()=>e(L)||e(F));de(p,{label:"Years",get elements(){return e(K)},get disabled(){return e(g)},get value(){return e(Z)},set value(N){s(Z,N,!0)}})}_(ee,C)}})};J(S,I=>{!e(F)&&e(l)!=null&&I(ae)})}_(b,A)};J(V,b=>{!e(L)&&e(f)[0]!==null&&b(B)})}_(t,o)}});var Ae=h(Oe,4),ot=M(Ae);{var at=t=>{var r=Ut();_(t,r)},nt=t=>{var r=se(),o=O(r);{var u=B=>{var b=Wt();_(B,b)},V=B=>{var b=se(),A=O(b);{var y=x=>{var S=zt();_(x,S)},d=x=>{var S=se(),ae=O(S);{var I=v=>{var C=Vt();_(v,C)},ee=v=>{var C=$t(),T=O(C);ke(T,{type:"bar",get datasets(){return e(ge)},get labels(){return e(Ee)},get options(){return e(Je)},get pluginOptions(){return Ke},get plotName(){return e(He)},get patterns(){return e(rt)},generateLabels:Qe,get onClickLegend(){return St},onClickBar:Ze});var c=h(T,2),p=M(c);Ot(p,{get datasets(){return e(ge)},get labels(){return e(Ee)},get year(){return e(G)},get solution(){return e(a)},get tooltipSuffix(){return e(Le)}}),j(c),_(v,C)};J(ae,v=>{e(ge).length==0?v(I):v(ee,!1)},!0)}_(x,S)};J(A,x=>{e(oe).length==0?x(y):x(d,!1)},!0)}_(B,b)};J(o,B=>{e(f)==null?B(u):B(V,!1)},!0)}_(t,r)};J(ot,t=>{e(L)||e(F)?t(at):t(nt,!1)})}j(Ae),_(pe,Ne),qe()}export{ir as component};
