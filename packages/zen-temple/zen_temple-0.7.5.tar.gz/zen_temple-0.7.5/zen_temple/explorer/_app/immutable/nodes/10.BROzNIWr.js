import"../chunks/DsnmJJEf.js";import{o as _t,s as bt}from"../chunks/C6tn_jEF.js";import{p as Ct,s as u,b as v,u as me,d as s,g as e,l as d,t as xt,h as w,i as h,f as E,a as _,j as St,c as pe,n as yt,m as se,r as ne,q as wt,k as Tt}from"../chunks/BPIoXquA.js";import{i as S}from"../chunks/lzapwbvy.js";import{u as Ot,a as Ve,b as le,e as Et,i as Lt}from"../chunks/BUFwSDdR.js";import{s as Ge}from"../chunks/BeKPjfAQ.js";import{M as At,r as jt,n as Pt,g as $t,c as kt,p as He,o as Dt,a as Rt}from"../chunks/rdcgL5Y9.js";import{A as q}from"../chunks/CAngS_wK.js";import{R as Bt}from"../chunks/DXf0k2HG.js";import{T as Je}from"../chunks/CLrfXApy.js";import{C as Mt}from"../chunks/D7Ip14_O.js";import{F as Ft,b as ge,c as It,t as Ut,f as Yt,r as zt,n as Ke,h as he}from"../chunks/BG-hj6TZ.js";import{g as Nt}from"../chunks/CqS7hfz2.js";import{u as V}from"../chunks/F3PdWuc7.js";import{E as X}from"../chunks/Dmw0JB4Z.js";import{d as qt}from"../chunks/CgsLtv0Y.js";var Vt=w('<label class="col-6 col-md-2">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),Gt=w('<div class="row mb-2"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-2"><!></div> <!></div>'),Ht=w("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),Jt=w("<!> <!> <!>",1),Kt=w("<!> <!> <!>",1),Qt=w("<!> <!>",1),Wt=w('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Xt=w('<div class="text-center">Please select at least one solution.</div>'),Zt=w('<div class="text-center">Please select at least one year.</div>'),er=w('<div class="text-center">No data with this selection.</div>'),tr=w('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Costs</h1> <!> <div class="mt-4"><!></div>',1);function _r(Qe,We){Ct(We,!0);const y="Technology / Carrier",Oe=" (Capex)",Ee=" (Opex)",Xe="Capex",Ze="Opex",et="Carrier",tt="Shed Demand";let I=u(v([]));const Le=["Location",y];let G=u(v([])),H=u(v([])),_e=u(v([])),ie=u(v([])),ce=u(v([])),ue=u(v({})),i=u(v([null])),U=u(v([])),Y=u(v([])),z=u(v([])),D=u(v([])),R=u(v([])),Z=u("Location"),ee=u(v([])),L=u(v([])),be=null,Ce=null,xe=null,Se=null,ye=null,Ae="",je="",Pe="",$e="",ke="",De="",Re="",te=u(!1),de=u(!1),A=d(()=>e(i).some(t=>t===null)),j=v({capex:{title:"Capex",show:!0,subdivision:!1,showSubdivision:!0,label:Xe},opex:{title:"Opex",show:!0,subdivision:!1,showSubdivision:!0,label:Ze},carrier:{title:"Carrier",show:!0,subdivision:!1,showSubdivision:!0,label:et},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,showSubdivision:!0,label:tt},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,showSubdivision:!1}}),rt=d(()=>{if(!e(i)[0])return"";let t=e(i)[0].solution_name.split(".");return[t[t.length-1],e(i)[0].scenario_name,"costs"].join("_")}),Be=d(()=>e(Q).length>0?e(ue)[e(Q)[0]]||"":e(K).length>0?e(ue)[e(K)[0]]||"":e(W).length>0&&e(ue)[e(W)[0]]||""),at=d(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Be)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),ot={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(Be)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}},st=d(()=>e(L).map(t=>t.toString())),J=d(()=>e(A)?new Set:new Set([...e(G).flatMap(t=>t.map(r=>r.technology))||[],...e(H).flatMap(t=>t.map(r=>r.technology))||[]])),K=d(()=>{if(e(A)||e(J).size==0)return[];const t=e(i),r=new Set;return t.forEach(a=>{a.detail.system.set_transport_technologies.forEach(n=>{e(J).has(n)&&r.add(n)})}),Array.from(r).sort()}),Q=d(()=>{if(e(A)||e(J).size==0)return[];const t=e(i),r=new Set;return t.forEach(a=>{a.detail.system.set_conversion_technologies.forEach(n=>{e(J).has(n)&&r.add(n)})}),Array.from(r).sort()}),W=d(()=>{if(e(A)||e(J).size==0)return[];const t=e(i),r=new Set;return t.forEach(a=>{a.detail.system.set_storage_technologies.forEach(n=>{e(J).has(n)&&r.add(n)})}),Array.from(r).sort()}),fe=d(()=>{if(e(A))return[];const t=new Set;return e(ie).forEach(r=>{r.forEach(a=>{t.add(a.carrier)})}),Array.from(t).sort()}),ve=d(()=>{if(e(A))return[];const t=new Set;return e(ce).forEach(r=>{r.forEach(a=>{t.add(a.carrier)})}),Array.from(t).sort()}),we=d(()=>{if(e(A))return[];const t=e(i),r=new Set;return t.forEach(a=>{Object.keys(a.detail.edges).forEach(n=>{r.add(n)}),a.detail.system.set_nodes.forEach(n=>{r.add(n)})}),Array.from(r).sort()});V(()=>e(K),()=>!!e(i)[0]&&!!e(G)&&!!e(H),()=>Pe,()=>xe,t=>s(z,t,!0),t=>Pe=t,t=>xe=t),V(()=>e(Q),()=>!!e(i)[0]&&e(G).length>0&&e(H).length>0,()=>Ae,()=>be,t=>s(U,t,!0),t=>Ae=t,t=>be=t),V(()=>e(W),()=>!!e(i)[0]&&e(G).length>0&&e(H).length>0,()=>je,()=>Ce,t=>s(Y,t,!0),t=>je=t,t=>Ce=t),V(()=>e(fe),()=>!!e(i)[0]&&e(ie).length>0,()=>$e,()=>Se,t=>s(D,t,!0),t=>$e=t,t=>Se=t),V(()=>e(ve),()=>!!e(i)[0]&&e(ce).length>0,()=>ke,()=>ye,t=>s(R,t,!0),t=>ke=t,t=>ye=t),V(()=>e(we),()=>!!e(i)[0],()=>De,()=>null,t=>s(ee,t,!0),t=>De=t,()=>{}),V(()=>e(I),()=>!!e(i)[0],()=>Re,()=>null,t=>s(L,t,!0),t=>Re=t,()=>{}),me(()=>{s(ee,e(we),!0)}),me(()=>{s(L,e(I),!0)}),_t(()=>{Object.entries(j).forEach(([t,r])=>{r.show=Ve(t,r.show),r.subdivision=Ve(t+"_sub",r.subdivision)}),xe=le("tran"),be=le("conv"),Ce=le("stor"),Se=le("cost"),ye=le("demand")}),me(()=>{e(z),e(U),e(Y),e(D),e(R),Object.values(j).forEach(t=>{t.show,t.subdivision}),xt().then(()=>{let t={tran:e(z).map(r=>e(K).indexOf(r)).join("~"),conv:e(U).map(r=>e(Q).indexOf(r)).join("~"),stor:e(Y).map(r=>e(W).indexOf(r)).join("~"),cost:e(D).map(r=>e(fe).indexOf(r)).join("~"),demand:e(R).map(r=>e(ve).indexOf(r)).join("~")};Object.entries(j).forEach(([r,a])=>{t[r]=a.show?"1":"0",t[r+"_sub"]=a.subdivision?"1":"0"}),Ot(t)})});function nt(){lt()}async function lt(){if(e(i).some(a=>a===null))return;s(de,!0);const t=e(i),r=await Promise.all(t.map(a=>Yt(a.solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(n=>Nt(n,a?.version)),a.scenario_name)));s(G,r.map(a=>a.cost_capex_yearly?.data||[]),!0),s(H,r.map(a=>a.cost_opex_yearly?.data||[]),!0),s(_e,r.map(a=>a.cost_carbon_emissions_total?.data||[]),!0),s(ie,r.map(a=>a.cost_carrier?.data||[]),!0),s(ce,r.map(a=>a.cost_shed_demand?.data||[]),!0),r[0].unit?.data&&s(ue,Object.fromEntries(r[0].unit.data.map(a=>[a.technology,a[0]||a.units])),!0),s(de,!1)}let Te=u(v([]));function it(){s(Te,[...e(U).concat(e(Y)).concat(e(z)).flatMap(t=>[t+Oe,t+Ee]),...e(D),...e(R)],!0)}const ct=Object.values(j).filter(t=>t.label).map(t=>t.label);let ut=qt(it,100);me(()=>{e(U),e(Y),e(z),e(D),e(R),ut()});let dt=d(()=>{if(e(Te).length==0)return[[],[]];zt(),jt();const t=[];return[e(i).flatMap((a,n)=>{if(a===null)return[];const re={capex:X.fromRows(e(G)[n]).mapIndex(o=>({location:o.location,[y]:o.technology+Oe})),opex:X.fromRows(e(H)[n]).mapIndex(o=>({location:o.location,[y]:o.technology+Ee})),carrier:X.fromRows(e(ie)[n]).filter(o=>e(D).includes(o.index.carrier)).mapIndex(o=>({location:o.node,[y]:o.carrier})),shed_demand:X.fromRows(e(ce)[n]).filter(o=>e(R).includes(o.index.carrier)).mapIndex(o=>({location:o.node,[y]:o.carrier}))};let b=X.concatenate(Object.entries(re).map(([o,f])=>{if(!j[o].show)return null;const c=f.filterByCriteria({location:e(ee),[y]:e(Te).concat(ct)}).filterDataByIndex(e(L).map(B=>e(I).indexOf(B)));return j[o].subdivision?c:c.groupBy(["location"]).mapIndex(B=>({location:B.location,[y]:j[o].label||""}))}));e(Z)==y?b=b.groupBy(["location"]):b=b.groupBy([y]);const m=n>0?Pt():void 0,P=$t(a.solution_name,a.scenario_name);t.push(kt(P,m));const $=b.toArray().map(o=>{const f=e(Z)==y?o.index.location:o.index[y],c=Ke(f);return{label:f,data:o.data,borderColor:c,backgroundColor:m!==void 0?He.draw(m,he(c)):he(c),stack:P}});if(e(_e)[n].length===1&&j.carbon_emission.show){const o=X.fromRows(e(_e)[n]).filterDataByIndex(e(L).map(c=>e(I).indexOf(c))),f=Ke("Total Carbon Costs");$.push({data:o.get(0).data,label:"Total Carbon Costs",borderColor:f,backgroundColor:m!==void 0?He.draw(m,he(f)):he(f),stack:P})}return $}),t]}),Me=d(()=>Tt(e(dt),2)),Fe=d(()=>e(Me)[0]),ft=d(()=>e(Me)[1]);var Ie=tr(),Ue=h(E(Ie),2);Ft(Ue,{children:(t,r)=>{var a=Qt(),n=E(a);ge(n,{title:"Solution Selection",children:(m,P)=>{{let $=d(()=>e(de)||e(te));At(m,{onSelected:nt,get disabled(){return e($)},get solutions(){return e(i)},set solutions(o){s(i,o,!0)},get years(){return e(I)},set years(o){s(I,o,!0)},get loading(){return e(te)},set loading(o){s(te,o,!0)}})}}});var re=h(n,2);{var b=m=>{var P=Kt(),$=E(P);ge($,{title:"Cost Selection",children:(c,B)=>{var T=pe(),k=E(T);Et(k,17,()=>Object.values(j),Lt,(x,C,M)=>{var F=Gt(),p=se(F);Ge(p,"for","variables"+M);var O=se(p,!0);ne(p);var N=h(p,2),ae=se(N);Je(ae,{formId:"variables"+M,get value(){return e(C).show},set value(g){e(C).show=g}}),ne(N);var oe=h(N,2);{var l=g=>{var ze=Vt(),Ne=E(ze);Ge(Ne,"for","subdivision"+M);var qe=h(Ne,2),gt=se(qe);Je(gt,{formId:"subdivision"+M,get value(){return e(C).subdivision},set value(ht){e(C).subdivision=ht}}),ne(qe),_(g,ze)};S(oe,g=>{e(C).show&&e(C).showSubdivision&&g(l)})}ne(F),wt(()=>bt(O,e(C).title)),_(x,F)}),_(c,T)}});var o=h($,2);ge(o,{title:"Technology Selection",children:(c,B)=>{var T=Ht(),k=h(E(T),2);{var x=l=>{q(l,{label:"Transport",get elements(){return e(K)},get value(){return e(z)},set value(g){s(z,g,!0)}})};S(k,l=>{e(K).length>0&&l(x)})}var C=h(k,2);{var M=l=>{q(l,{label:"Storage",get elements(){return e(W)},get value(){return e(Y)},set value(g){s(Y,g,!0)}})};S(C,l=>{e(W).length>0&&l(M)})}var F=h(C,2);{var p=l=>{q(l,{label:"Conversion",get elements(){return e(Q)},get value(){return e(U)},set value(g){s(U,g,!0)}})};S(F,l=>{e(Q).length>0&&l(p)})}var O=h(F,2);{var N=l=>{q(l,{label:"Cost of Carrier",get elements(){return e(fe)},get value(){return e(D)},set value(g){s(D,g,!0)}})};S(O,l=>{e(fe).length>0&&l(N)})}var ae=h(O,2);{var oe=l=>{q(l,{label:"Shed Demand",get elements(){return e(ve)},get value(){return e(R)},set value(g){s(R,g,!0)}})};S(ae,l=>{e(ve).length>0&&l(oe)})}_(c,T)}});var f=h(o,2);ge(f,{title:"Data Selection",children:(c,B)=>{var T=Jt(),k=E(T);It(k,{label:"Aggregation",content:(O,N=yt)=>{{let ae=d(()=>Ut(Le));Bt(O,{get formId(){return N()},get options(){return e(ae)},get value(){return e(Z)},set value(oe){s(Z,oe,!0)}})}}});var x=h(k,2);{var C=p=>{q(p,{label:"Locations",get elements(){return e(we)},get value(){return e(ee)},set value(O){s(ee,O,!0)}})};S(x,p=>{e(Z)==Le[1]&&p(C)})}var M=h(x,2);{var F=p=>{q(p,{label:"Years",get elements(){return e(I)},get value(){return e(L)},set value(O){s(L,O,!0)}})};S(M,p=>{e(L)&&p(F)})}_(c,T)}}),_(m,P)};S(re,m=>{!e(te)&&!e(A)&&m(b)})}_(t,a)}});var Ye=h(Ue,2),vt=se(Ye);{var mt=t=>{var r=Wt();_(t,r)},pt=t=>{var r=pe(),a=E(r);{var n=b=>{var m=Xt();_(b,m)},re=b=>{var m=pe(),P=E(m);{var $=f=>{var c=Zt();_(f,c)},o=f=>{var c=pe(),B=E(c);{var T=x=>{var C=er();_(x,C)},k=x=>{Mt(x,{type:"bar",get labels(){return e(st)},get datasets(){return e(Fe)},get options(){return e(at)},get pluginOptions(){return ot},get plotName(){return e(rt)},get patterns(){return e(ft)},get generateLabels(){return Rt},get onClickLegend(){return Dt}})};S(B,x=>{e(Fe).length==0?x(T):x(k,!1)},!0)}_(f,c)};S(P,f=>{e(L).length==0?f($):f(o,!1)},!0)}_(b,m)};S(a,b=>{e(A)?b(n):b(re,!1)},!0)}_(t,r)};S(vt,t=>{e(te)||e(de)?t(mt):t(pt,!1)})}ne(Ye),_(Qe,Ie),St()}export{_r as component};
