import"../chunks/DsnmJJEf.js";import{o as Ne}from"../chunks/C6tn_jEF.js";import{p as Pe,s as i,b as ae,u as R,g as e,d as r,e as H,t as _e,h as M,i as I,f as T,a as k,j as De,k as Re,l as g,n as V,m as Ie,r as Me,c as Fe}from"../chunks/BPIoXquA.js";import{i as Z,b as me}from"../chunks/lzapwbvy.js";import{F as We,g as Ee,a as Ae,r as He,b as pe,S as Te,c as q,t as G,n as Ue}from"../chunks/BG-hj6TZ.js";import{D as J}from"../chunks/BEdcgSQn.js";import{C as fe}from"../chunks/D7Ip14_O.js";import{g as $}from"../chunks/CqS7hfz2.js";import{u as Ye,g as Q}from"../chunks/BUFwSDdR.js";var Be=M("<!> <!> <!> <!>",1),Ke=M("<!> <!>",1),Ve=M('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Ze=M('<div class="text-center">No data with this selection.</div>'),qe=M('<div class="text-center text-muted mt-2">No dual data available.</div>'),Ge=M("<!> <!>",1),Je=M('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Nodal</h1> <!> <div class="my-4"><!></div>',1);function st(ve,be){Pe(be,!0);let W=null,E=i(null),h=i(!1),y=i(!1),U=i(void 0),Y=i(void 0),S=i(ae([])),z=i(ae([])),C=i(ae([]));const he=G(["Hourly","Daily","Weekly","Monthly"]);let o=i(null),_=i(null),m=i(null),p=i(null),x=i("Hourly"),ne=g(()=>{if(!e(o)||!e(o).solution_name)return"";let t=e(o).solution_name.split(".");return[t[t.length-1],e(o).scenario_name,"balance",e(m),e(_),e(p)].join("_")}),ye=g(()=>e(ne)+"_duals"),le=g(()=>{if(e(E)===null)return"";let t=e(E).data.find(n=>n.carrier===e(m));return t?t[0]||t.units||"":e(E).data[0][0]||e(E).data[0].units||""}),A=i(null),X=i(0);R(()=>{e(o)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&r(X,e(o).detail.system.unaggregated_time_steps_per_year,!0)}),R(()=>{e(X),H(()=>{r(A,null)})});let xe=g(()=>oe(`Energy [${e(le)}]`)),we=g(()=>oe("Dual",!1,5,!1));function oe(t,n=!0,u=2,b=!0){return{animation:!1,normalized:!0,parsing:!1,responsive:!0,borderWidth:1,aspectRatio:u,elements:{point:{radius:0}},scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:v=>Number(v).toFixed(0)},min:0,max:e(X)-1},y:{stacked:!0,beginAtZero:b,title:{display:!0,text:t}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const se={zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(le)}`}}};R(()=>{e(C),H(()=>{e(C).length>0&&(e(p)==null||!e(C).includes(Number(e(p))))&&r(p,e(C)[0].toString(),!0)})}),R(()=>{e(S),H(()=>{e(S).length>0&&(e(_)==null||!e(S).includes(e(_)))&&r(_,e(S)[0],!0)})}),R(()=>{e(z),H(()=>{e(z).length>0&&(e(m)==null||!e(z).includes(e(m)))&&r(m,e(z)[0],!0)})}),R(()=>{e(o),e(p),e(_),e(m),e(x),H($e)}),Ne(()=>{r(p,Q("year")||e(p),!0),r(_,Q("node")||e(_),!0),r(m,Q("car")||e(m),!0),r(x,Q("window")||e(x),!0)}),R(()=>{e(p),e(_),e(m),e(x),_e().then(()=>{Ye({year:e(p),node:e(_),car:e(m),window:e(x)})})});let ke=g(()=>({Daily:24,Weekly:168,Monthly:720})[e(x)]||1);async function $e(){e(_)==null||e(m)==null||e(p)==null||e(o)==null||(r(y,!0),await(async t=>{var n=Re(t,2);W=n[0],r(E,n[1],!0)})(await Promise.all([Ee(e(o).solution_name,e(_),e(m),e(o).scenario_name,Number(e(p)),e(ke)),Ae(e(o).solution_name,$("flow_export",e(o).version),e(o).scenario_name)])),r(y,!1),Ce())}let ie=g(()=>Array.from({length:e(K)},(t,n)=>n.toString())),B=[],ee=[],te=i(0),ue=i(0),K=i(0);function Se(){return!e(o)||!e(_)||!e(m)||!e(p)||!W?[]:Object.entries(W).flatMap(([t,n])=>{if(!n||n.length===0||t==="constraint_nodal_energy_balance")return[];let u={node:[e(_)]};"technology"in n[0].index&&(u={technology:n.map(a=>a.index.technology)});const b=n.filter(a=>Object.entries(u).every(([l,d])=>d.includes(a.index[l]))),v={};return b.forEach(a=>{const l=a.index.technology||a.index.node||a.index.label||"";v[l]||(v[l]=new Array(a.data.length).fill(0)),a.data.forEach((d,w)=>{v[l][w]+=d})}),Object.entries(v).map(([a,l])=>{if(Object.keys(l).length==0)return null;const d=e(o).version,w={[$("flow_storage_discharge",d)]:s=>s+" (discharge)",[$("flow_transport_in",d)]:s=>s+" (transport in)",[$("flow_import",d)]:()=>"Import",[$("shed_demand",d)]:()=>"Shed Demand",[$("flow_storage_charge",d)]:s=>s+" (charge)",[$("flow_transport_out",d)]:s=>s+" (transport out)",[$("flow_export",d)]:()=>"Export"};let c=Ue(),F=c,f=Object.values(l).map((s,O)=>({x:O,y:s}));return t=="demand"?{data:f,label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(l).length==1?2:0}:{data:f,label:w[t]?.(a)||a,fill:"origin",borderColor:c,backgroundColor:F,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(l).length==1?2:0}}).filter(a=>a!==null)})}function ze(){if(!e(o)||!e(_)||!e(m)||!e(p)||!W)return[];const n=W["constraint_nodal_energy_balance"];return!n||n.length===0?[]:n.map(u=>u.data.length==0?null:{data:u.data.map((v,a)=>({x:a,y:v})),label:`dual_${u.index.carrier}_${u.index.node}`,fill:!1,borderColor:"rgb(0, 0, 0)",backgroundColor:"rgb(0, 0, 0)",borderWidth:2,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:u.data.length==1?2:0}).filter(u=>u!==null)}async function Ce(){He(),B=Se(),r(te,B.length,!0),r(K,e(te)>0?B[0].data.length:0,!0),ee=ze(),r(ue,ee.length,!0),await _e(),e(U)&&e(U).updateChart(B),e(Y)&&e(Y).updateChart(ee)}var de=Je(),ce=I(T(de),2);We(ce,{children:(t,n)=>{var u=Ke(),b=T(u);pe(b,{title:"Solution Selection",children:(l,d)=>{{let w=g(()=>e(y)||e(h));Te(l,{get disabled(){return e(w)},get selected_solution(){return e(o)},set selected_solution(c){r(o,c,!0)},get carriers(){return e(z)},set carriers(c){r(z,c,!0)},get nodes(){return e(S)},set nodes(c){r(S,c,!0)},get years(){return e(C)},set years(c){r(C,c,!0)},get loading(){return e(h)},set loading(c){r(h,c,!0)}})}}});var v=I(b,2);{var a=l=>{pe(l,{title:"Data Selection",children:(d,w)=>{var c=Be(),F=T(c);q(F,{label:"Year",content:(L,j=V)=>{{let N=g(()=>G(e(C).map(D=>D.toString()))),P=g(()=>e(y)||e(h));J(L,{get formId(){return j()},get options(){return e(N)},get disabled(){return e(P)},get value(){return e(p)},set value(D){r(p,D,!0)}})}}});var f=I(F,2);q(f,{label:"Node",content:(L,j=V)=>{{let N=g(()=>G(e(S))),P=g(()=>e(y)||e(h));J(L,{get formId(){return j()},get options(){return e(N)},get disabled(){return e(P)},get value(){return e(_)},set value(D){r(_,D,!0)}})}}});var s=I(f,2);q(s,{label:"Carrier",content:(L,j=V)=>{{let N=g(()=>G(e(z))),P=g(()=>e(y)||e(h));J(L,{get formId(){return j()},get options(){return e(N)},get disabled(){return e(P)},get value(){return e(m)},set value(D){r(m,D,!0)}})}}});var O=I(s,2);q(O,{label:"Smoothing Window Size",content:(L,j=V)=>{{let N=g(()=>e(y)||e(h));J(L,{get formId(){return j()},get options(){return he},get disabled(){return e(N)},get value(){return e(x)},set value(P){r(x,P,!0)}})}}}),k(d,c)}})};Z(v,l=>{!e(h)&&e(o)&&l(a)})}k(t,u)}});var ge=I(ce,2),Oe=Ie(ge);{var Le=t=>{var n=Ve();k(t,n)},je=t=>{var n=Fe(),u=T(n);{var b=a=>{var l=Ze();k(a,l)},v=a=>{var l=Ge(),d=T(l);{let f=g(()=>e(K)==1?"bar":"line");me(fe(d,{get type(){return e(f)},get labels(){return e(ie)},datasets:[],get options(){return e(xe)},get pluginOptions(){return se},get plotName(){return e(ne)},zoom:!0,get zoomLevel(){return e(A)},set zoomLevel(s){r(A,s,!0)}}),s=>r(U,s,!0),()=>e(U))}var w=I(d,2);{var c=f=>{{let s=g(()=>e(K)==1?"bar":"line");me(fe(f,{id:"chart-duals",get type(){return e(s)},get labels(){return e(ie)},datasets:[],get options(){return e(we)},get pluginOptions(){return se},get plotName(){return e(ye)},zoom:!0,narrow:!0,generateLabels:()=>[],get zoomLevel(){return e(A)},set zoomLevel(O){r(A,O,!0)}}),O=>r(Y,O,!0),()=>e(Y))}},F=f=>{var s=qe();k(f,s)};Z(w,f=>{e(ue)>0?f(c):f(F,!1)})}k(a,l)};Z(u,a=>{e(te)==0||e(o)==null?a(b):a(v,!1)},!0)}k(t,n)};Z(Oe,t=>{e(y)?t(Le):t(je,!1)})}Me(ge),k(ve,de),De()}export{st as component};
