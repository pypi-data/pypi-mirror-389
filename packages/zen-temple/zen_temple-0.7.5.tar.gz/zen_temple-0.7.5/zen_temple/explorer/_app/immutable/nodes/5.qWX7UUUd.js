import"../chunks/DsnmJJEf.js";import{o as Je}from"../chunks/C6tn_jEF.js";import{p as Qe,s,b as ie,u as N,g as e,d as a,e as B,l as c,t as $e,o as Xe,h as y,i as L,f as C,a as g,j as et,n as ue,m as tt,r as rt,c as G}from"../chunks/BPIoXquA.js";import{i as A,b as De}from"../chunks/lzapwbvy.js";import{T as at}from"../chunks/CLrfXApy.js";import{d as lt,F as ot,n as nt,e as _e,r as st,b as fe,S as it,c as de,t as ve}from"../chunks/BG-hj6TZ.js";import{A as Oe}from"../chunks/CAngS_wK.js";import{C as je}from"../chunks/D7Ip14_O.js";import{D as me}from"../chunks/BEdcgSQn.js";import{u as ut,g as pe}from"../chunks/BUFwSDdR.js";var dt=y("<!> <!> <!>",1),gt=y("<!> <!> <!>",1),ct=y("<!> <!>",1),_t=y("<!> <!>",1),ft=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),vt=y('<div class="text-center">No technologies with this selection.</div>'),mt=y('<div class="text-center">No carriers with this selection.</div>'),pt=y('<div class="text-center">No solution selected.</div>'),ht=y('<div class="text-center">No locations with this selection.</div>'),bt=y('<div class="text-center">No data available for this selection.</div>'),wt=y("<!> <!>",1),yt=y('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Storage</h1> <!> <div class="mt-4 plot"><!></div>',1);function Dt(Ae,Te){Qe(Te,!0);let x=null,J=null,Q=null,X=null,ee=null,te=s(0),he=s(ie({})),T=s(ie([]));const Ie=["Hourly","Daily","Weekly","Monthly"];let n=s(null),m=s(null),S=s(""),I=s("Hourly"),R=s(!0),P=s(ie([])),$=s(ie([])),E=s(!1),D=s(!1),re=s(void 0),ae=s(void 0),be=c(()=>e(U).length>0?e(he)[e(U)[0]]:""),we=c(()=>{if(!e(n)||!e(n).solution_name)return"";let r=e(n).solution_name.split(".");return[r[r.length-1],e(n).scenario_name,"storage_level",e(m)].join("_")}),Re=c(()=>e(we)+"_flows"),Ee=c(()=>xe("Storage Level")),Me=c(()=>xe("Storage Flow")),K=s(null),ye=s(0);N(()=>{e(n)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&a(ye,e(n).detail.system.unaggregated_time_steps_per_year,!0)}),N(()=>{e(ye),B(()=>{a(K,null)})});function xe(r){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},responsive:!0,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:t=>Number(t).toFixed(0)},min:0,max:(e(n)?.detail?.system.unaggregated_time_steps_per_year||0)-1},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${r} [${e(be)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const Se={zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(be)}`}}};let Z=c(()=>(e(te),x?_e(x.map(r=>r.index.node)).sort():[])),M=c(()=>{if(e(te),!x||!e(n))return[];let r=Array.from(x.map(t=>t.index.technology));return _e(x.filter(t=>r.includes(t.index.technology)).map(t=>e(n).detail.reference_carrier[t.index.technology]))}),U=c(()=>(e(te),!x||!e(n)||e(M).length===0?[]:_e(x.map(t=>t.index.technology)).filter(t=>e(n).detail.reference_carrier[t]==e(m))));N(()=>{e(U),B(()=>{a(P,e(U),!0)})}),N(()=>{e(Z),B(()=>{a($,e(Z),!0)})}),N(()=>{e(M),B(()=>{e(M).length>0&&(!e(m)||!e(M).includes(e(m)))&&(a(m,e(M)[0],!0),oe())})}),N(()=>{e(T),B(()=>{e(T).length>0&&(!e(S)||!e(T).includes(Number(e(S))))&&(a(S,e(T)[0].toString(),!0),oe())})}),N(()=>{e(m),e(R),e(P),e($),B(oe)}),Je(()=>{a(m,pe("car")||e(m),!0),a(S,pe("year")||e(S),!0),a(I,pe("window")||e(I),!0)}),N(()=>{e(S),e(m),e(I),$e().then(()=>{ut({year:e(S),car:e(m),window:e(I)})})}),N(()=>{We()});async function We(){if(e(n)===null||!e(S))return;a(D,!0);let r={Daily:24,Weekly:168,Monthly:720}[e(I)]||1;const t=await lt(e(n).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(n).scenario_name,"storage_level",Number(e(S)),r);x=t.components.storage_level||null,J=t.components.flow_storage_charge||null,Q=t.components.flow_storage_discharge||null,X=t.components.flow_storage_spillage||null,ee=t.components.flow_storage_inflow||null,Xe(te),t.unit?.data&&a(he,Object.fromEntries(t.unit.data.map(_=>[_.technology,_[0]||_.units])),!0),a(D,!1),oe()}let Ce=c(()=>Array.from({length:e(ke)},(r,t)=>t.toString())),le=[],ge=[],ce=s(0),He=s(0),ke=s(0);function Ue(){return e($).length==0||e(P).length==0||!x||!J||!Q||!ee||!X?[]:ze(x,{technology:e(P),node:e($)},e(R)?["technology"]:[],e(R)?void 0:()=>({label:"Storage Level",borderColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0.2)"}))}function Ve(){return e(n)===null||e(D)||e($).length==0||e(P).length==0||!x||!J||!Q||!ee||!X?[]:[{data:J,label_suffix:"_charge",label_aggregated:"Flow Storage Charge",negate:!1,color:"rgb(54, 162, 235)"},{data:Q,label_suffix:"_discharge",label_aggregated:"Flow Storage Discharge",negate:!0,color:"rgb(255, 99, 132)"},{data:ee,label_suffix:"_inflow",label_aggregated:"Flow Storage Inflow",negate:!1,color:"rgb(75, 192, 192)"},{data:X,label_suffix:"_spillage",label_aggregated:"Flow Storage Spillage",negate:!0,color:"rgb(255, 99, 132)"}].flatMap(({data:r,label_suffix:t,label_aggregated:_,negate:O,color:j})=>ze(r,{technology:e(P),node:e($)},e(R)?["technology"]:[],e(R)?o=>({label:o.index.column+t}):()=>({label:_,borderColor:j,backgroundColor:j}),o=>O?-o:o))}async function oe(){st(),le=Ue(),ge=Ve(),a(ce,le.length,!0),a(He,ge.length,!0),a(ke,e(ce)>0?le[0].data.length:0,!0),await $e(),e(re)&&e(re).updateChart(le),e(ae)&&e(ae).updateChart(ge)}function ze(r,t,_,O=()=>({}),j=o=>o){let o=r.filter(l=>Object.entries(t).every(([i,u])=>u.includes(l.index[i]))).map(l=>({index:l.index,data:l.data.map(j)}));if(o.length===0)return[];if(_){const l=Array.isArray(_)?_:[0],i={};o.forEach(u=>{const d=l.map(f=>u.index[f]).join("_");i[d]||(i[d]=new Array(u.data.length).fill(0)),u.data.forEach((f,p)=>{i[d][p]+=f})}),o=Object.entries(i).map(([u,d])=>({index:{column:u},data:d}))}return o.map(l=>{const i=O(l),u=i.borderColor||nt();return{...i,data:l.data.map((d,f)=>({x:f,y:d})),label:i.label||l.index.column,type:"line",fill:"origin",stepped:!0,borderColor:u,backgroundColor:i.backgroundColor||u}})}var Fe=yt(),Ne=L(C(Fe),2);ot(Ne,{children:(r,t)=>{var _=_t(),O=C(_);fe(O,{title:"Solution Selection",children:(l,i)=>{{let u=c(()=>e(D)||e(E));it(l,{get disabled(){return e(u)},get selected_solution(){return e(n)},set selected_solution(d){a(n,d,!0)},get loading(){return e(E)},set loading(d){a(E,d,!0)},get years(){return e(T)},set years(d){a(T,d,!0)}})}}});var j=L(O,2);{var o=l=>{var i=ct(),u=C(i);fe(u,{title:"Variable Selection",children:(p,ne)=>{var q=dt(),W=C(q);de(W,{label:"Year",content:(b,z=ue)=>{{let v=c(()=>ve(e(T).map(F=>F.toString()))),w=c(()=>e(D)||e(E));me(b,{get formId(){return z()},get options(){return e(v)},get disabled(){return e(w)},get value(){return e(S)},set value(F){a(S,F,!0)}})}}});var h=L(W,2);de(h,{label:"Carrier",content:(b,z=ue)=>{{let v=c(()=>ve(e(M))),w=c(()=>e(D)||e(E));me(b,{get formId(){return z()},get options(){return e(v)},get disabled(){return e(w)},get value(){return e(m)},set value(F){a(m,F,!0)}})}}});var k=L(h,2);de(k,{label:"Smoothing Window Size",content:(b,z=ue)=>{{let v=c(()=>ve(Ie)),w=c(()=>e(D)||e(E));me(b,{get formId(){return z()},get options(){return e(v)},get disabled(){return e(w)},get value(){return e(I)},set value(F){a(I,F,!0)}})}}}),g(p,q)}});var d=L(u,2);{var f=p=>{fe(p,{title:"Data Selection",children:(ne,q)=>{var W=gt(),h=C(W);de(h,{label:"Technology Subdivision",content:(z,v=ue)=>{at(z,{get formId(){return v()},get value(){return e(R)},set value(w){a(R,w,!0)}})}});var k=L(h,2);Oe(k,{label:"Technologies",get elements(){return e(U)},get value(){return e(P)},set value(b){a(P,b,!0)}});var V=L(k,2);Oe(V,{label:"Nodes",get elements(){return e(Z)},get value(){return e($)},set value(b){a($,b,!0)}}),g(ne,W)}})};A(d,p=>{e(m)&&e(Z).length>0&&p(f)})}g(l,i)};A(j,l=>{e(n)&&l(o)})}g(r,_)}});var Le=L(Ne,2),Ye=tt(Le);{var Be=r=>{var t=ft();g(r,t)},Ke=r=>{var t=G(),_=C(t);{var O=o=>{var l=vt();g(o,l)},j=o=>{var l=G(),i=C(l);{var u=f=>{var p=mt();g(f,p)},d=f=>{var p=G(),ne=C(p);{var q=h=>{var k=pt();g(h,k)},W=h=>{var k=G(),V=C(k);{var b=v=>{var w=ht();g(v,w)},z=v=>{var w=G(),F=C(w);{var Ze=Y=>{var se=bt();g(Y,se)},qe=Y=>{var se=wt(),Pe=C(se);De(je(Pe,{id:"level_chart",type:"line",get labels(){return e(Ce)},datasets:[],get options(){return e(Ee)},get pluginOptions(){return Se},get plotName(){return e(we)},zoom:!0,get zoomLevel(){return e(K)},set zoomLevel(H){a(K,H,!0)}}),H=>a(re,H,!0),()=>e(re));var Ge=L(Pe,2);De(je(Ge,{id:"flow_chart",type:"line",get labels(){return e(Ce)},datasets:[],get options(){return e(Me)},get pluginOptions(){return Se},get plotName(){return e(Re)},zoom:!0,get zoomLevel(){return e(K)},set zoomLevel(H){a(K,H,!0)}}),H=>a(ae,H,!0),()=>e(ae)),g(Y,se)};A(F,Y=>{e(ce)==0?Y(Ze):Y(qe,!1)},!0)}g(v,w)};A(V,v=>{e(Z).length==0?v(b):v(z,!1)},!0)}g(h,k)};A(ne,h=>{e(n)==null?h(q):h(W,!1)},!0)}g(f,p)};A(i,f=>{e(M).length==0?f(u):f(d,!1)},!0)}g(o,l)};A(_,o=>{e(U).length==0?o(O):o(j,!1)},!0)}g(r,t)};A(Ye,r=>{e(E)||e(D)?r(Be):r(Ke,!1)})}rt(Le),g(Ae,Fe),et()}export{Dt as component};
