import"../chunks/DsnmJJEf.js";import{o as Ke}from"../chunks/C6tn_jEF.js";import{p as Qe,s as f,b as j,u as re,g as e,l,e as We,d as a,t as we,h as S,i as N,f as w,a as i,j as Xe,n as K,m as Ze,r as et,c as ae,k as tt}from"../chunks/BPIoXquA.js";import{i as C}from"../chunks/lzapwbvy.js";import{M as rt,r as at,g as nt,n as ot,c as lt,p as st,o as it,a as ct}from"../chunks/rdcgL5Y9.js";import{A as ge}from"../chunks/CAngS_wK.js";import{R as ke}from"../chunks/DXf0k2HG.js";import{C as ut}from"../chunks/D7Ip14_O.js";import{F as dt,b as ve,c as Q,t as se,f as gt,r as vt,n as ft,h as $e}from"../chunks/BG-hj6TZ.js";import{D as fe}from"../chunks/BEdcgSQn.js";import{T as pt}from"../chunks/CLrfXApy.js";import{u as mt,g as ie}from"../chunks/BUFwSDdR.js";import{E as ht}from"../chunks/Dmw0JB4Z.js";var _t=S("<!> <!>",1),yt=S("<!> <!> <!>",1),bt=S("<!> <!> <!> <!>",1),Ct=S("<!> <!>",1),St=S("<!> <!>",1),xt=S('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Tt=S('<div class="text-center">No technologies with this selection.</div>'),wt=S('<div class="text-center">No carriers with this selection.</div>'),kt=S('<div class="text-center">No solution selected.</div>'),$t=S('<div class="text-center">No locations with this selection.</div>'),Pt=S('<div class="text-center">No data with this selection.</div>'),Nt=S('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Capacity</h1> <!> <div class="plot mt-4"><!></div>',1);function zt(Pe,Ne){Qe(Ne,!0);let E=f(j([]));const Ee=["capacity","capacity_addition"],Le={capacity:"Capacity",capacity_addition:"Capacity Addition"},Ae=["conversion","storage","transport"],Oe=["energy","power"],Ue=[{label:"Node",value:"node"},{label:"Technology",value:"technology"}];let W=f(j([])),h=f(j([null])),_=f("capacity"),d=f("conversion"),U=f("energy"),c=f(null),z=f("technology"),D=f(!1),Y=f(j([])),q=f(j([])),G=f(j([])),ne=null,L=f(!1),F=f(!1),X=l(()=>e(h).some(t=>t===null)),pe=f(j({})),me=l(()=>{const t=e(d)=="storage"?e(U):"power";return e(pe)[e(B)[0]+"_"+t]||""}),De=l(()=>e(G).map(t=>t.toString())),Fe=l(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${Le[e(_)]}`+(e(D)?"":` [${e(me)}]`)},min:e(D)?0:void 0,max:e(D)?1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const Ie={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(D)?"":` ${e(me)}`),title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}};let Be=l(()=>e(h)[0]==null?"":[e(h)[0].solution_name.split(".").pop(),e(h)[0].scenario_name,e(_),e(d),e(c)].join("_")),he=l(()=>{if(e(X)||e(d)===null)return[];const t={conversion:"set_conversion_technologies",storage:"set_storage_technologies",transport:"set_transport_technologies"}[e(d)];return e(h).map(s=>s.detail.system[t]||[])}),I=l(()=>{if(e(E).length===0||e(X))return[];const t=new Set;return e(h).forEach((s,n)=>{s!==null&&(e(E)[n]??[]).forEach(r=>{(e(he)[n]??[]).includes(r.technology)&&t.add(s.detail.reference_carrier[r.technology])})}),Array.from(t).sort()}),B=l(()=>{if(e(d)===null||e(c)===null||e(X))return[];const t=new Set;return e(h).forEach((s,n)=>{(e(he)[n]??[]).forEach(r=>{s.detail.reference_carrier[r]===e(c)&&t.add(r)})}),Array.from(t).sort()}),H=l(()=>{if(e(X))return[];const t=new Set;return e(E).forEach(s=>{s.forEach(n=>{e(B).includes(n.technology)&&t.add(n.location)})}),Array.from(t).sort()});re(()=>{e(I),We(()=>{(e(c)==null||!e(I).includes(e(c)))&&(ne!=null&&e(I).includes(ne)?a(c,ne,!0):a(c,e(I).length>0?e(I)[0]:null,!0))})}),re(()=>{e(c)!=null&&(ne=e(c))}),re(()=>{a(q,e(B),!0)}),re(()=>{a(Y,e(H),!0)}),Ke(()=>{a(_,ie("var")||e(_),!0),a(d,ie("tech")||e(d),!0),a(U,ie("stor")||e(U),!0),a(c,ie("car")||e(c),!0)}),re(()=>{e(_),e(d),e(U),e(c),we().then(()=>{mt({var:e(_),tech:e(d),stor:e(U),car:e(c)})})});function oe(){a(z,"node"),a(D,!1),a(Y,e(H),!0),a(q,e(B),!0),a(G,e(W),!0)}async function Re(){await we(),oe(),await ye()}async function Ve(){oe(),await ye()}function _e(){oe()}function Me(){oe()}async function ye(){if(e(_)===null||e(X)){a(E,[],!0);return}a(F,!0);const t=e(h),s=e(_),n=await Promise.all(t.map(r=>gt(r.solution_name,[s],r.scenario_name)));a(E,n.map(r=>r[s]?.data).filter(r=>r!==void 0),!0),n[0]?.unit?.data&&a(pe,Object.fromEntries(n[0].unit.data.map(r=>[r.technology+"_"+r.capacity_type,r[0]||r.units])),!0),a(F,!1)}function je(t,s,n){const r={},k=["capacity_type"];e(z)=="technology"?(r.technology=e(q),r.location=e(H),k.push("location")):(r.location=e(Y),r.technology=e(B),k.push("technology")),e(d)=="storage"&&(r.capacity_type=[e(U)]);let g=ht.fromRows(t).filterByCriteria(r).filterDataByIndex(e(G).map(u=>e(W).indexOf(u))).groupBy(k);return e(D)&&(g=g.normalize()),g.toArray().map(u=>{const R=e(z)==="technology"?u.index.location:u.index.technology,$=ft(R);return{label:R,data:u.data,borderColor:$,backgroundColor:n!==void 0?st.draw(n,$e($)):$e($),stack:s}})}let ze=l(()=>{if(e(_)==null||e(Y).length==0||e(G).length==0||e(q).length==0||e(E).length===0)return[[],[]];vt(),at();const t=[];return[e(h).flatMap((n,r)=>{if(n===null||!e(E)[r])return[];const k=nt(n.solution_name,n.scenario_name),g=r>0?ot():void 0;return t.push(lt(k,g)),je(e(E)[r],k,g)}),t]}),be=l(()=>tt(e(ze),2)),Ce=l(()=>e(be)[0]),Ye=l(()=>e(be)[1]);var Se=Nt(),xe=N(w(Se),2);dt(xe,{children:(t,s)=>{var n=St(),r=w(n);ve(r,{title:"Solution Selection",children:(u,R)=>{{let $=l(()=>e(F)||e(L));rt(u,{onSelected:Re,get disabled(){return e($)},get solutions(){return e(h)},set solutions(A){a(h,A,!0)},get years(){return e(W)},set years(A){a(W,A,!0)},get loading(){return e(L)},set loading(A){a(L,A,!0)}})}}});var k=N(r,2);{var g=u=>{var R=Ct(),$=w(R);ve($,{title:"Variable Selection",children:(P,le)=>{var Z=yt(),M=w(Z);Q(M,{label:"Variable",content:(p,o=K)=>{{let v=l(()=>se(Ee)),x=l(()=>e(F)||e(L));fe(p,{get formId(){return o()},get options(){return e(v)},get disabled(){return e(x)},onUpdate:Ve,get value(){return e(_)},set value(m){a(_,m,!0)}})}}});var y=N(M,2);{var O=b=>{var p=_t(),o=w(p);Q(o,{label:"Technology Type",content:(T,te=K)=>{{let ce=l(()=>se(Ae)),ue=l(()=>e(F)||e(L));fe(T,{get formId(){return te()},get options(){return e(ce)},get disabled(){return e(ue)},onUpdate:_e,get value(){return e(d)},set value(de){a(d,de,!0)}})}}});var v=N(o,2);{var x=m=>{Q(m,{label:"",content:(te,ce=K)=>{{let ue=l(()=>se(Oe)),de=l(()=>e(F)||e(L));ke(te,{get formId(){return ce()},get options(){return e(ue)},onUpdate:_e,get disabled(){return e(de)},get value(){return e(U)},set value(Je){a(U,Je,!0)}})}}})};C(v,m=>{e(d)=="storage"&&m(x)})}i(b,p)};C(y,b=>{e(_)!=null&&b(O)})}var J=N(y,2);{var ee=b=>{Q(b,{label:"Carrier",content:(o,v=K)=>{{let x=l(()=>se(e(I))),m=l(()=>e(F)||e(L));fe(o,{get formId(){return v()},get options(){return e(x)},get disabled(){return e(m)},onUpdate:Me,get value(){return e(c)},set value(T){a(c,T,!0)}})}}})};C(J,b=>{e(d)!=null&&e(I).length>0&&b(ee)})}i(P,Z)}});var A=N($,2);{var V=P=>{ve(P,{title:"Data Selection",children:(le,Z)=>{var M=bt(),y=w(M);Q(y,{label:"Aggregation",content:(v,x=K)=>{ke(v,{get formId(){return x()},get options(){return Ue},get value(){return e(z)},set value(m){a(z,m,!0)}})}});var O=N(y,2);Q(O,{label:"Normalization",content:(v,x=K)=>{pt(v,{get formId(){return x()},get value(){return e(D)},set value(m){a(D,m,!0)}})}});var J=N(O,2);{var ee=o=>{ge(o,{label:"Technologies",get elements(){return e(B)},get value(){return e(q)},set value(v){a(q,v,!0)}})},b=o=>{ge(o,{label:"Nodes",get elements(){return e(H)},get value(){return e(Y)},set value(v){a(Y,v,!0)}})};C(J,o=>{e(z)=="technology"?o(ee):o(b,!1)})}var p=N(J,2);ge(p,{label:"Years",get elements(){return e(W)},get value(){return e(G)},set value(o){a(G,o,!0)}}),i(le,M)}})};C(A,P=>{e(E)&&e(d)&&e(c)&&e(B).length>0&&e(H).length>0&&P(V)})}i(u,R)};C(k,u=>{!e(L)&&e(h)[0]&&u(g)})}i(t,n)}});var Te=N(xe,2),qe=Ze(Te);{var Ge=t=>{var s=xt();i(t,s)},He=t=>{var s=ae(),n=w(s);{var r=g=>{var u=Tt();i(g,u)},k=g=>{var u=ae(),R=w(u);{var $=V=>{var P=wt();i(V,P)},A=V=>{var P=ae(),le=w(P);{var Z=y=>{var O=kt();i(y,O)},M=y=>{var O=ae(),J=w(O);{var ee=p=>{var o=$t();i(p,o)},b=p=>{var o=ae(),v=w(o);{var x=T=>{var te=Pt();i(T,te)},m=T=>{ut(T,{type:"bar",get datasets(){return e(Ce)},get labels(){return e(De)},get options(){return e(Fe)},get pluginOptions(){return Ie},get plotName(){return e(Be)},get patterns(){return e(Ye)},get generateLabels(){return ct},get onClickLegend(){return it}})};C(v,T=>{e(Ce).length==0?T(x):T(m,!1)},!0)}i(p,o)};C(J,p=>{e(H).length==0?p(ee):p(b,!1)},!0)}i(y,O)};C(le,y=>{e(h)[0]==null?y(Z):y(M,!1)},!0)}i(V,P)};C(R,V=>{e(I).length==0?V($):V(A,!1)},!0)}i(g,u)};C(n,g=>{e(B).length==0?g(r):g(k,!1)},!0)}i(t,s)};C(qe,t=>{e(L)||e(F)?t(Ge):t(He,!1)})}et(Te),i(Pe,Se),Xe()}export{zt as component};
