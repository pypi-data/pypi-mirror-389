import"../chunks/DsnmJJEf.js";import{o as He}from"../chunks/C6tn_jEF.js";import{p as Je,s as l,b as _,u as J,d as n,g as e,l as c,t as Ke,h as A,i as x,f as k,a as h,j as Qe,n as X,m as We,r as Xe,c as Ee,k as Ze}from"../chunks/BPIoXquA.js";import{i as C}from"../chunks/lzapwbvy.js";import{M as et,g as Ae,c as tt,p as at,n as rt,r as nt,o as ot,a as lt}from"../chunks/rdcgL5Y9.js";import{A as Z}from"../chunks/CAngS_wK.js";import{R as Le}from"../chunks/DXf0k2HG.js";import{C as st}from"../chunks/D7Ip14_O.js";import{F as it,b as ge,c as ee,a as ut,f as ct,t as mt,n as $e,h as fe,r as dt}from"../chunks/BG-hj6TZ.js";import{T as Oe}from"../chunks/CLrfXApy.js";import{g as E}from"../chunks/CqS7hfz2.js";import{u as gt,a as ft,g as vt}from"../chunks/BUFwSDdR.js";import{E as K}from"../chunks/Dmw0JB4Z.js";var _t=A("<!> <!>",1),pt=A("<!> <!>",1),ht=A("<!> <!> <!>",1),bt=A("<!> <!>",1),yt=A("<!> <!> <!>",1),Ct=A('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),St=A('<div class="text-center">No solution selected</div>'),xt=A('<div class="text-center">No data with this selection.</div>'),Et=A('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Emissions</h1> <!> <div class="mt-4"><!></div>',1);function Ft(ke,we){Je(we,!0);let Y=l(_([])),I=l(_([])),te=l(_([])),ae=l(_([])),re=l(_([])),ne=l(_([])),ve=l(_({})),_e=l(_({})),w=l(!1),j=l(!1),q=l(_([]));const Pe=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],De=["Annual","Cumulative"];let m=l(_([null])),f=l(!0),b=l("Annual"),T=l(_([])),B=l(_([])),P=l("location"),oe=l(!1),F=l(_([])),D=l(_([])),L=c(()=>e(m).some(t=>t===null)),M=c(()=>e(oe)&&e(f)),Ne=c(()=>{if(!e(m)[0]?.solution_name)return"";let t=e(m)[0].solution_name.split(".");return[t[t.length-1],e(m)[0].scenario_name,e(he)].join("_")}),pe=c(()=>e(f)?Object.values(e(ve))[0]||"":Object.values(e(_e))[0]||""),Re=c(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Emissions"+(e(M)?"":` [${e(pe)}]`)},max:e(M)?1:void 0,suggestedMin:e(M)?-1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const je={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(M)?"":` ${e(pe)}`),title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}};let he=c(()=>e(f)?E("carbon_emissions_carrier",e(m)[0]?.version):e(b)=="Annual"?E("carbon_emissions_annual",e(m)[0]?.version):E("carbon_emissions_cumulative",e(m)[0]?.version)),Q=c(()=>{if(e(L))return[];const t=new Set;return e(Y).forEach(r=>{r.forEach(o=>t.add(o.technology))}),Array.from(t).sort()}),W=c(()=>{if(e(L))return[];const t=new Set;return e(I).forEach(r=>{r.forEach(o=>t.add(o.carrier))}),Array.from(t).sort()}),le=c(()=>{if(e(L))return[];const t=new Set;return e(Y).forEach(r=>{r.forEach(o=>t.add(o.location))}),e(I).forEach(r=>{r.forEach(o=>t.add(o.node))}),Array.from(t).sort()});J(()=>{n(B,e(Q),!0)}),J(()=>{n(T,e(W),!0)}),J(()=>{n(F,e(le),!0)}),J(()=>{n(D,e(q),!0)}),He(()=>{n(f,ft("subdiv",e(f)),!0),n(b,vt("cumul")||e(b),!0)}),J(()=>{e(f),e(b),Ke().then(()=>{gt({subdiv:e(f)?"1":"0",cumul:e(b)})})});function Te(){Be()}async function Be(){if(e(m).length===0||e(m).some(a=>a==null))return;n(j,!0);const t=e(m),r={technology:E("carbon_emissions_technology",t[0].version),carrier:E("carbon_emissions_carrier",t[0].version),annual_limit:E("carbon_emissions_annual_limit",t[0].version),budget:E("carbon_emissions_budget",t[0].version),annual:E("carbon_emissions_annual",t[0].version),cumulative:E("carbon_emissions_cumulative",t[0].version)};let[o,...g]=await Promise.all([ut(t[0].solution_name,r.annual,t[0].scenario_name),...t.flatMap(a=>[ct(a.solution_name,Object.values(r),a.scenario_name,r.carrier)])]);n(Y,g.map(a=>a[r.technology]?.data||[]),!0),n(I,g.map(a=>a[r.carrier]?.data||[]),!0),n(re,g.map(a=>a[r.annual_limit]?.data||[]),!0),n(ne,g.map(a=>a[r.budget]?.data||[]),!0),n(te,g.map(a=>a[r.annual]?.data||[]),!0),n(ae,g.map(a=>a[r.cumulative]?.data||[]),!0),g[0].unit?.data&&n(ve,Object.fromEntries(g[0].unit.data.map(a=>[a.carrier,a[0]||a.units])),!0),o.data&&n(_e,Object.fromEntries(o.data.map(a=>[a.carrier,a[0]||a.units])),!0),n(j,!1)}let Fe=c(()=>{if(e(m).length===0||e(L)||!e(te).length||!e(ae).length||!e(I).length||!e(Y).length)return[[],[]];let t,r;e(f)?e(P)=="location"?(t={technology_carrier:e(B).concat(e(T)),location:e(F)},r=["technology_carrier"]):(t={technology_carrier:e(B).concat(e(T)),location:e(F)},r=["location"]):(t={},r=[]),dt(),nt();const o=[];return[e(m).flatMap((a,d)=>{if(!a)return[];let s;e(f)?s=K.concatenate([K.fromRows(e(I)[d]).mapIndex(i=>({...i,technology_carrier:i.carrier,location:i.node})),K.fromRows(e(Y)[d]).mapIndex(i=>({...i,technology_carrier:i.technology}))]):e(b)=="Annual"?s=K.fromRows(e(te)[d]):s=K.fromRows(e(ae)[d]),s=s.filterByCriteria(t).groupBy(r).filterDataByIndex(e(D).map(i=>e(q).indexOf(i))),e(M)&&(s=s.normalize());const S=Ae(a.solution_name,a.scenario_name),v=d>0?rt():void 0;return o.push(tt(S,v)),s.toArray().map(i=>{const p=s.length===1?e(he):e(P)==="location"?i.index.technology_carrier:i.index.location,u=$e(p);return{label:p,data:i.data,borderColor:u,backgroundColor:v!==void 0?at.draw(v,fe(u)):fe(u),stack:S}})}),o]}),be=c(()=>Ze(e(Fe),2)),Me=c(()=>e(be)[0]),Ue=c(()=>e(be)[1]),ze=c(()=>e(m).length===0||e(L)||e(M)||e(P)==="location"&&e(F).length!==e(le).length||e(P)==="technology_carrier"&&(e(T).length!==e(W).length||e(B).length!==e(Q).length)?[]:e(m).flatMap((t,r)=>{if(!t)return[];let o;if(e(f)||e(b)=="Annual"){if((e(re)[r]??[]).length===0)return[];o=Object.entries(e(re)[r][0]).map(([s,S])=>S==="inf"?1/0:Number(S))}else{if((e(ne)[r]??[]).length===0)return[];const s=Number(Object.values(e(ne)[r][0])[0]);o=e(D).map(()=>s)}const g=Ae(t.solution_name,t.scenario_name),a=(e(f)||e(b)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget")+(e(m).length>1?` (${g})`:""),d=$e(a);return[{label:a,data:o,borderColor:d,backgroundColor:fe(d),type:"line"}]})),ye=c(()=>e(Me).concat(e(ze)));var Ce=Et(),Se=x(k(Ce),2);it(Se,{children:(t,r)=>{var o=yt(),g=k(o);ge(g,{title:"Solution Selection",children:(v,i)=>{{let p=c(()=>e(j)||e(w));et(v,{get disabled(){return e(p)},onSelected:Te,get solutions(){return e(m)},set solutions(u){n(m,u,!0)},get years(){return e(q)},set years(u){n(q,u,!0)},get loading(){return e(w)},set loading(u){n(w,u,!0)}})}}});var a=x(g,2);{var d=v=>{ge(v,{title:"Variable Selection",children:(i,p)=>{var u=_t(),N=k(u);ee(N,{label:"Subdivision",content:(G,U=X)=>{Oe(G,{get formId(){return U()},get value(){return e(f)},set value(z){n(f,z,!0)}})}});var se=x(N,2);{var ie=y=>{ee(y,{label:"Cumulation",content:(U,z=X)=>{{let ue=c(()=>mt(De)),ce=c(()=>e(j)||e(w));Le(U,{get formId(){return z()},get options(){return e(ue)},get disabled(){return e(ce)},get value(){return e(b)},set value(me){n(b,me,!0)}})}}})};C(se,y=>{e(f)||y(ie)})}h(i,u)}})};C(a,v=>{!e(w)&&!e(L)&&v(d)})}var s=x(a,2);{var S=v=>{ge(v,{title:"Data Selection",children:(i,p)=>{var u=bt(),N=k(u);{var se=y=>{var G=ht(),U=k(G);ee(U,{label:"Aggregation",content:(O,V=X)=>{Le(O,{get formId(){return V()},get options(){return Pe},get value(){return e(P)},set value(H){n(P,H,!0)}})}});var z=x(U,2);ee(z,{label:"Normalization",content:(O,V=X)=>{Oe(O,{get formId(){return V()},get value(){return e(oe)},set value(H){n(oe,H,!0)}})}});var ue=x(z,2);{var ce=$=>{Z($,{label:"Locations",get elements(){return e(le)},get value(){return e(F)},set value(O){n(F,O,!0)}})},me=$=>{var O=pt(),V=k(O);{var H=R=>{Z(R,{label:"Technologies",get elements(){return e(Q)},get value(){return e(B)},set value(de){n(B,de,!0)}})};C(V,R=>{e(Q).length>0&&R(H)})}var qe=x(V,2);{var Ge=R=>{Z(R,{label:"Carriers",get elements(){return e(W)},get value(){return e(T)},set value(de){n(T,de,!0)}})};C(qe,R=>{e(W).length>0&&R(Ge)})}h($,O)};C(ue,$=>{e(P)=="location"?$(ce):$(me,!1)})}h(y,G)};C(N,y=>{e(f)&&y(se)})}var ie=x(N,2);Z(ie,{label:"Years",get elements(){return e(q)},get value(){return e(D)},set value(y){n(D,y,!0)}}),h(i,u)}})};C(s,v=>{!e(w)&&!e(L)&&!e(j)&&v(S)})}h(t,o)}});var xe=x(Se,2),Ve=We(xe);{var Ye=t=>{var r=Ct();h(t,r)},Ie=t=>{var r=Ee(),o=k(r);{var g=d=>{var s=St();h(d,s)},a=d=>{var s=Ee(),S=k(s);{var v=p=>{var u=xt();h(p,u)},i=p=>{{let u=c(()=>e(D).map(N=>N.toString()));st(p,{type:"bar",get labels(){return e(u)},get datasets(){return e(ye)},get options(){return e(Re)},get pluginOptions(){return je},get plotName(){return e(Ne)},get patterns(){return e(Ue)},get generateLabels(){return lt},get onClickLegend(){return ot}})}};C(S,p=>{e(ye).length==0||e(D).length==0?p(v):p(i,!1)},!0)}h(d,s)};C(o,d=>{e(m).length==0||e(L)?d(g):d(a,!1)},!0)}h(t,r)};C(Ve,t=>{e(w)||e(j)?t(Ye):t(Ie,!1)})}Xe(xe),h(ke,Ce),Qe()}export{Ft as component};
