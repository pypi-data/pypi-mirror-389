<!-- https://getbootstrap.com/docs/4.0/utilities/embed/#aspect-ratios -->
{% load i18n %}
{% load static %}

{% load unicms_template_italia %}
{% load unicms_templates %}

{% random_id uid as id %}

{% settings_value "EXTERNAL_SOURCES_COOKIE_POLICY_URL" as external_sources_cookie_policy_url %}


<div id="{{ id }}">
    <div class="ratio ratio-{{ ratio }}" v-if="has_consent">
        <iframe title="{{ url }}"
                src="{{ url }}"
                allowfullscreen
                loading="lazy"
                {% if url|slice:"-4:" == ".pdf" %}
                sandbox
                {% else %}
                sandbox="allow-scripts allow-same-origin allow-popups allow-presentation">
                {% endif %}
        </iframe>
    </div>
    <div v-else>
        <div class="alert alert-info" role="alert">
            <h4 class="alert-heading">{% trans "Third Party Content" %}</h4>
            <hr>
            <p>
                {% trans "To view content from the external source" %} <b>[[ host ]]</b>
                (<a href="{{ url }}" target="_blank" rel="nofollow">{% trans "link" %}</a>) {% trans "explicit consent is required" %}.
            </p>
            <p>
                {% trans "Accept cookies from" %} <b>[[ host ]]</b> {% trans "to access the resource" %}.
            </p>
            <p>
                {% trans "You can manage your preferences" %}
                <a href="#" data-bs-toggle="modal" data-bs-target="#modalCookie">{% trans "here" %}</a>
                {% trans "or in the" %}
                <a href="{{ external_sources_cookie_policy_url }}" target="_blank">cookie policy</a>.
            </p>
            <div class="form-check">
                <input id="{{ id }}_permanent" type="checkbox" v-model="permanent">
                <label for="{{ id }}_permanent">
                    {% trans "Remember my choice" %}
                </label>
            </div>
            <button type="button" class="btn btn-secondary btn-xs mt-2" @click="addConsent()">
                {% trans "Allow" %}
            </button>
        </div>
    </div>
</div>
<script>
var {{ id }} = new Vue({
    el: '#{{ id }}',
    data() {
        return {
            has_consent: hasConsent("{{ url }}"),
            host: normalizeHost("{{ url }}"),
            permanent: false
        }
    },
    mounted() {
        editConsent(host=this.host, revoke=false, explicit=false)
    },
    methods: {
        addConsent() {
            this.has_consent = true
            if(this.permanent) editConsent(host=this.host)
        },
    }
})
</script>
