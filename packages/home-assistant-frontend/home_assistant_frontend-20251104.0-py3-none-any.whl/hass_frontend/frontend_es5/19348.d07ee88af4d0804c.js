"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["19348"],{94327:function(e,t,a){a.d(t,{Vy:function(){return i},fI:function(){return s},ux:function(){return l}});var r=a(65940),o=a(83510);const n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function i(e){return n[e%n.length]}function s(e,t){const a=t.getPropertyValue(`--graph-color-${e+1}`)||i(e);return(0,o.RQ)(a)}const l=(0,r.A)(e=>n.map((t,a)=>s(a,e)),(e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1"))},37382:function(e,t,a){a.d(t,{D:function(){return n}});var r=a(10416),o=a.n(r);const n=e=>o()(e,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},80475:function(e,t,a){a.a(e,async function(e,t){try{a(91949),a(35748),a(99342),a(9724),a(35058),a(41846),a(65315),a(837),a(84136),a(22416),a(37089),a(48169),a(12977),a(88238),a(34536),a(16257),a(20152),a(44711),a(72108),a(77030),a(95013);var r=a(69868),o=a(11991),n=a(84922),i=a(65940),s=a(88006),l=a(8147),c=a(35083),d=a(37382),u=a(68717),h=a(83034),p=(a(94124),e([u,s]));[u,s]=p.then?(await p)():p;let f,g,v=e=>e;const y=5,_=12,b=6,m=5;class x extends n.WF{render(){var e;const t={grid:{top:0,bottom:0,left:0,right:0},tooltip:{trigger:"item",formatter:this._renderTooltip,appendTo:document.body}};return(0,n.qy)(f||(f=v`<ha-chart-base .data="${0}" .options="${0}" height="100%" .extraComponents="${0}"></ha-chart-base>`),this._createData(this.data,null===(e=this._sizeController.value)||void 0===e?void 0:e.width),t,[l.A])}_processLinks(e,t){const a=new Map,r=new Map,o=[];return t.forEach(t=>{var n;const i=e.find(e=>e.id===t.source),s=e.find(e=>e.id===t.target);if(!i||!s)return;const l=r.get(i.id)||0,c=a.get(s.id)||0,d=i.value-l,u=s.value-c,h=Math.min(null!==(n=t.value)&&void 0!==n?n:d,d,u);a.set(s.id,c+h),r.set(i.id,l+h),h>0&&o.push(Object.assign(Object.assign({},t),{},{value:h}))}),o}_findParentIndex(e,t,a){var r;const o=null===(r=t.find(t=>t.target===e))||void 0===r?void 0:r.source;if(!o)return-1;let n=0;for(let i=a.length-1;i>=0;i--){const e=a[i],t=e.findIndex(e=>e.id===o);if(-1!==t)return n+t;n+=e.length}return-1}constructor(...e){super(...e),this.data={nodes:[],links:[]},this.vertical=!1,this._sizeController=new s.P(this,{callback:e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.contentRect}}),this._renderTooltip=e=>{const t=e.data,a=this.valueFormatter?this.valueFormatter(t.value):t.value;if(t.id){var r;const o=this.data.nodes.find(e=>e.id===t.id);return`${e.marker} ${(0,d.D)(null!==(r=null==o?void 0:o.label)&&void 0!==r?r:t.id)}<br>${a}`}if(t.source&&t.target){var o,n;const e=this.data.nodes.find(e=>e.id===t.source),r=this.data.nodes.find(e=>e.id===t.target);return`${(0,d.D)(null!==(o=null==e?void 0:e.label)&&void 0!==o?o:t.source)} → ${(0,d.D)(null!==(n=null==r?void 0:r.label)&&void 0!==n?n:t.target)}<br>${a}`}return null},this._createData=(0,i.A)((e,t=0)=>{const a=e.nodes.filter(e=>e.value>0),r=[...new Set(a.map(e=>e.index))].sort(),o=new Map,n=[];r.forEach((t,r)=>{o.set(t,r);const i=a.filter(e=>e.index===t);i.length>0&&n.push(n.length>0?i.sort((t,a)=>{const r=this._findParentIndex(t.id,e.links,n),o=this._findParentIndex(a.id,e.links,n);return r===o?0:-1===r?1:-1===o?-1:r-o}):i)});const i=this._processLinks(a,e.links),s=t/r.length-h.hD-m;return{id:"sankey",type:"sankey",nodes:n.flat().map(e=>({id:e.id,value:e.value,itemStyle:{color:e.color},depth:o.get(e.index)})),links:i,draggable:!1,orient:this.vertical?"vertical":"horizontal",nodeWidth:15,nodeGap:b,lineStyle:{color:"gradient",opacity:.4,curveness:.5},layoutIterations:0,label:{formatter:t=>{var a,r;return null!==(a=null===(r=e.nodes.find(e=>e.id===t.data.id))||void 0===r?void 0:r.label)&&void 0!==a?a:t.data.id},position:this.vertical?"bottom":"right",distance:m,minMargin:5,overflow:"break"},labelLayout:e=>{if(this.vertical){const t=e.text.split(" ").reduce((e,t)=>e.length>t.length?e:t,""),a=(0,c.W)(t,_),r=e.rect.width+6,o=Math.min(_,r/a*_);return{fontSize:o>1?o:0,width:r,align:"center",dy:-2}}const t=e.rect.height+8,a=Math.min(t/e.labelRect.height*_,_);return{fontSize:a,lineHeight:a,width:s,height:e.rect.height}},top:this.vertical?0:y,bottom:this.vertical?25:y,left:this.vertical?y:0,right:this.vertical?y:s+m,emphasis:{focus:"adjacency"}}})}}x.styles=(0,n.AH)(g||(g=v`:host{display:block;flex:1;background:var(--ha-card-background,var(--card-background-color))}ha-chart-base{width:100%;height:100%}`)),(0,r.__decorate)([(0,o.MZ)({attribute:!1})],x.prototype,"hass",void 0),(0,r.__decorate)([(0,o.MZ)({attribute:!1})],x.prototype,"data",void 0),(0,r.__decorate)([(0,o.MZ)({type:Boolean})],x.prototype,"vertical",void 0),(0,r.__decorate)([(0,o.MZ)({type:String,attribute:!1})],x.prototype,"valueFormatter",void 0),(0,r.__decorate)([(0,o.wk)()],x.prototype,"_sizeController",void 0),x=(0,r.__decorate)([(0,o.EM)("ha-sankey-chart")],x),t()}catch(f){t(f)}})},71770:function(e,t,a){a(35748),a(12977),a(95013);var r=a(69868),o=a(30103),n=a(86811),i=a(49377),s=a(34800),l=a(84922),c=a(11991);let d,u,h,p,f=e=>e;class g extends o.k{renderOutline(){return this.filled?(0,l.qy)(d||(d=f`<span class="filled"></span>`)):super.renderOutline()}getContainerClasses(){return Object.assign(Object.assign({},super.getContainerClasses()),{},{active:this.active})}renderPrimaryContent(){return(0,l.qy)(u||(u=f` <span class="leading icon" aria-hidden="true"> ${0} </span> <span class="label">${0}</span> <span class="touch"></span> <span class="trailing leading icon" aria-hidden="true"> ${0} </span> `),this.renderLeadingIcon(),this.label,this.renderTrailingIcon())}renderTrailingIcon(){return(0,l.qy)(h||(h=f`<slot name="trailing-icon"></slot>`))}constructor(...e){super(...e),this.filled=!1,this.active=!1}}g.styles=[i.R,s.R,n.R,(0,l.AH)(p||(p=f`:host{--md-sys-color-primary:var(--primary-text-color);--md-sys-color-on-surface:var(--primary-text-color);--md-assist-chip-container-shape:var(
          --ha-assist-chip-container-shape,
          16px
        );--md-assist-chip-outline-color:var(--outline-color);--md-assist-chip-label-text-weight:400}.filled{display:flex;pointer-events:none;border-radius:inherit;inset:0;position:absolute;background-color:var(--ha-assist-chip-filled-container-color)}::slotted([slot=icon]),::slotted([slot=trailing-icon]){display:flex;--mdc-icon-size:var(--md-input-chip-icon-size, 18px);font-size:var(--_label-text-size)!important}.trailing.icon ::slotted(*),.trailing.icon svg{margin-inline-end:unset;margin-inline-start:var(--_icon-label-space)}::before{background:var(--ha-assist-chip-container-color,transparent);opacity:var(--ha-assist-chip-container-opacity, 1)}:where(.active)::before{background:var(--ha-assist-chip-active-container-color);opacity:var(--ha-assist-chip-active-container-opacity)}.label{font-family:var(--ha-font-family-body)}`))],(0,r.__decorate)([(0,c.MZ)({type:Boolean,reflect:!0})],g.prototype,"filled",void 0),(0,r.__decorate)([(0,c.MZ)({type:Boolean})],g.prototype,"active",void 0),g=(0,r.__decorate)([(0,c.EM)("ha-assist-chip")],g)},83034:function(e,t,a){a.d(t,{Es:function(){return r},dc:function(){return n},hD:function(){return o}});const r=10,o=30,n=20},63002:function(e,t,a){a.a(e,async function(e,r){try{a.d(t,{$3:function(){return y},$O:function(){return w},$j:function(){return _},ED:function(){return s},JE:function(){return E},OQ:function(){return I},PU:function(){return M},Ph:function(){return g},Uf:function(){return k},W1:function(){return v},Wr:function(){return h},Z:function(){return d},gF:function(){return b},iY:function(){return m},jU:function(){return l},nN:function(){return S},p3:function(){return u},pJ:function(){return f},r_:function(){return c},sz:function(){return p}});a(79827),a(35748),a(65315),a(59023),a(12977),a(18223),a(95013);var o=a(72652),n=a(50654),i=e([n]);n=(i.then?(await i)():i)[0];var s=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({});const l=59509==a.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,c=["L","gal","ft³","m³","CCF","MCF"],d=e=>e.sendMessagePromise({type:"recorder/info"}),u=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),h=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),p=(e,t,a,r,o="hour",n,i)=>e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:null==a?void 0:a.toISOString(),statistic_ids:r,period:o,units:n,types:i}),f=(e,t,a,r)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:r,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?Object.assign(Object.assign({},"week"===a.calendar.period?{first_weekday:(0,n.DD)(e.locale).substring(0,3)}:{}),a.calendar):void 0,rolling_window:a.rolling_window}),g=e=>e.callWS({type:"recorder/validate_statistics"}),v=(e,t,a,r)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:a,unit_class:r}),y=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),_=e=>{let t=null;if(!e)return null;for(const a of e)null!==a.change&&void 0!==a.change&&(null===t?t=a.change:t+=a.change);return t},b=(e,t)=>{let a=null;for(const r of t){if(!(r in e))continue;const t=_(e[r]);null!==t&&(null===a?a=t:a+=t)}return a},m=(e,t)=>e.some(e=>void 0!==e[t]&&null!==e[t]),x=["mean","min","max"],z=["sum","state","change"],S=(e,t)=>!(!x.includes(t)||0===e.mean_type)||!(!z.includes(t)||!e.has_sum),k=(e,t,a,r,o)=>{const n=new Date(a).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:n,adjustment:r,adjustment_unit_of_measurement:o})},w=(e,t,a)=>{const r=e.states[t];return r?(0,o.u)(r):(null==a?void 0:a.name)||t},E=(e,t,a)=>{let r;var o;t&&(r=null===(o=e.states[t])||void 0===o?void 0:o.attributes.unit_of_measurement);return void 0===r?null==a?void 0:a.statistics_unit_of_measurement:r},I=e=>e.includes(":"),M=e=>e.callWS({type:"recorder/update_statistics_issues"});r()}catch(l){r(l)}})},75335:function(e,t,a){a.d(t,{Q:function(){return s}});a(35748),a(95013);var r=a(69868),o=a(11991),n=a(48125),i=a(32211);const s=e=>{class t extends e{connectedCallback(){super.connectedCallback(),this._unsubMql=(0,i.m)("all and (max-width: 450px), all and (max-height: 500px)",e=>{this._isMobileSize=e})}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._unsubMql)||void 0===e||e.call(this),this._unsubMql=void 0}constructor(...e){super(...e),this._isMobileSize=!1,this._isMobileClient=n.M}}return(0,r.__decorate)([(0,o.wk)()],t.prototype,"_isMobileSize",void 0),t}},41970:function(e,t,a){a.a(e,async function(e,r){try{a.r(t);a(79827),a(35748),a(99342),a(35058),a(86149),a(65315),a(22416),a(12977),a(18223),a(39118),a(95013);var o=a(69868),n=a(84922),i=a(11991),s=(a(70490),a(86160),a(43716)),l=a(63002),c=a(40328),d=a(80475),u=a(94327),h=a(8868),p=a(73941),f=a(75335),g=e([d,s,l,h]);[d,s,l,h]=g.then?(await g)():g;let v,y,_,b,m,x=e=>e;const z={group_by_floor:!0,group_by_area:!0};class S extends((0,c.E)((0,f.Q)(n.WF))){setConfig(e){this._config=Object.assign(Object.assign({},z),e)}hassSubscribe(){var e;return[(0,s.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe(e=>{this._data=e})]}getCardSize(){return 5}getGridOptions(){return{columns:12,min_columns:6,rows:6,min_rows:2}}shouldUpdate(e){return e.has("_config")||e.has("_data")||e.has("_isMobileSize")}render(){if(!this._config)return n.s6;if(!this._data)return(0,n.qy)(v||(v=x`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));const e=this._data.prefs,t=(0,s.E$)(e),{summedData:a,compareSummedData:r}=(0,s.gv)(this._data),{consumption:o,compareConsumption:i}=(0,s.DR)(a,void 0),c=getComputedStyle(this),d=[],h=[],p={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,o.total.used_total),color:c.getPropertyValue("--primary-color").trim(),index:1};if(d.push(p),t.battery){var f,g;const e=null!==(f=a.total.from_battery)&&void 0!==f?f:0,t=null!==(g=a.total.to_battery)&&void 0!==g?g:0;d.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:e,color:c.getPropertyValue("--energy-battery-out-color").trim(),index:0}),h.push({source:"battery",target:"home",value:o.total.used_battery}),d.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:t,color:c.getPropertyValue("--energy-battery-in-color").trim(),index:1}),o.total.grid_to_battery>0&&h.push({source:"grid",target:"battery_in",value:o.total.grid_to_battery}),o.total.solar_to_battery>0&&h.push({source:"solar",target:"battery_in",value:o.total.solar_to_battery})}if(t.grid){var m;const e=null!==(m=a.total.from_grid)&&void 0!==m?m:0;d.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,color:c.getPropertyValue("--energy-grid-consumption-color").trim(),index:0}),h.push({source:"grid",target:"home",value:o.total.used_grid})}if(t.solar){var z;const e=null!==(z=a.total.solar)&&void 0!==z?z:0;d.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:e,color:c.getPropertyValue("--energy-solar-color").trim(),index:0}),h.push({source:"solar",target:"home",value:o.total.used_solar})}if(t.grid&&t.grid[0].flow_to){var S;const e=null!==(S=a.total.to_grid)&&void 0!==S?S:0;d.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,color:c.getPropertyValue("--energy-grid-return-color").trim(),index:1}),o.total.battery_to_grid>0&&h.push({source:"battery",target:"grid_return",value:o.total.battery_to_grid}),o.total.solar_to_grid>0&&h.push({source:"solar",target:"grid_return",value:o.total.solar_to_grid})}let k=p.value;const w=[],E={};e.device_consumption.forEach((e,t)=>{const a=e.stat_consumption in this._data.stats&&(0,l.$j)(this._data.stats[e.stat_consumption])||0;if(a<.01)return;const r={id:e.stat_consumption,label:e.name||(0,l.$O)(this.hass,e.stat_consumption,this._data.statsMetadata[e.stat_consumption]),value:a,color:(0,u.fI)(t,c),index:4,parent:e.included_in_stat};r.parent?(E[r.id]=r.parent,h.push({source:r.parent,target:r.id})):k-=a,w.push(r)});const I=w.filter(e=>!E[e.id]),{group_by_area:M,group_by_floor:C}=this._config;if(M||C){const{areas:e,floors:t}=this._groupByFloorAndArea(I);Object.keys(t).sort((e,t)=>{var a,r,o,n;return(null!==(a=null===(r=this.hass.floors[t])||void 0===r?void 0:r.level)&&void 0!==a?a:-1/0)-(null!==(o=null===(n=this.hass.floors[e])||void 0===n?void 0:n.level)&&void 0!==o?o:-1/0)}).forEach(a=>{let r=`floor_${a}`;"no_floor"!==a&&C?(d.push({id:r,label:this.hass.floors[a].name,value:t[a].value,index:2,color:c.getPropertyValue("--primary-color").trim()}),h.push({source:"home",target:r})):r="home",t[a].areas.forEach(t=>{let a;if("no_area"!==t&&M){const o=`area_${t}`;d.push({id:o,label:this.hass.areas[t].name,value:e[t].value,index:3,color:c.getPropertyValue("--primary-color").trim()}),h.push({source:r,target:o,value:e[t].value}),a=o}else a=r;e[t].devices.forEach(e=>{h.push({source:a,target:e.id,value:e.value})})})})}else I.forEach(e=>{h.push({source:"home",target:e.id,value:e.value})});const $=this._getDeviceSections(E,w);$.forEach((e,t)=>{e.forEach(e=>{d.push(Object.assign(Object.assign({},e),{},{index:4+t}))})}),k>0&&(d.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:k,color:c.getPropertyValue("--state-unavailable-color").trim(),index:3+$.length}),h.push({source:"home",target:"untracked",value:k}));const D=d.some(e=>e.value>0),T="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return(0,n.qy)(y||(y=x` <ha-card .header="${0}"> <div class="card-content"> ${0} </div> </ha-card> `),this._config.title,D?(0,n.qy)(_||(_=x`<ha-sankey-chart .data="${0}" .vertical="${0}" .valueFormatter="${0}"></ha-sankey-chart>`),{nodes:d,links:h},T,this._valueFormatter):(0,n.qy)(b||(b=x`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")))}_groupByFloorAndArea(e){const t={no_area:{value:0,devices:[]}},a={no_floor:{value:0,areas:["no_area"]}};return e.forEach(e=>{const r=this.hass.states[e.id],{area:o,floor:n}=r?(0,p.l)(r,this.hass.entities,this.hass.devices,this.hass.areas,this.hass.floors):{area:null,floor:null};o?(o.area_id in t?(t[o.area_id].value+=e.value,t[o.area_id].devices.push(e)):t[o.area_id]={value:e.value,devices:[e]},n?n.floor_id in a?(a[n.floor_id].value+=e.value,a[n.floor_id].areas.includes(o.area_id)||a[n.floor_id].areas.push(o.area_id)):a[n.floor_id]={value:e.value,areas:[o.area_id]}:(a.no_floor.value+=e.value,a.no_floor.areas.includes(o.area_id)||a.no_floor.areas.unshift(o.area_id))):(t.no_area.value+=e.value,t.no_area.devices.push(e))}),{areas:t,floors:a}}_getDeviceSections(e,t){const a=[],r=[],o=Object.values(e),n={};return t.forEach(t=>{const n=t.id in e;o.includes(t.id)&&!n?a.push(t):r.push(t)}),Object.entries(e).forEach(([e,t])=>{a.some(e=>e.id===t)||(n[e]=t)}),a.length>0?[a,...this._getDeviceSections(n,r)]:[t]}constructor(...e){super(...e),this.hassSubscribeRequiredHostProps=["_config"],this._valueFormatter=e=>`${(0,h.ZV)(e,this.hass.locale,e<.1?{maximumFractionDigits:3}:void 0)} kWh`}}S.styles=(0,n.AH)(m||(m=x`:host{display:block;height:calc(var(--row-size,8) * (var(--row-height,50px) + var(--row-gap,0px)) - var(--row-gap,0px))}ha-card{height:100%;display:flex;flex-direction:column}.card-content{flex:1;display:flex}`)),(0,o.__decorate)([(0,i.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,o.__decorate)([(0,i.wk)()],S.prototype,"_config",void 0),(0,o.__decorate)([(0,i.wk)()],S.prototype,"_data",void 0),S=(0,o.__decorate)([(0,i.EM)("hui-energy-sankey-card")],S),r()}catch(v){r(v)}})},8147:function(e,t,a){a.d(t,{A:function(){return p}});var r=a(50291),o=(a(43114),a(35748),a(99342),a(9724),a(35058),a(93225),a(65315),a(837),a(84136),a(12791),a(22416),a(37089),a(48169),a(12977),a(88238),a(34536),a(16257),a(20152),a(44711),a(72108),a(77030),a(95013),a(41160));function n(e){return"passThrough"in e}const i=1;function s(e,t){e.eachSeriesByType("sankey",e=>{if("justify"!==e.get("nodeAlign"))return;const a=e.get("nodeWidth"),r=e.get("nodeGap"),s=(0,o.Lj)(e,t).refContainer,{width:d,height:u}=s,h=e.getGraph();!function(e,t,a,r,o,s,d){const u=e.filter(e=>e.getLayout().value>0),h=[...new Set(u.map(e=>e.hostGraph.data.getRawDataItem(e.dataIndex).depth||0))].sort(),p=function(e,t){const a=[];return t.forEach(t=>{const r=function(e,t,a){if(0===e.getLayout().value)return[];const r=l(e.node1,t),o=l(e.node2,t),n=function(e){const t=e.hostGraph.edgeData.getRawDataItem(e.dataIndex);return t.value}(e),i=function(e,t,a){return a.slice(e+1,t)}(r.depthIndex,o.depthIndex,t),s=e.node1.hostGraph.data.getRawDataItem(e.node1.dataIndex),c=e.node2.hostGraph.data.getRawDataItem(e.node2.dataIndex),d=i.map(e=>{const t=function(e,t,a,r){return{passThrough:!0,id:`${e}-${t}-${a}`,value:r,depth:a}}(s.id,c.id,e,n);return a.push(t),t.id});return d}(t,e,a);t.passThroughNodeIds=r}),a}(h,t),f=function(e,t,a,r,o,s,l){const{sectionSize:d,sectionDepthSize:u}=function(e,t,a,r,o){const n=("vertical"===e?t:a)-2*o,i="vertical"===e?a/r.length:t/r.length;return{sectionSize:n,sectionDepthSize:i}}(s,r,o,a,l),h=function(e,t){const a={};return e.forEach(e=>{const t=e.getLayout().depth;a[t]?a[t].push(e):a[t]=[e]}),t.forEach(e=>{a[e.depth]?a[e.depth].push(e):a[e.depth]=[e]}),a}(e,t);let p=0;const f=a.map(e=>{const t=function(e){return e.map(e=>({node:e,id:e.id,value:n(e)?e.value:e.getLayout().value,x:0,y:0,dx:0,dy:0,size:0}))}(h[e]||[]),a=d-(t.length+1)*l,r=t.reduce((e,t)=>e+t.value,0),{nodes:o,valueToSizeRatio:i}=c(t,a,r,p);return i>p&&(p=i),{nodes:o,depth:e,totalValue:r,valueToSizeRatio:i}});return f.forEach((e,t)=>{!function(e,t,a,r,o,n){let s=0;e.valueToSizeRatio!==o?e.nodes.forEach(e=>{const t=Math.max(i,Math.floor(e.value/o));s+=t,e.size=t}):s=e.nodes.reduce((e,t)=>e+t.size,0);const l=a-s;let c=l/(e.nodes.length+1);e.nodes.forEach(a=>{"vertical"===n?(a.x=c,a.y=t*r):(a.x=t*r,a.y=c),c+=a.size+l/(e.nodes.length+1)})}(e,t,d,u,p,s)}),f.flatMap(e=>e.nodes)}(u,p,h,o,s,d,r);!function(e,t,a){const r=function(e){return"vertical"===e?{breadth:"x",depth:"y",breadthSize:"dx",depthSize:"dy"}:{breadth:"y",depth:"x",breadthSize:"dy",depthSize:"dx"}}(a),o="vertical"===a?"curveVertical":"curveHorizontal";(function(e,t,a){e.forEach(e=>{e[a.breadthSize]=e.size,e[a.depthSize]=t,n(e.node)||e.node.setLayout({x:e.x,y:e.y,dx:e.dx,dy:e.dy},!0)})})(e,t,r),function(e,t){e.forEach(e=>{n(e.node)||e.node.outEdges.forEach(a=>{const r=a.hostGraph.edgeData.getRawDataItem(a.dataIndex).value/e.value*e.size;a.setLayout({[t.breadthSize]:r,[t.depthSize]:0},!0)})})}(e,r),function(e,t){e.forEach(e=>{n(e.node)||(e.node.outEdges.sort((e,a)=>e.node2.getLayout()[t.breadth]-a.node2.getLayout()[t.breadth]),e.node.inEdges.sort((e,a)=>e.node1.getLayout()[t.breadth]-a.node1.getLayout()[t.breadth]))})}(e,r),e.forEach(t=>{n(t.node)||(function(e,t,a){if(n(e.node))return;let r=0;e.node.outEdges.forEach(o=>{o.setLayout({x:"vertical"===t?e.x+r:e.x+e.dx,y:"vertical"===t?e.y+e.dy:e.y+r},!0),r+=o.getLayout()[a.breadthSize]})}(t,a,r),function(e,t,a,r,o){if(n(e.node))return;let i=0;e.node.inEdges.forEach(n=>{const s=function(e,t,a,r){const o=[];return e.passThroughNodeIds.forEach(e=>{const n=t.find(t=>t.id===e);o.push({x:n.x,y:n.y,type:r}),"vertical"===a?o.push({x:n.x,y:n.y+n.dy,type:"line"}):o.push({x:n.x+n.dx,y:n.y,type:"line"})}),o}(n,t,a,o);n.setLayout({targets:[...s,{x:"vertical"===a?e.x+i:e.x,y:"vertical"===a?e.y:e.y+i,type:o}]},!0),i+=n.getLayout()[r.breadthSize]})}(t,e,a,r,o))})}(f,a,d)}(h.nodes,h.edges,a,r,d,u,e.get("orient"))})}function l(e,t){const a=e.hostGraph.data.getRawDataItem(e.dataIndex).depth||0,r=t.findIndex(e=>e===a);return{depth:a,depthIndex:r}}function c(e,t,a,r=0){let o=a/t;o<r&&(o=r);let n=0;const s=e.map(e=>{if(e.size===i)return e;let t=Math.floor(e.value/o);return t<i&&(n+=i-t,t=i),Object.assign(Object.assign({},e),{},{size:t})});return n>0?c(s,t-n,a,o):{nodes:s,valueToSizeRatio:o}}var d=a(68730);class u extends d.A{render(e,t,a){super.render(e,t,a);const r=e.getData("edge");e.getGraph().eachEdge(e=>{const t=e.getLayout(),a=e.getModel().getModel("lineStyle").get("curveness"),o=r.getItemGraphicEl(e.dataIndex);o.buildPath=e=>function(e,t,a){var r;if(null===(r=t.targets)||void 0===r||!r.length)return;e.moveTo(t.x,t.y);const o=t.targets[t.targets.length-1],n=[{x:t.x,y:t.y,type:o.type},...t.targets];for(let i=1;i<n.length;i++){const t=n[i],r=n[i-1];"curveHorizontal"===t.type?e.bezierCurveTo(r.x*(1-a)+t.x*a,r.y,t.x*(1-a)+r.x*a,t.y,t.x,t.y):"curveVertical"===t.type?e.bezierCurveTo(r.x,r.y*(1-a)+t.y*a,t.x,t.y*(1-a)+r.y*a,t.x,t.y):e.lineTo(t.x,t.y)}e.lineTo(o.x+t.dx,o.y+t.dy);for(let i=n.length-2;i>=0;i--){const r={x:n[i+1].x+t.dx,y:n[i+1].y+t.dy,type:n[i+1].type},o={x:n[i].x+t.dx,y:n[i].y+t.dy,type:r.type};"curveHorizontal"===o.type?e.bezierCurveTo(r.x*(1-a)+o.x*a,r.y,o.x*(1-a)+r.x*a,o.y,o.x,o.y):"curveVertical"===o.type?e.bezierCurveTo(r.x,r.y*(1-a)+o.y*a,o.x,o.y*(1-a)+r.y*a,o.x,o.y):e.lineTo(o.x,o.y)}e.closePath()}(e,t,a),o.dirtyShape()})}}var h=u;function p(e){(0,r.a)(e),e.registerLayout(s),e.registerChartView(h)}},48125:function(e,t,a){a.d(t,{M:function(){return r}});a(67579),a(41190);const r=/(?:iphone|android|ipad)/i.test(navigator.userAgent)},35083:function(e,t,a){let r;function o(e,t,a="Roboto, Noto, sans-serif"){r||(r=document.createElement("canvas"));const o=r.getContext("2d");if(!o)return 0;o.font=`${t}px ${a}`;const n=o.measureText(e);return Math.ceil(Math.max(n.actualBoundingBoxRight+n.actualBoundingBoxLeft,n.width))}a.d(t,{W:function(){return o}})}}]);
//# sourceMappingURL=19348.d07ee88af4d0804c.js.map