# v0.15.0 SubAgent Development Plan

**Purpose**: SubAgentï¼ˆTask toolï¼‰ã‚’æ´»ç”¨ã—ãŸåŠ¹ç‡çš„ãªä¸¦åˆ—é–‹ç™º
**Target**: v0.15.0 Unified Memory Model (8é€±é–“ â†’ 4-5é€±é–“ã«çŸ­ç¸®å¯èƒ½)
**Last Updated**: 2025-11-03

---

## SubAgentæ´»ç”¨ã®åˆ©ç‚¹

### 1. ä¸¦åˆ—é–‹ç™ºã«ã‚ˆã‚‹æ™‚é–“çŸ­ç¸®
```
å¾“æ¥ï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ï¼‰: 8é€±é–“
SubAgentæ´»ç”¨ï¼ˆä¸¦åˆ—ï¼‰: 4-5é€±é–“ (-40%ã€œ-50%)
```

### 2. ç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŒæ™‚é–‹ç™º
- Memory System core
- Backward compatibility layer
- CLI commands
- MCP tools
- Tests
- Documentation

### 3. å„SubAgentã®å°‚é–€æ€§
- **Coreé–‹ç™ºAgent**: Memory model, storage, algorithms
- **Integrationé–‹ç™ºAgent**: Backward compatibility, migration
- **CLIé–‹ç™ºAgent**: Command-line interface
- **MCPé–‹ç™ºAgent**: MCP server tools
- **Testé–‹ç™ºAgent**: Test suites
- **Docé–‹ç™ºAgent**: Documentation

---

## ä¸¦åˆ—é–‹ç™ºå¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### Phase 1: Core Components (Week 1-2ã‚’ä¸¦åˆ—åŒ–)

#### ç‹¬ç«‹é–‹ç™ºå¯èƒ½ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

**Agent 1: Memory Core** (Week 1-2)
```
Tasks:
- MemoryEntry modelå®šç¾© (clauxton/core/memory.py)
- Memory classå®Ÿè£… (CRUD operations)
- MemoryStore å®Ÿè£… (storage backend)
- Tests: tests/core/test_memory.py (50 tests)

Dependencies: None (å®Œå…¨ã«ç‹¬ç«‹)
Estimated: 5-7æ—¥
```

**Agent 2: Backward Compatibility** (Week 1-2)
```
Tasks:
- KnowledgeBaseCompatå®Ÿè£… (clauxton/core/knowledge_base_compat.py)
- TaskManagerCompatå®Ÿè£… (clauxton/core/task_manager_compat.py)
- Deprecation warnings å®Ÿè£…
- Tests: tests/core/test_compatibility.py (40 tests)

Dependencies: Memory Core (Agent 1ã®æˆæœç‰©)
Estimated: 5-7æ—¥

Note: Agent 1å®Œäº†å¾Œã«é–‹å§‹å¯èƒ½
```

**Agent 3: Migration Script** (Week 1-2)
```
Tasks:
- MemoryMigratorå®Ÿè£… (clauxton/utils/migrate_to_memory.py)
- KB â†’ Memory migration
- Task â†’ Memory migration
- Rollbackæ©Ÿèƒ½
- Tests: tests/utils/test_migrate_to_memory.py (10 tests)

Dependencies: Memory Core (Agent 1ã®æˆæœç‰©)
Estimated: 3-4æ—¥

Note: Agent 1å®Œäº†å¾Œã«é–‹å§‹å¯èƒ½
```

**Agent 4: CLI Commands** (Week 1-2)
```
Tasks:
- clauxton memory add/search/list/get/update/delete å®Ÿè£…
- Deprecation warnings for daily commands
- Click integration
- Tests: tests/cli/test_memory.py (20 tests)

Dependencies: Memory Core (Agent 1ã®æˆæœç‰©)
Estimated: 4-5æ—¥

Note: Agent 1å®Œäº†å¾Œã«é–‹å§‹å¯èƒ½
```

**Agent 5: MCP Tools** (Week 1-2)
```
Tasks:
- memory_add/search/get/update/delete MCP tools
- Deprecated kb_*/task_* tools (with warnings)
- Tests: tests/mcp/test_server_memory.py (30 tests)

Dependencies: Memory Core (Agent 1ã®æˆæœç‰©)
Estimated: 5-6æ—¥

Note: Agent 1å®Œäº†å¾Œã«é–‹å§‹å¯èƒ½
```

#### Phase 1ã®ä¸¦åˆ—å®Ÿè¡Œæˆ¦ç•¥

```
Day 1-7:
  Agent 1 (Memory Core) â†’ å˜ç‹¬é–‹ç™º

Day 8-14 (Agent 1å®Œäº†å¾Œ):
  Agent 2 (Backward Compat) â”
  Agent 3 (Migration)      â”œâ”€ ä¸¦åˆ—å®Ÿè¡Œ (4ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒæ™‚)
  Agent 4 (CLI Commands)    â”‚
  Agent 5 (MCP Tools)      â”˜

çµæœ: Week 1-2 ã‚’ 2é€±é–“ â†’ 10-12æ—¥ ã«çŸ­ç¸®
```

---

### Phase 2: Smart Memory (Week 3-4ã‚’ä¸¦åˆ—åŒ–)

#### ç‹¬ç«‹é–‹ç™ºå¯èƒ½ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

**Agent 6: Memory Extraction** (Week 3-4)
```
Tasks:
- MemoryExtractorå®Ÿè£… (clauxton/semantic/memory_extractor.py)
- extract_from_commit() å®Ÿè£…
- extract_from_recent_commits() å®Ÿè£…
- Decision/pattern detection
- Tests: tests/semantic/test_memory_extractor.py (15 tests)

Dependencies: Memory Core
Estimated: 5-6æ—¥
```

**Agent 7: Relationship Detection** (Week 3-4)
```
Tasks:
- MemoryLinkerå®Ÿè£… (clauxton/semantic/memory_linker.py)
- find_relationships() å®Ÿè£…
- suggest_merge_candidates() å®Ÿè£…
- Tests: tests/semantic/test_memory_linker.py (15 tests)

Dependencies: Memory Core
Estimated: 5-6æ—¥
```

**Agent 8: CLI Extract Commands** (Week 3-4)
```
Tasks:
- clauxton memory extract å®Ÿè£…
- clauxton memory link å®Ÿè£…
- clauxton memory suggest-merge å®Ÿè£…
- Tests: tests/cli/test_memory_extract.py (10 tests)

Dependencies: Agent 6, 7
Estimated: 3-4æ—¥

Note: Agent 6, 7å®Œäº†å¾Œã«é–‹å§‹
```

#### Phase 2ã®ä¸¦åˆ—å®Ÿè¡Œæˆ¦ç•¥

```
Day 15-20:
  Agent 6 (Memory Extraction) â”
  Agent 7 (Relationship)      â”˜â”€ ä¸¦åˆ—å®Ÿè¡Œ (2ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒæ™‚)

Day 21-24 (Agent 6, 7å®Œäº†å¾Œ):
  Agent 8 (CLI Extract) â†’ å˜ç‹¬é–‹ç™º

çµæœ: Week 3-4 ã‚’ 2é€±é–“ â†’ 10æ—¥ ã«çŸ­ç¸®
```

---

### Phase 3: Memory Intelligence (Week 5-6ã‚’ä¸¦åˆ—åŒ–)

#### ç‹¬ç«‹é–‹ç™ºå¯èƒ½ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

**Agent 9: Question-Answering** (Week 5-6)
```
Tasks:
- MemoryQAå®Ÿè£… (clauxton/semantic/memory_qa.py)
- answer_question() å®Ÿè£…
- MCP tool: answer_question()
- Tests: tests/semantic/test_memory_qa.py (10 tests)

Dependencies: Memory Core, Semantic search
Estimated: 5-6æ—¥
```

**Agent 10: Summarization** (Week 5-6)
```
Tasks:
- MemorySummarizerå®Ÿè£… (clauxton/semantic/memory_summarizer.py)
- summarize_project() å®Ÿè£…
- predict_next_tasks() å®Ÿè£…
- generate_knowledge_gaps() å®Ÿè£…
- MCP tools: get_project_summary(), suggest_next_tasks()
- Tests: tests/semantic/test_memory_summarizer.py (10 tests)

Dependencies: Memory Core
Estimated: 5-6æ—¥
```

**Agent 11: Memory Graph** (Week 5-6)
```
Tasks:
- MemoryGraphå®Ÿè£… (clauxton/visualization/memory_graph.py)
- generate_graph_data() å®Ÿè£…
- export_to_dot() å®Ÿè£…
- export_to_mermaid() å®Ÿè£…
- CLI: clauxton memory graph
- Tests: tests/visualization/test_memory_graph.py (5 tests)

Dependencies: Memory Core, Relationship detection
Estimated: 4-5æ—¥
```

#### Phase 3ã®ä¸¦åˆ—å®Ÿè¡Œæˆ¦ç•¥

```
Day 25-30:
  Agent 9 (Q&A)         â”
  Agent 10 (Summary)    â”œâ”€ ä¸¦åˆ—å®Ÿè¡Œ (3ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒæ™‚)
  Agent 11 (Graph)      â”˜

çµæœ: Week 5-6 ã‚’ 2é€±é–“ â†’ 6æ—¥ ã«çŸ­ç¸®
```

---

### Phase 4: Documentation & Polish (Week 7-8ã‚’ä¸¦åˆ—åŒ–)

#### ç‹¬ç«‹é–‹ç™ºå¯èƒ½ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

**Agent 12: Core Documentation** (Week 7-8)
```
Tasks:
- docs/MEMORY_SYSTEM.md ä½œæˆ
- docs/MEMORY_QUICK_START.md ä½œæˆ
- docs/MIGRATION_GUIDE_v0.15.0.md ä½œæˆ
- Code examples, diagrams

Dependencies: All implementation complete
Estimated: 4-5æ—¥
```

**Agent 13: API Documentation** (Week 7-8)
```
Tasks:
- Update docs/mcp-index.md
- Update README.md
- Update docs/architecture.md
- CLI help texts

Dependencies: All implementation complete
Estimated: 3-4æ—¥
```

**Agent 14: Integration Tests** (Week 7-8)
```
Tasks:
- tests/integration/test_memory_workflow.py (15 scenarios)
- End-to-end workflow tests
- Performance tests
- User acceptance tests

Dependencies: All implementation complete
Estimated: 4-5æ—¥
```

**Agent 15: TUI Integration** (Week 7-8)
```
Tasks:
- Memory Explorer tab (clauxton/tui/memory_explorer.py)
- Update dashboard for Memory System
- Keyboard shortcuts for memory commands
- Tests: tests/tui/test_memory_explorer.py (10 tests)

Dependencies: Memory Core, CLI commands
Estimated: 5-6æ—¥
```

#### Phase 4ã®ä¸¦åˆ—å®Ÿè¡Œæˆ¦ç•¥

```
Day 31-36:
  Agent 12 (Core Docs)    â”
  Agent 13 (API Docs)     â”œâ”€ ä¸¦åˆ—å®Ÿè¡Œ (4ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒæ™‚)
  Agent 14 (Integration)  â”‚
  Agent 15 (TUI)          â”˜

çµæœ: Week 7-8 ã‚’ 2é€±é–“ â†’ 6æ—¥ ã«çŸ­ç¸®
```

---

## SubAgentå®Ÿè¡Œãƒ—ãƒ©ãƒ³

### æº–å‚™ãƒ•ã‚§ãƒ¼ã‚º (Day 0)

**ã‚¿ã‚¹ã‚¯**: SubAgentå®Ÿè¡Œã®ãŸã‚ã®æº–å‚™
```bash
# 1. é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/v0.15.0-unified-memory

# 2. SubAgentç”¨ã®ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
# (å„Agentã¸ã®è©³ç´°æŒ‡ç¤º)
```

### Phase 1å®Ÿè¡Œ (Day 1-12)

#### Day 1-7: Agent 1 (Memory Core)

**SubAgentèµ·å‹•ã‚³ãƒãƒ³ãƒ‰**:
```
Task tool with subagent_type="general-purpose"

Prompt:
"Implement Memory System core for Clauxton v0.15.0.

Context:
- Read docs/v0.15.0_IMPLEMENTATION_PLAN.md (Week 1-2 section)
- Read docs/v0.15.0_MIGRATION_VALIDATION.md
- Existing codebase: clauxton/core/

Tasks:
1. Implement MemoryEntry model (clauxton/core/memory.py)
   - Pydantic model with strict validation
   - Fields: id, type, title, content, category, tags, created_at, updated_at, related_to, source, confidence, source_ref, legacy_id
   - Type: Literal["knowledge", "decision", "code", "task", "pattern"]

2. Implement Memory class (clauxton/core/memory.py)
   - add(entry: MemoryEntry) -> str
   - get(memory_id: str) -> Optional[MemoryEntry]
   - search(query: str, type_filter: List[str], limit: int) -> List[MemoryEntry]
   - update(memory_id: str, **kwargs) -> bool
   - delete(memory_id: str) -> bool
   - find_related(memory_id: str, limit: int) -> List[MemoryEntry]

3. Implement MemoryStore (clauxton/core/memory_store.py)
   - YAML-based storage (.clauxton/memories.yml)
   - Atomic writes with backup
   - Index for fast lookup
   - load_all(), save(), rebuild_index()

4. Write comprehensive tests (tests/core/test_memory.py)
   - CRUD operations (10 tests)
   - Type filtering (10 tests)
   - Relationship management (10 tests)
   - Legacy ID compatibility (10 tests)
   - Edge cases (10 tests)

Requirements:
- Follow existing code style (see CLAUDE.md)
- Use Pydantic for validation
- Use atomic file writes (see clauxton/utils/yaml_utils.py)
- Type hints required
- Docstrings (Google style)
- Coverage >95%

Deliverables:
- clauxton/core/memory.py
- clauxton/core/memory_store.py
- tests/core/test_memory.py (50 tests)
- All tests passing

Do NOT:
- Modify existing KB/Task code yet
- Implement CLI/MCP integration yet
- Write documentation yet

Expected duration: 5-7 days
Status reporting: Daily progress updates"
```

#### Day 8-12: Agents 2-5 (ä¸¦åˆ—å®Ÿè¡Œ)

**4ã¤ã®SubAgentã‚’ä¸¦åˆ—èµ·å‹•**:

```
# Agent 2: Backward Compatibility
Task tool with subagent_type="general-purpose"
Prompt: [Detailed prompt for backward compatibility layer]
Dependencies: Wait for Agent 1 completion

# Agent 3: Migration Script
Task tool with subagent_type="general-purpose"
Prompt: [Detailed prompt for migration script]
Dependencies: Wait for Agent 1 completion

# Agent 4: CLI Commands
Task tool with subagent_type="general-purpose"
Prompt: [Detailed prompt for CLI commands]
Dependencies: Wait for Agent 1 completion

# Agent 5: MCP Tools
Task tool with subagent_type="general-purpose"
Prompt: [Detailed prompt for MCP tools]
Dependencies: Wait for Agent 1 completion
```

**ä¸¦åˆ—å®Ÿè¡Œæ–¹æ³•** (Claude Code):
```
I'll launch 4 SubAgents in parallel for backward compatibility, migration, CLI, and MCP implementation.

[Launch all 4 Task tools in a single message]
```

### Phase 2å®Ÿè¡Œ (Day 13-24)

åŒæ§˜ã« Agent 6, 7ã‚’ä¸¦åˆ—å®Ÿè¡Œ â†’ Agent 8ã‚’å®Ÿè¡Œ

### Phase 3å®Ÿè¡Œ (Day 25-30)

Agent 9, 10, 11ã‚’ä¸¦åˆ—å®Ÿè¡Œ

### Phase 4å®Ÿè¡Œ (Day 31-36)

Agent 12, 13, 14, 15ã‚’ä¸¦åˆ—å®Ÿè¡Œ

---

## SubAgentæ´»ç”¨ã®å®Ÿè·µã‚¬ã‚¤ãƒ‰

### 1. è©³ç´°ãªæŒ‡ç¤ºãŒé‡è¦

**è‰¯ã„ä¾‹**:
```
Task: Implement MemoryEntry model

Requirements:
- File: clauxton/core/memory.py
- Use Pydantic BaseModel
- Fields: id (str, pattern="^MEM-\d{8}-\d{3}$"), type (Literal[...]), ...
- Add validation: title min_length=1, max_length=200
- Add docstrings (Google style)
- Follow existing code style in clauxton/core/knowledge_base.py

Tests:
- tests/core/test_memory.py
- Test ID validation
- Test type validation
- Test edge cases (empty string, Unicode, etc.)

Example:
```python
class MemoryEntry(BaseModel):
    id: str = Field(..., pattern=r"^MEM-\d{8}-\d{3}$")
    # ...
```
```

**æ‚ªã„ä¾‹**:
```
Task: Implement memory system
```

### 2. ä¾å­˜é–¢ä¿‚ã®æ˜ç¢ºåŒ–

```
Agent 2 (Backward Compat):
  Dependencies: Agent 1 (Memory Core)
  Wait condition: tests/core/test_memory.py ãŒå…¨ã¦ pass

Agent 8 (CLI Extract):
  Dependencies: Agent 6 (Memory Extraction), Agent 7 (Relationship)
  Wait condition: Both test suites passing
```

### 3. æˆæœç‰©ã®æ¤œè¨¼

å„SubAgentå®Œäº†å¾Œ:
```bash
# Testså®Ÿè¡Œ
pytest tests/core/test_memory.py -v

# Type check
mypy clauxton/core/memory.py

# Lint
ruff check clauxton/core/memory.py

# Coverage
pytest --cov=clauxton/core/memory.py --cov-report=term
```

### 4. SubAgenté–“ã®èª¿æ•´

**çµ±åˆãƒ–ãƒ©ãƒ³ãƒ**:
```bash
feature/v0.15.0-unified-memory  (main branch)
  â”œâ”€ agent-1-memory-core       (Agent 1)
  â”œâ”€ agent-2-backward-compat   (Agent 2)
  â”œâ”€ agent-3-migration         (Agent 3)
  â”œâ”€ agent-4-cli-commands      (Agent 4)
  â””â”€ agent-5-mcp-tools         (Agent 5)

# å„Agentå®Œäº†å¾Œã«mainãƒ–ãƒ©ãƒ³ãƒã«merge
```

---

## ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ¯”è¼ƒ

### ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«é–‹ç™º (å¾“æ¥)

```
Week 1-2: Core Integration          [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 14æ—¥
Week 3-4: Smart Memory               [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 14æ—¥
Week 5-6: Memory Intelligence        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 14æ—¥
Week 7-8: UX Polish                  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 14æ—¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åˆè¨ˆ: 56æ—¥ (8é€±é–“)
```

### SubAgentä¸¦åˆ—é–‹ç™º

```
Phase 1: Core Components
  Agent 1 (Memory Core)                [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 7æ—¥
  Agents 2-5 (ä¸¦åˆ—)                    [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 5æ—¥
  â””â”€ Subtotal: 12æ—¥

Phase 2: Smart Memory
  Agents 6-7 (ä¸¦åˆ—)                    [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 6æ—¥
  Agent 8 (CLI Extract)                [â–ˆâ–ˆâ–ˆâ–ˆ] 4æ—¥
  â””â”€ Subtotal: 10æ—¥

Phase 3: Memory Intelligence
  Agents 9-11 (ä¸¦åˆ—)                   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 6æ—¥
  â””â”€ Subtotal: 6æ—¥

Phase 4: Documentation & Polish
  Agents 12-15 (ä¸¦åˆ—)                  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 6æ—¥
  â””â”€ Subtotal: 6æ—¥

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åˆè¨ˆ: 34æ—¥ (ç´„5é€±é–“)

æ™‚é–“çŸ­ç¸®: 56æ—¥ â†’ 34æ—¥ (â–²22æ—¥, -39%)
```

---

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: SubAgenté–“ã®èª¿æ•´ã‚³ã‚¹ãƒˆ

**ãƒªã‚¹ã‚¯**: ä¸¦åˆ—é–‹ç™ºã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¸æ•´åˆ

**å¯¾ç­–**:
- Agent 1 (Memory Core) ã‚’æœ€å„ªå…ˆã§å®Œæˆ
- æ˜ç¢ºãªAPIå®šç¾©ã‚’å…ˆã«ä½œæˆ
- Type hints + Pydantic ã§å‹å®‰å…¨æ€§ç¢ºä¿

### ãƒªã‚¹ã‚¯2: SubAgentã®å“è³ªã°ã‚‰ã¤ã

**ãƒªã‚¹ã‚¯**: å„Agentã®ã‚³ãƒ¼ãƒ‰å“è³ªãŒç•°ãªã‚‹

**å¯¾ç­–**:
- è©³ç´°ãªè¦ä»¶å®šç¾©ï¼ˆã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- è‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼ˆmypy, ruff, pytestï¼‰
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆ

### ãƒªã‚¹ã‚¯3: ä¾å­˜é–¢ä¿‚ã®å¾…ã¡æ™‚é–“

**ãƒªã‚¹ã‚¯**: Agent 1å®Œäº†å¾…ã¡ã§æ™‚é–“ãƒ­ã‚¹

**å¯¾ç­–**:
- Agent 1ã‚’æœ€çŸ­ã§å®Œæˆï¼ˆ7æ—¥ â†’ 5æ—¥ã«åœ§ç¸®ï¼‰
- ä¸¦åˆ—Agentã¯ä»•æ§˜æ›¸ãƒ™ãƒ¼ã‚¹ã§å…ˆè¡Œé–‹ç™º
- Mock/Stubã§å…ˆè¡Œãƒ†ã‚¹ãƒˆ

---

## SubAgentæ´»ç”¨ã®æˆåŠŸæ¡ä»¶

### 1. æ˜ç¢ºãªã‚¿ã‚¹ã‚¯åˆ†å‰²
- âœ… ç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- âœ… æ˜ç¢ºãªå…¥å‡ºåŠ›
- âœ… ä¾å­˜é–¢ä¿‚ãŒå°‘ãªã„

### 2. è©³ç´°ãªä»•æ§˜æ›¸
- âœ… APIå®šç¾©æ˜ç¢º
- âœ… ã‚³ãƒ¼ãƒ‰ä¾‹ã‚ã‚Š
- âœ… ãƒ†ã‚¹ãƒˆè¦ä»¶æ˜ç¢º

### 3. è‡ªå‹•åŒ–ã•ã‚ŒãŸCI
- âœ… pytestè‡ªå‹•å®Ÿè¡Œ
- âœ… mypyè‡ªå‹•ãƒã‚§ãƒƒã‚¯
- âœ… ruffè‡ªå‹•ãƒã‚§ãƒƒã‚¯

### 4. èª¿æ•´ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
- âœ… Git branching strategy
- âœ… Daily standup (é€²æ—ç¢ºèª)
- âœ… Integration testing

---

---

## å“è³ªä¿è¨¼æˆ¦ç•¥: SubAgentã«ã‚ˆã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ”¹å–„

### èª²é¡Œèªè­˜

SubAgentä¸¦åˆ—é–‹ç™ºã§ã®å“è³ªãƒªã‚¹ã‚¯:
- ã‚³ãƒ¼ãƒ‰å“è³ªã®ã°ã‚‰ã¤ã
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ä¸è¶³
- ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã®æ¼ã‚Œ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³

### è§£æ±ºç­–: 3å±¤å“è³ªä¿è¨¼ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### Layer 1: é–‹ç™ºæ™‚å“è³ªè¦ä»¶ï¼ˆå„SubAgentï¼‰

**å„SubAgentã¸ã®å“è³ªè¦ä»¶ã‚’æ˜ç¤º**:

```
Task: Implement Memory Core

[... å®Ÿè£…è¦ä»¶ ...]

Quality Requirements (å¿…é ˆ):

1. Code Review (Self-Review):
   - Follow code style: CLAUDE.md
   - Type hints: 100% coverage
   - Docstrings: Google style, all public APIs
   - No code smells (complex functions, magic numbers)

2. Performance:
   - Memory.search(): <100ms for 1,000 entries
   - Memory.add(): <50ms
   - Add performance benchmarks
   - Profile critical paths

3. Testing (Comprehensive):
   - Unit tests: >50 tests
   - Edge cases: Unicode, empty, None, large data
   - Error handling: All exceptions tested
   - Security: Injection, validation, boundary checks
   - Performance tests: Benchmark critical operations
   - Coverage: >95%

4. Lint & Type Check:
   - mypy --strict: Must pass
   - ruff check: Must pass (no warnings)
   - No type: ignore unless justified

5. Documentation:
   - Code comments for complex logic
   - API documentation with examples
   - Usage guide (inline examples)
   - Edge case documentation

Self-Review Checklist (å®Œäº†æ¡ä»¶):
- [ ] All tests pass (pytest)
- [ ] Coverage >95% (pytest --cov)
- [ ] Type check passes (mypy --strict)
- [ ] Lint passes (ruff check)
- [ ] Performance benchmarks met
- [ ] Documentation complete
- [ ] Security review done

Deliverables:
- Implementation
- Comprehensive tests
- Performance benchmarks
- Documentation
- Self-review report
```

**åŠ¹æœ**: åŸºæœ¬çš„ãªå“è³ªã‚’é–‹ç™ºæ®µéšã§ç¢ºä¿

---

#### Layer 2: Phaseå®Œäº†å¾Œã®çµ±åˆãƒ¬ãƒ“ãƒ¥ãƒ¼Agentï¼ˆæ¨å¥¨ï¼‰

**å„Phaseå®Œäº†å¾Œã«å°‚é–€ãƒ¬ãƒ“ãƒ¥ãƒ¼Agentã‚’å®Ÿè¡Œ**:

##### Review Agent: Phase 1 Quality Assurance

**å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: Day 12 (Phase 1å®Œäº†å¾Œ)

**SubAgent Prompt**:
```
Task: Comprehensive Quality Review for Phase 1 (Core Components)

Context:
- Phase 1 deliverables complete (Agents 1-5)
- Files to review:
  - clauxton/core/memory.py
  - clauxton/core/memory_store.py
  - clauxton/core/knowledge_base_compat.py
  - clauxton/core/task_manager_compat.py
  - clauxton/utils/migrate_to_memory.py
  - clauxton/cli/memory.py
  - clauxton/mcp/server.py (memory tools)
  - All test files

Review Checklist:

1. Code Quality Review:
   - Code style consistency across all files
   - DRY principle (no code duplication)
   - SOLID principles
   - Clear naming conventions
   - Appropriate abstraction levels
   - Error handling consistency

2. Performance Analysis:
   - Profile all critical paths
   - Identify bottlenecks (>100ms operations)
   - Check algorithmic complexity (O(nÂ²) â†’ O(n log n))
   - Memory usage analysis
   - Caching opportunities
   - Database query optimization (if applicable)

3. Test Quality Review:
   âœ… Test Observation Points (è¦³ç‚¹):
      - Functional correctness
      - Edge cases (boundary values)
      - Error conditions (exceptions, invalid input)
      - Concurrency (if applicable)
      - Integration between components
      - Regression (breaking changes)

   âœ… Coverage Analysis:
      - Line coverage >95%
      - Branch coverage >90%
      - Missing test scenarios

   âœ… Test Types:
      - Unit tests (isolation)
      - Integration tests (component interaction)
      - Performance tests (benchmarks)
      - Security tests (injection, validation)
      - Scenario tests (user workflows)

   âœ… Test Quality:
      - Test naming clarity
      - Arrange-Act-Assert pattern
      - No flaky tests
      - Fast execution (<5s total)

4. Security Review:
   - Input validation (all user inputs)
   - SQL/Command injection risks
   - Path traversal vulnerabilities
   - YAML deserialization safety
   - Authentication/Authorization (if applicable)
   - Sensitive data handling
   - Dependencies security scan

5. Lint & Type Check:
   - mypy --strict passes
   - ruff check passes (no warnings)
   - No suppressed warnings without justification
   - Type hints completeness

6. Documentation Review:
   - API documentation completeness
   - Code comments for complex logic
   - Usage examples present
   - Migration guide accuracy
   - Changelog updated

7. Integration Validation:
   - Components work together
   - No breaking changes to existing APIs
   - Backward compatibility verified
   - Migration script tested

Deliverables:
1. Comprehensive review report:
   - Summary of findings
   - Critical issues (blocking)
   - Major issues (high priority)
   - Minor issues (nice-to-have)

2. Performance analysis report:
   - Benchmark results
   - Bottleneck identification
   - Optimization recommendations

3. Security audit report:
   - Vulnerabilities found
   - Risk assessment
   - Mitigation recommendations

4. Test gap analysis:
   - Missing test scenarios
   - Coverage gaps
   - Recommended additional tests

5. Improvement task list:
   - Prioritized (Critical/High/Medium/Low)
   - Effort estimation
   - Implementation suggestions

6. Documentation gaps:
   - Missing documentation
   - Unclear sections
   - Example code needed

Expected duration: 1.5 days
```

**åŒæ§˜ã®Review Agentã‚’å„Phaseå®Œäº†å¾Œã«å®Ÿè¡Œ**:
- Phase 1å®Œäº†å¾Œ (Day 12): Review Agent 1
- Phase 2å®Œäº†å¾Œ (Day 24): Review Agent 2
- Phase 3å®Œäº†å¾Œ (Day 30): Review Agent 3
- Phase 4å®Œäº†å¾Œ (Day 36): Review Agent 4

**ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å½±éŸ¿**:
```
é–‹ç™º: 34æ—¥
+ Review: 6æ—¥ (å„Phase 1.5æ—¥)
åˆè¨ˆ: 40æ—¥ (ç´„6é€±é–“)

ãã‚Œã§ã‚‚å¾“æ¥ã®8é€±é–“ã‚ˆã‚Š2é€±é–“çŸ­ç¸®
```

---

#### Layer 3: Critical Issues ã®æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼

**äººé–“ã®åˆ¤æ–­ãŒå¿…è¦ãªé ˜åŸŸ**:

1. **Architecture Decisions**
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆã®å¦¥å½“æ€§
   - APIè¨­è¨ˆã®ä¸€è²«æ€§
   - å°†æ¥ã®æ‹¡å¼µæ€§

2. **Security Critical Paths**
   - èªè¨¼ãƒ»èªå¯ãƒ­ã‚¸ãƒƒã‚¯
   - ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–
   - å¤–éƒ¨å…¥åŠ›ã®å‡¦ç†

3. **Performance Critical Paths**
   - ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®é€Ÿåº¦
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
   - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

**æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œã«SubAgentã§æ”¹å–„**:

```
# é–‹ç™ºè€…ãŒå•é¡Œç™ºè¦‹
git diff
pytest --cov
mypy clauxton/core/memory.py

# å•é¡Œã‚ã‚Œã°SubAgentã«æ”¹å–„ä¾é ¼
Task: Improve Memory Search Performance

Context:
- Current code: clauxton/core/memory.py, line 145-180
- Issue: search() is O(n) linear scan, slow for 10K+ entries
- Benchmark: Currently 500ms for 10K entries, target <100ms

Analysis:
- No indexing on common search fields
- Full content scan for every search
- No caching of search results

Tasks:
1. Add inverted index for full-text search
2. Add caching for recent searches (LRU cache)
3. Optimize filtering logic
4. Add performance tests (100, 1K, 10K, 100K entries)
5. Verify <100ms for 10K entries

Deliverables:
- Optimized code with indexing
- Performance tests
- Benchmark comparison (before/after)
- Documentation update

Expected: 1 day
```

---

### çµ±åˆå“è³ªãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**Phaseå®Œäº†æ¯ã«å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é›†è¨ˆ**:

```
Phase 1 Quality Dashboard:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Code Quality:
  âœ… mypy --strict: Pass
  âœ… ruff check: Pass (0 warnings)
  âœ… Code complexity: Average 5.2 (target <10)
  âš ï¸ Code duplication: 3 instances found

Performance:
  âœ… Memory.search(): 85ms (target <100ms)
  âœ… Memory.add(): 42ms (target <50ms)
  âŒ Migration: 2.5s for 1000 entries (target <1s)

Testing:
  âœ… Test count: 150 tests (target 100+)
  âœ… Coverage: 96% (target >95%)
  âš ï¸ Missing: Concurrency tests
  âœ… Performance tests: Present
  âœ… Security tests: Present

Security:
  âœ… Input validation: Complete
  âœ… Injection risks: None found
  âš ï¸ YAML deserialization: Using safe_load (OK)
  âœ… Dependencies: No known vulnerabilities

Documentation:
  âœ… API docs: Complete
  âœ… Code comments: Good
  âš ï¸ Migration guide: Needs more examples
  âœ… Changelog: Updated

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Overall Status: âœ… PASS with Minor Issues
Critical Issues: 0
Major Issues: 1 (Migration performance)
Minor Issues: 3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Action Items:
1. [HIGH] Optimize migration performance (Agent X)
2. [MEDIUM] Add concurrency tests (Agent X)
3. [LOW] Add more migration examples (Agent X or Manual)
4. [LOW] Refactor 3 code duplication instances (Manual)
```

---

### å®Ÿè¡Œä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼

**Phase 1å®Œäº†å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè¡Œ**:

```
Prompt 1: "ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼/æ”¹å–„ã—ã¦ã€‚"

â†’ Review Agent 1 èµ·å‹•
â†’ ä¸Šè¨˜ã®åŒ…æ‹¬çš„ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œ
â†’ æ”¹å–„ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆä½œæˆ
```

```
Prompt 2: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯æœ€é©åŒ–ã•ã‚Œã¦ãŠã‚Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã§ãã¦ã„ã¾ã™ã‹ï¼Ÿãƒ†ã‚¹ãƒˆã® **è¦³ç‚¹**ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã€Lintãƒã‚§ãƒƒã‚¯ã€ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã«ä¸è¶³ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿã¾ãŸã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ã‚„ä¿®æ­£ã¯å¿…è¦ãªã„ã§ã™ã‹ï¼Ÿ"

â†’ Review Agent 1 èµ·å‹•ï¼ˆè©³ç´°ãƒ¢ãƒ¼ãƒ‰ï¼‰
â†’ å…¨é …ç›®ã‚’å€‹åˆ¥ã«ãƒã‚§ãƒƒã‚¯:
   âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
   âœ… ãƒ†ã‚¹ãƒˆè¦³ç‚¹ï¼ˆ7ç¨®é¡ï¼‰
   âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆ95%+ï¼‰
   âœ… Lintãƒã‚§ãƒƒã‚¯
   âœ… ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
   âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
   âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â†’ ã‚®ãƒ£ãƒƒãƒ—åˆ†æãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
â†’ æ”¹å–„ã‚¿ã‚¹ã‚¯ä½œæˆ
```

**æ”¹å–„ã‚¿ã‚¹ã‚¯ã‚’åˆ¥SubAgentã§å®Ÿè¡Œ**:

```
# Review Agent 1ã®çµæœ
Issues found:
1. [CRITICAL] Migration performance: 2.5s (target <1s)
2. [MAJOR] Missing concurrency tests
3. [MINOR] Documentation examples insufficient

# æ”¹å–„SubAgentèµ·å‹•
Task 1: Optimize Migration Performance
Task 2: Add Concurrency Tests
Task 3: Enhance Documentation Examples

â†’ 3ã¤ã®SubAgentã‚’ä¸¦åˆ—èµ·å‹•
â†’ 1-2æ—¥ã§æ”¹å–„å®Œäº†
```

---

## ã¾ã¨ã‚

### å“è³ªä¿è¨¼ä»˜ãSubAgenté–‹ç™º

| é …ç›® | å¾“æ¥ | SubAgenté–‹ç™º | SubAgent+QA | æ”¹å–„ |
|------|------|-------------|------------|------|
| **é–‹ç™ºæœŸé–“** | 56æ—¥ | 34æ—¥ | 40æ—¥ | -29% |
| **å“è³ªä¿è¨¼** | æ‰‹å‹• | éƒ¨åˆ†çš„ | åŒ…æ‹¬çš„ | å‘ä¸Š |
| **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸** | 85% | 90% | 95%+ | +10% |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–** | æœ€å¾Œ | å„Phaseå¾Œ | å„Phaseå¾Œ | æ—©æœŸ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | æ‰‹å‹• | åŸºæœ¬ | åŒ…æ‹¬çš„ | å‘ä¸Š |

### æ¨å¥¨æˆ¦ç•¥

**3å±¤å“è³ªä¿è¨¼**:
1. **Layer 1**: å„SubAgentã«å“è³ªè¦ä»¶æ˜ç¤ºï¼ˆé–‹ç™ºæ™‚ï¼‰
2. **Layer 2**: Phaseå®Œäº†å¾Œã«Review Agentï¼ˆçµ±åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
3. **Layer 3**: Critical issues ã®æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼

**ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³**:
```
é–‹ç™º (ä¸¦åˆ—): 34æ—¥
å“è³ªä¿è¨¼: +6æ—¥
åˆè¨ˆ: 40æ—¥ (6é€±é–“)

å¾“æ¥ã®8é€±é–“ã‚ˆã‚Š2é€±é–“çŸ­ç¸®
+ å“è³ªå‘ä¸Šï¼ˆCoverage 85%â†’95%+ï¼‰
```

### æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. âœ… SubAgentå®Ÿè¡Œè¨ˆç”»ã®æ‰¿èªï¼ˆå“è³ªä¿è¨¼å«ã‚€ï¼‰
2. ğŸ“ å„Agentã¸ã®è©³ç´°æŒ‡ç¤ºä½œæˆï¼ˆå“è³ªè¦ä»¶å«ã‚€ï¼‰
3. ğŸš€ Phase 1 Agent 1ã‹ã‚‰é–‹å§‹ï¼ˆ2025-11-27ï¼‰
4. ğŸ” Phase 1å®Œäº†å¾Œã«Review Agent 1å®Ÿè¡Œï¼ˆDay 12ï¼‰

---

**Last Updated**: 2025-11-03
**Status**: ğŸ“‹ SubAgent Plan Ready (Quality Assurance Included)
**Estimated Time**: 40æ—¥ (6é€±é–“) with comprehensive QA
**Time Saving**: -29% (56æ—¥ â†’ 40æ—¥)
**Quality Improvement**: Coverage 85% â†’ 95%+
**Next Action**: Start Agent 1 (Memory Core) on 2025-11-27
